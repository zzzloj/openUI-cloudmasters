<?xml version="1.0" encoding="utf-8"?>
<hookexport>
  <hookdata>
    <config>
      <hook_name>(DP33) Global Sidebars</hook_name>
      <hook_desc>Display different sidebars for various sections on the board.</hook_desc>
      <hook_author>DawPi</hook_author>
      <hook_email>biuro@ipslink.pl</hook_email>
      <hook_website>http://www.ipslink.pl</hook_website>
      <hook_update_check>http://www.ipslink.pl/checkHook.php?hookKey=dp3_gsidebars</hook_update_check>
      <hook_requirements><![CDATA[a:3:{s:21:"required_applications";a:1:{s:4:"core";a:3:{s:8:"app_name";s:6:"System";s:11:"min_version";i:31006;s:11:"max_version";i:0;}}s:20:"hook_php_version_min";s:1:"0";s:20:"hook_php_version_max";s:1:"0";}]]></hook_requirements>
      <hook_version_human>1.0.9.5</hook_version_human>
      <hook_version_long>1095</hook_version_long>
      <hook_extra_data><![CDATA[a:2:{s:7:"display";N;s:8:"database";a:0:{}}]]></hook_extra_data>
      <hook_key>dp3_gsidebars</hook_key>
      <hook_global_caches/>
    </config>
  </hookdata>
  <hookfiles>
    <file>
      <hook_file_real>dp32_gsidebars_boardIndexTemplateSkinOverloader.php</hook_file_real>
      <hook_type>skinHooks</hook_type>
      <hook_classname>dp32_gsidebars_boardIndexTemplateSkinOverloader</hook_classname>
      <hook_data><![CDATA[a:8:{s:12:"dataLocation";s:0:"";s:14:"libApplication";s:0:"";s:15:"classToOverload";s:11:"skin_boards";s:9:"skinGroup";N;s:12:"skinFunction";N;s:4:"type";N;s:2:"id";N;s:8:"position";N;}]]></hook_data>
      <hooks_source><![CDATA[//-----------------------------------------------
// (DP33) Global Sidebars
//-----------------------------------------------
//-----------------------------------------------
// Skin Overloader
//-----------------------------------------------
// Author: DawPi
// Site: http://www.ipslink.pl
// Written on: 05 / 02 / 2011
//-----------------------------------------------
// Copyright (C) 2011 DawPi
// All Rights Reserved
//-----------------------------------------------     

class dp32_gsidebars_boardIndexTemplateSkinOverloader extends dp3_sas_boardIndexSkinOverloader
{	
	public function boardIndexTemplate( $lastvisit='', $stats=array(), $cat_data=array(), $show_side_blocks=true, $side_blocks=array() )
	{	
		/* Load library */
		
		if ( ! $this->registry->isClassLoaded( 'gsLibrary' ) )
		{
			$classToLoad = IPSLib::loadLibrary( IPSLib::getAppDir( 'gsidebars' ) . '/sources/classes/library.php', 'gsLibrary', 'gsidebars' );
			$this->lib = new $classToLoad( $this->registry );
		}
			
		/* Check access */

		if( $this->lib->checkAccess() )
		{			
			/* Do we have index or global sidebar? */
			
			if( $this->lib->checkSidebar( 'index' ) || $this->lib->checkSidebar( 'all' ) || $this->settings['dp3_gsidebars_disable_default_sidebar'] )
			{
				/* Sidebar is on left? */
                
				if( $this->settings['dp3_gsidebars_disable_default_sidebar'] || ( $this->settings['dp3_gs_side'] == 'left' ) )
				{
					$show_side_blocks 	= false;
				}
				
				/* Sidebar widder than 270? */
				
				if( in_array( $this->settings['dp3_gs_sidebar_width'], array( 'big', 'huge' ) ) || ( 270 < $this->settings['dp3_gsidebars_sidebar_custom_width'] ) )
				{
					$show_side_blocks 	= false;				
				} 				
			}
		}
 
		/* Return */
		
		return parent::boardIndexTemplate( $lastvisit, $stats, $cat_data, $show_side_blocks, $side_blocks );
	}
}// End of class]]></hooks_source>
    </file>
    <file>
      <hook_file_real>dp32_gsidebars_showSidebarBelow.php</hook_file_real>
      <hook_type>templateHooks</hook_type>
      <hook_classname>dp32_gsidebars_showSidebarBelow</hook_classname>
      <hook_data><![CDATA[a:8:{s:12:"dataLocation";s:0:"";s:14:"libApplication";s:0:"";s:15:"classToOverload";s:0:"";s:9:"skinGroup";s:11:"skin_boards";s:12:"skinFunction";s:18:"boardIndexTemplate";s:4:"type";s:7:"foreach";s:2:"id";s:11:"side_blocks";s:8:"position";s:10:"outer.post";}]]></hook_data>
      <hooks_source><![CDATA[<?php
      
//-----------------------------------------------
// (DP33) Global Sidebars
//-----------------------------------------------
//-----------------------------------------------
// Template Hook
//-----------------------------------------------
// Author: DawPi
// Site: http://www.ipslink.pl
// Written on: 07 / 02 / 2011
//-----------------------------------------------
// Copyright (C) 2011 DawPi
// All Rights Reserved
//-----------------------------------------------     

class dp32_gsidebars_showSidebarBelow
{
	public $registry;	
			
	
	public function __construct()
	{
		$this->registry   = ipsRegistry::instance();
		$this->DB	    = $this->registry->DB();
		$this->settings =& $this->registry->fetchSettings();
		$this->request  =& $this->registry->fetchRequest();
		$this->member   = $this->registry->member();
		$this->memberData =& $this->registry->member()->fetchMemberData();
		$this->lang		=  $this->registry->getClass('class_localization');
		$this->cache	= $this->registry->cache();
		$this->caches   =& $this->registry->cache()->fetchCaches();	
	}
	
	
	public function getOutput()
	{						
		/* Load library */
		
		$classToLoad = IPSLib::loadLibrary( IPSLib::getAppDir( 'gsidebars' ) . '/sources/classes/library.php', 'gsLibrary', 'gsidebars' );
		$this->lib = new $classToLoad( $this->registry );
					
		/* Check access */
		
		if( $this->lib->checkAccess() )
		{			
			/* Do we have index or global sidebar? */
			
			if( ! $this->lib->checkSidebar( 'index', true ) || ! $this->lib->checkSidebar( 'all', true ) )
			{
				/* Default sidebar is disable? */
				
				return $this->lib->getSectionHtml( 'index', true );
			}
		}	
						
		/* Return data */
	
		return '';
	}
} // End of class]]></hooks_source>
    </file>
    <file>
      <hook_file_real>dp32_gsidebars_showSidebarAbove.php</hook_file_real>
      <hook_type>templateHooks</hook_type>
      <hook_classname>dp32_gsidebars_showSidebarAbove</hook_classname>
      <hook_data><![CDATA[a:8:{s:12:"dataLocation";s:0:"";s:14:"libApplication";s:0:"";s:15:"classToOverload";s:0:"";s:9:"skinGroup";s:11:"skin_boards";s:12:"skinFunction";s:18:"boardIndexTemplate";s:4:"type";s:7:"foreach";s:2:"id";s:11:"side_blocks";s:8:"position";s:9:"outer.pre";}]]></hook_data>
      <hooks_source><![CDATA[<?php
      
//-----------------------------------------------
// (DP33) Global Sidebars
//-----------------------------------------------
//-----------------------------------------------
// Template Hook
//-----------------------------------------------
// Author: DawPi
// Site: http://www.ipslink.pl
// Written on: 07 / 02 / 2011
//-----------------------------------------------
// Copyright (C) 2011 DawPi
// All Rights Reserved
//-----------------------------------------------     

class dp32_gsidebars_showSidebarAbove
{
	public $registry;	
			
	
	public function __construct()
	{
		$this->registry   = ipsRegistry::instance();
		$this->DB	    = $this->registry->DB();
		$this->settings =& $this->registry->fetchSettings();
		$this->request  =& $this->registry->fetchRequest();
		$this->member   = $this->registry->member();
		$this->memberData =& $this->registry->member()->fetchMemberData();
		$this->lang		=  $this->registry->getClass('class_localization');
		$this->cache	= $this->registry->cache();
		$this->caches   =& $this->registry->cache()->fetchCaches();	
	}
	
	
	public function getOutput()
	{						
		/* Load library */

		$classToLoad = IPSLib::loadLibrary( IPSLib::getAppDir( 'gsidebars' ) . '/sources/classes/library.php', 'gsLibrary', 'gsidebars' );
		$this->lib = new $classToLoad( $this->registry );
					
		/* Check access */
		
		if( $this->lib->checkAccess() )
		{			
			/* Do we have index or global sidebar? */
			
			if( ! $this->lib->checkSidebar( 'index', true ) || ! $this->lib->checkSidebar( 'all', true ) )
			{
				/* Default sidebar is disable? */
				
				return $this->lib->getSectionHtml( 'all', true );
			}
		}	
						
		/* Still here? */
	
		return ''; 
	}
} // End of class]]></hooks_source>
    </file>
    <file>
      <hook_file_real>dp32_gsidebars_outputOverload.php</hook_file_real>
      <hook_type>libraryHooks</hook_type>
      <hook_classname>dp32_gsidebars_outputOverload</hook_classname>
      <hook_data><![CDATA[a:8:{s:12:"dataLocation";s:0:"";s:14:"libApplication";s:4:"core";s:15:"classToOverload";s:6:"output";s:9:"skinGroup";N;s:12:"skinFunction";N;s:4:"type";N;s:2:"id";N;s:8:"position";N;}]]></hook_data>
      <hooks_source><![CDATA[<?php
      
//-----------------------------------------------
// (DP33) Global Sidebars
//-----------------------------------------------
//-----------------------------------------------
// Handle Data
//-----------------------------------------------
// Author: DawPi
// Site: http://www.ipslink.pl
// Written on: 11 / 02 / 2011
//-----------------------------------------------
// Copyright (C) 2011 DawPi
// All Rights Reserved
//-----------------------------------------------     

class dp32_gsidebars_outputOverload extends (~extends~)
{	
    /**
	 * Main output function
	 *
	 * @access	public
	 * @return	void 
	 */
    public function sendOutput( $return=false )
    {
		/* Load library */
		
		require_once( IPSLib::getAppDir( 'gsidebars' ) . '/sources/classes/library.php' );
		$this->registry->setClass( 'gsLibrary', new gsLibrary( $this->registry ) );
		
		/* Parse HTML */
		
		$this->_html = $this->registry->gsLibrary->showSidebar( $this->_html );
		
		/* Run parent */
		
		return parent::sendOutput( $return );
	}	
} // End of class]]></hooks_source>
    </file>
  </hookfiles>
  <hookextras_settings/>
  <hookextras_language/>
  <hookextras_modules/>
  <hookextras_help/>
  <hookextras_templates/>
  <hookextras_css/>
  <hookextras_tasks/>
  <hookextras_database_create/>
  <hookextras_database_alter/>
  <hookextras_database_update/>
  <hookextras_database_insert/>
</hookexport>
