<?xml version="1.0" encoding="utf-8"?>
<templates application="gallery" templategroups="a:1:{s:13:&quot;skin_gallery_&quot;;s:8:&quot;contains&quot;;}">
  <templategroup group="skin_gallery_albums">
    <template>
      <template_group>skin_gallery_albums</template_group>
      <template_content><![CDATA[<h3>{$this->lang->words['as_title']}</h3>
<div class='fixed_inner ipsBox'>
	<if test="isLargeTouch:|:$this->registry->output->isLargeTouchDevice()">
		<div class='message' style='margin-bottom: 5px;'>{$this->lang->words['scroll_tip']}</div>
	</if>
	<div class='ipsVerticalTabbed ipsLayout ipsLayout_withleft ipsLayout_smallleft clearfix'>
		<div class='ipsVerticalTabbed_tabs ipsLayout_left'>
			<ul id='albumSelector_nav'>
				<if test="canShowOurs:|:in_array( $this->request['type'], array( 'upload', 'createMembersAlbum', 'createAlbum', 'create' ) )">
					<li class='active'><a data-album-pane-update="albums=member&type={$this->request['type']}" href='#'>{$this->lang->words['as_your_albums']}</a></li>
				</if>
				<if test="canShowOthers:|:$albumData['album_id'] && ( $this->request['moderate'] || IN_ACP )">
					<li<if test="cantShowOurs:|:!in_array( $this->request['type'], array( 'upload', 'createMembersAlbum', 'createAlbum', 'create' ) )"> class='active'</if>>
						<a data-album-pane-update="albums=othermember&member_id={$albumData['album_owner_id']}&type={$this->request['type']}" href='#'><if test="notOurs:|:$albumData['album_owner_id'] != $this->memberData['member_id']">{parse expression="sprintf( $this->lang->words['member_x_albums'], $albumData['owners_members_display_name'] )"}<else />{$this->lang->words['as_your_albums']}</if></a>
					</li>
				</if>
				<li><a data-album-pane-update="albums=search&type={$this->request['type']}" href='#'>{$this->lang->words['as_search_albums']}</a></li>
				<li><a data-album-pane-update="albums=recent&type={$this->request['type']}" href='#'>{$this->lang->words['as_recent_albums']}</a></li>
			</ul>
		</div>
		<div class='ipsVerticalTabbed_content ipsLayout_content ipsBox_container' style='position: relative' id='albumSelector_content'>
			{$albums}
		</div>
	</div>
</div>]]></template_content>
      <template_name>albumSelector</template_name>
      <template_data>$albums, $albumData=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_albums</template_group>
      <template_content><![CDATA[<if test="isSearch:|:$this->request['albums'] == 'search'">
<div class='ipsPad row2 ipsText_small desc ipsForm_center'>
	{$this->lang->words['filters_search']}
	<select id='searchType'>
		<option value='member' id='searchType_member' <if test="$this->request['searchType']=='member'">selected='selected'</if>>{$this->lang->words['filters_owners_name']}</option>
		<option value='album' id='searchType_album' <if test="$this->request['searchType']=='album'">selected='selected'</if>>{$this->lang->words['filters_albums_name']}</option>
	</select>
	<select id='searchMatch'>
		<option value='is' <if test="$this->request['searchMatch']=='is'">selected='selected'</if>>{$this->lang->words['filters_is']}</option>
		<option value='contains' <if test="$this->request['searchMatch']=='contains'">selected='selected'</if>>{$this->lang->words['filters_contains']}</option>
	</select>
	<input type='text' size='20' class='input_text ipsText_small' id='searchText' value='{$this->request['searchText']}' />
	<select id='searchSort'>
		<option value='date' id='searchSort_date' <if test="$this->request['searchSort']=='date'">selected='selected'</if>>{$this->lang->words['filters_sort_upload']}</option>
		<option value='name' id='searchSort_name' <if test="$this->request['searchSort']=='name'">selected='selected'</if>>{$this->lang->words['filters_sort_name']}</option>
		<option value='images' id='searchSort_images' <if test="$this->request['searchSort']=='images'">selected='selected'</if>>{$this->lang->words['filters_sort_images']}</option>
		<option value='comments' id='searchSort_comments' <if test="$this->request['searchSort']=='comments'">selected='selected'</if>>{$this->lang->words['filters_sort_comments']}</option>
	</select>
	<select id='searchDir'>
		<option value='desc' id='searchDir_desc' <if test="$this->request['searchDir']=='desc'">selected='selected'</if>>{$this->lang->words['filters_desc']}</option>
		<option value='asc' id='searchDir_asc' <if test="$this->request['searchDir']=='asc'">selected='selected'</if>>{$this->lang->words['filters_asc']}</option>
	</select>
	<input type='button' id='searchGo' value='{$this->lang->words['filters_update']}' class='ipsButton_secondary' />
</div>
</if>
<if test="hazAlbums:|:count($albums)">
	<table class='ipb_table' style="table-layout: auto;">
		<foreach loop="outer:$albums as $id => $album">
			<tr <if test="isThisAlbum:|:$album['album_id'] == $this->request['album_id']">class='row2'</if>>
				<td width='1%'><div class='ipsUserPhoto'>{parse gallery_resize="$album['thumb']" width="thumb_tiny"}</div></td>
				<td>
					<strong>{IPSText::truncate( $album['album_name'], 50 )}</strong>
					<if test="isNotOurs:|:$this->memberData['member_id'] != $album['album_owner_id']">
						<div class='ipsType_small desc'>{$this->lang->words['acp_albums_owners_name']} <a href='#'>{$album['owners_members_display_name']}</a></div>
					</if>
					<if test="hasImages:|:$album['album_count_imgs']">
						<div class='ipsType_smaller desc lighter'>{parse expression="sprintf( $this->lang->words['as_images_comments'], $album['album_count_imgs'], $album['album_count_comments'] )"} {$this->lang->words['as_last_upload']} {parse date="$album['album_last_img_date']" format="tiny"}</div>
					</if>
				</td>
				<td width='1%'>
					<if test="restrictUpload:|: isset($album['_canUpload']) && ! $album['_canUpload']">
						&nbsp;
					<else />
						<input type='button' data-album-select-album-id="{$album['album_id']}" class='ipsButton_secondary clickable' value='{$this->lang->words['as_select']}' />
					</if>
				</td>
			</tr>
		</foreach>
	</table>
<else />
	<div class='ipsPad desc'>{$this->lang->words['as_no_albums_show']}</div>
</if>
<script type="text/javascript">
	ipb.gallery_albumChooser.setParam( 'type'     , '{$this->request['type']}' );
	ipb.gallery_albumChooser.setParam( 'albums'   , 'member' );
	ipb.gallery_albumChooser.setParam( 'moderate' , '{$this->request['moderate']}' );
	ipb.gallery_albumChooser.setParam( 'album_id' , '{$this->request['album_id']}' );
	ipb.gallery_albumChooser.setParam( 'member_id', '{$this->request['member_id']}' );
</script>]]></template_content>
      <template_name>albumSelectorPanel</template_name>
      <template_data>$albums, $filters, $albumData</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_albums</template_group>
      <template_content><![CDATA[<script type="text/javascript">
 ipb.gallery.albumId	= parseInt({$album['album_id']});
</script>
<if test="hasFollow:|:$follow">
	{$follow}
</if>
<div class='right' style='margin: 3px 10px;'>
	<a href="{parse url="app=gallery&amp;module=albums&amp;section=rss&amp;type=album&amp;typeid={$album['album_id']}" base="public" template="galleryrss" seotitle="{$album['album_name_seo']}"}"><img src="{$this->settings['img_url']}/rss-mini.png" alt="{$this->lang->words['rss_feed']}" /></a>
</div>
{$cover['tag']}
<div class='ipsBox_withphoto ipsGallery_h1image'>
	<if test="allowRate:|:$album['album_allow_rating']">
		<span class='rating ipsType_smaller'>
			<strong>{$this->lang->words['rate_album']}</strong>&nbsp;&nbsp;
			<if test="guestrate1:|:$this->registry->gallery->helper('rate')->canRate($album) !== false"><a href='{parse url="app=gallery&amp;module=images&amp;section=rate&amp;where=album&amp;id={$album['album_id']}&amp;rating=1&amp;secure_key={$this->member->form_hash}" base="public"}' id='album_rate_1' title='{$this->lang->words['rate_file_1']}'></if><if test="filerate1:|:$album['album_rating_aggregate'] >= 1"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if><if test="endguestrate1:|:$this->memberData['member_id']"></a></if>
			<if test="guestrate2:|:$this->registry->gallery->helper('rate')->canRate($album) !== false"><a href='{parse url="app=gallery&amp;module=images&amp;section=rate&amp;where=album&amp;id={$album['album_id']}&amp;rating=2&amp;secure_key={$this->member->form_hash}" base="public"}' id='album_rate_2' title='{$this->lang->words['rate_file_2']}'></if><if test="filerate2:|:$album['album_rating_aggregate'] >= 2"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if><if test="endguestrate2:|:$this->memberData['member_id']"></a></if>
			<if test="guestrate3:|:$this->registry->gallery->helper('rate')->canRate($album) !== false"><a href='{parse url="app=gallery&amp;module=images&amp;section=rate&amp;where=album&amp;id={$album['album_id']}&amp;rating=3&amp;secure_key={$this->member->form_hash}" base="public"}' id='album_rate_3' title='{$this->lang->words['rate_file_3']}'></if><if test="filerate3:|:$album['album_rating_aggregate'] >= 3"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if><if test="endguestrate3:|:$this->memberData['member_id']"></a></if>
			<if test="guestrate4:|:$this->registry->gallery->helper('rate')->canRate($album) !== false"><a href='{parse url="app=gallery&amp;module=images&amp;section=rate&amp;where=album&amp;id={$album['album_id']}&amp;rating=4&amp;secure_key={$this->member->form_hash}" base="public"}' id='album_rate_4' title='{$this->lang->words['rate_file_4']}'></if><if test="ralerate4:|:$album['album_rating_aggregate'] >= 4"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if><if test="endguestrate4:|:$this->memberData['member_id']"></a></if>
			<if test="guestrate5:|:$this->registry->gallery->helper('rate')->canRate($album) !== false"><a href='{parse url="app=gallery&amp;module=images&amp;section=rate&amp;where=album&amp;id={$album['album_id']}&amp;rating=5&amp;secure_key={$this->member->form_hash}" base="public"}' id='album_rate_5' title='{$this->lang->words['rate_file_5']}'></if><if test="filerate5:|:$album['album_rating_aggregate'] >= 5"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if><if test="endguestrate5:|:$this->memberData['member_id']"></a></if>
			<span id='rating_text' class='desc'>
				<if test="filevotes:|:$album['album_rating_count'] > 0">{$album['album_rating_count']} {$this->lang->words['votes_cnt']}</if>
				<if test="fileyourvote:|:$album['_youRated']">({$this->lang->words['you_voted']} {$album['_youRated']})</if>
			</span>
			<if test="checkGuestRate:|:$this->memberData['member_id']">
				<script type='text/javascript'>
					rating = new ipb.rating( 'album_rate_', { 
										url: 		ipb.vars['base_url'] + 'app=gallery&amp;module=ajax&amp;section=rate&amp;id={$album['album_id']}&where=album&md5check=' + ipb.vars['secure_hash'],
										cur_rating: {parse expression="intval($album['album_rating_aggregate'])"},
										rated: 		<if test="filejsvotes:|:$album['album_rating_count']">1<else />0</if>,
										allow_rate: <if test="filejsallowvote:|:$this->registry->gallery->helper('rate')->canRate($album) !== false">1<else />0</if>
									  } );
				</script>
			</if>
		</span>
	</if>
	<h1 class='ipsType_pagetitle'>
		<if test="isPrivate:|:$this->registry->gallery->helper('albums')->isPrivate($album) === true">
			<span class='ipsBadge ipsBadge_red reset_cursor'>{$this->lang->words['private_ucfirst']}</span>
		</if>
		{$album['album_name']}
	</h1>
	<if test="hasRules:|:$album['album_description']">
		<div class='ipsType_pagedesc forum_rules'>
			{$album['album_description']}
		</div>
	</if>
</div>
<br />
<br />
<div class='ipsLayout ipsLayout_withright ipsLayout_hugeright'>
	<div class='ipsLayout_right'>
		<div class='ipsBox'>
			<div class='ipsBox_container ipsPad clearfix'>
				<ul class='ipsList_withmediumphoto'>
					<li class='clearfix'>
						<if test="uploadedByMember:|:$album['owner']['member_id']">
							<a href='{parse url="showuser={$album['owner']['member_id']}" seotitle="{$album['owner']['members_seo_name']}" template="showuser" base="public"}' class='ipsUserPhotoLink left'>
								<img src='{$album['owner']['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_medium' />
							</a>
						<else />
							<div class='left'>{IPSMember::buildNoPhoto( 0, 'small' )}</div>
						</if>
						<div class='list_content'>
							{$this->lang->words['by_ucfirst']} {parse template="userHoverCard" group="global" params="$album['owner']"} <span class='ipsType_smaller'>(<a href="{parse url="app=gallery&amp;user={$album['owner']['member_id']}" seotitle="{$album['owner']['members_seo_name']}" template="useralbum" base="public"}">{$this->lang->words['view_all_albums']}</a>)</span>
							<br /><br />
							<span class='desc'>
								<if test="hasLovelyRss:|:$this->registry->gallery->helper('albums')->isPrivate($album) !== true">
									<a href="{parse url="app=gallery&amp;module=albums&amp;section=rss&amp;type=album&amp;typeid={$album['album_id']}" base="public" template="galleryrss" seotitle="{$album['album_name_seo']}"}"><img src="{$this->settings['img_url']}/rss-mini.png" alt="{$this->lang->words['rss_feed']}" /></a>
								</if>
								{$album['album_count_imgs']} {$this->lang->words['images_lower']}, {$album['album_count_comments']} {$this->lang->words['comments_lower']}
							</span>
						</div>
					</li>
				</ul>
				
				<if test="canDoStuff:|:$album['_canEdit'] || $album['_canDelete']">
					<br class='clear' />
					<ul class='ipsList_inline right'>
						<if test="canEditAlbum:|:$album['_canEdit']">
							<li><a href="{parse url="app=gallery&amp;albumedit={$album['album_id']}" base="public" template="editalbum" seotitle="{$album['album_name_seo']}"}" class='ipsButton_secondary'>{$this->lang->words['edit_ucfirst']}</a></li>
						</if>
						<if test="canDeleteAlbum:|:$album['_canDelete']">
							<li><a href="#" album-id="{$album['album_id']}" class='ipsButton_secondary important _albumDelete'>{$this->lang->words['delete_ucfirst']}</a></li>
						</if>
					</ul>
				</if>
			</div>
		</div>
		<if test="hasOthers:|:count($recentAlbums)">
			<br />
			<div class='ipsSideBlock clearfix'>
				<h3>{parse expression="sprintf( $this->lang->words['recent_albumsowner_heading'], $album['members_display_name'] )"}</h3>
				<ul class='ipsList_withmediumphoto'>
				<foreach loop="recentAlbums:$recentAlbums as $album">
					<li class='clearfix'>
						<div class='left'>{parse gallery_resize="$album['thumb']" width="thumb_small"}</div>
						<div class='list_content recent_albums ipsPad_top'>
							<h4><strong><a href='{parse url="app=gallery&amp;album={$album['album_id']}" base="public" seotitle="{$album['album_name_seo']}" template="viewalbum"}'>{$album['album_name']}</a></strong></h4>
							<p class='ipsPad_top_half lighter'>
								{parse expression="sprintf( $this->lang->words['as_images_comments'], $album['album_count_imgs'], $album['album_count_comments'] )"}
							</p>
							<p class='ipsPad_top_half desc lighter'>
								{$this->lang->words['as_last_upload']} {parse date="$album['album_last_img_date']" format="tiny"}
							</p>
						</div>
					</li>
				</foreach>
				</ul>
			</div>
		</if>
	</div>
	
	<div class='ipsLayout_content'>
		<div class='topic_controls clear clearfix'>
			<if test="hasPagesTop:|:$album['_pages']">
				{$album['_pages']}
			</if>
			<ul class='topic_buttons'>
				<if test="canIuploadDearSirWellCanI:|:$this->registry->gallery->helper('albums')->isUploadable($album)">
					<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image&amp;album_id={$album['album_id']}" base="public"}' title='{$this->lang->words['upload']}'>{$this->lang->words['upload']}</a></li>
				</if>
				<if test="hasImages:|:count($images)">
					<li class='non_button'><a href="{parse url="app=gallery&amp;module=images&amp;section=slideshow&amp;type=album&amp;typeid={$album['album_id']}" base="public" seotitle="false" template="slideshow"}">{$this->lang->words['ss_title']}</a></li>
				</if>
			</ul>
		</div>
		<br />
		{parse template="image_listing" group="gallery_home" params="$images, $album, array(), array( 'url' => 'app=gallery&amp;album=' . $album['album_id'], 'title' => $album['album_name_seo'], 'template' => 'viewalbum', 'sort_key' => $album['album_sort_options__key'], 'sort_dir' => $album['album_sort_options__order'] ), true, IPSCookie::get('gallery_view_size')"}
	</div>
</div>
<if test="hasPagesBottom:|:$album['_pages']">
	<div class='clear'>{$album['_pages']}</div>
	<br />
</if>
<br class='clear' />
<if test="hasShareLinks:|:$this->settings['sl_enable']">
	<div class='ipsPad'>
		{IPSLib::shareLinks( $album['album_name'], array( 'skip' => array( 'print', 'download' ) ) )}
	</div>
	<br />
</if>]]></template_content>
      <template_name>albumView</template_name>
      <template_data><![CDATA[$cover, $images, $album, $follow='', $recentAlbums=array()]]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_albums</template_group>
      <template_content><![CDATA[<form action="{$this->settings['base_url']}app=gallery&module=albums&section=album&amp;do=delete&amp;album={$data['album_id']}" method="post" id="albumDeleteForm_{$data['album_id']}">
	<input type='hidden' name='auth_key' value='{$this->member->form_hash}' />
	{$data['hiddens']}
	{$data['errors']}
	
	<h3>{$this->lang->words['delete_album']}</h3>
	<div class='ipsBox short'>
	 {$this->lang->words['mod_alb_del_title']}
	 <if test="hasAlbums:|:$data['options'] !== false">
	 	<div style="width:auto; display:inline-block; margin: 0 auto; text-align: left;" class='ipsPad'>
			<input type="radio" name="doDelete" value="0" checked="checked" /> {$this->lang->words['mod_alb_del_move']}
			<select name='move_to_album_id' id='move_to_album_id' class='input_select'>
				{$data['options']}
			</select>
			<br />
			<input type="radio" name="doDelete" value="0" /> {$this->lang->words['mod_alb_del_movec']}
			<select name='move_to_category_id' id='move_to_category_id' class='input_select'>
				<foreach loop="categories:$data['_catOptions'] as $_cat">
					<option value='{$_cat[0]}'<if test="noImages:|:$_cat[0] AND !in_array( $_cat[0], $data['_acceptImages'] )"> disabled='disabled'</if>>{$_cat[1]}</option>
				</foreach>
			</select>
			<br />
			<input type="radio" name="doDelete" value="1" /> {$this->lang->words['mod_alb_del_desc']}
		</div>
	 <else />
	 	<input type="hidden" name="doDelete" value="1" />
	 </if>
	 <br /><br />
	 <input type='submit' class="input_submit" value="{$this->lang->words['mod_alb_del_go']}" />
	</div>
</form>]]></template_content>
      <template_name>deleteAlbumDialogue</template_name>
      <template_data>$data=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_albums</template_group>
      <template_content><![CDATA[{parse striping="recentComments" classes="row1,row2"}
<div class='ipsSideBlock clearfix'>
	<if test="hasTitle:|:$title"><h3>{$title}</h3></if>
	
	<ul class='ipsList_withmediumphoto ipsPad_half'>
		<foreach loop="imagesLoop:$images as $i => $image">
			<li class='{parse striping="recentComments"} clear ipsPad_half'>
				<span class='left' data-tooltip="{$image['_commentShort']}">{parse gallery_resize="$image['thumb']" width="thumb_small" class="ipsUserPhoto"}</span>
				<div class='list_content ipsPad_left'>
					<strong><a href='{parse url="app=core&amp;module=global&amp;section=comments&amp;parentId={$image['image_id']}&amp;fromApp=gallery-images&amp;do=findComment&amp;comment_id={$image['comment_id']}" base="public"}'>{$image['image_caption']}</a></strong>
					<br />
					<div class='ipsPad_top_bottom_half'>
						{$image['_commentShort']}
					</div>
					<div class='ipsType_smaller lighter blend_links desc'>
						<if test="hasMember:|:$image['_commentAuthor']">{parse template="userHoverCard" group="global" params="$image['_commentAuthor']"} {$this->lang->words['on']} </if>{parse date="$image['comment_post_date']" format="short"}
					</div>
				</div>
			</li>
		</foreach>
	</ul>
</div>]]></template_content>
      <template_name>miniLatestCommentBlock</template_name>
      <template_data><![CDATA[$images, $title='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_albums</template_group>
      <template_content><![CDATA[<form action="{$this->settings['base_url']}" method="post" name="theForm" id='theForm'>
	<input type="hidden" name="app" value="core" />
	<input type="hidden" name="module" value="usercp" />
	<input type="hidden" name="tab" value="gallery" />
	<input type="hidden" name="area" value="albums" />
	<input type="hidden" name="do" value="{$data['type_op']}" />
	<input type='hidden' name='auth_key' value='{$this->member->form_hash}' />
	{$data['hiddens']}
	{$data['errors']}
	
	<h3>{$this->lang->words['new_album']}</h3>
	<div class='fixed_inner'>
		<fieldset class='row1 ipsPad'>
			<ul>
				<li class='field'>
					<label for='album_name'>{$this->lang->words['album_name']}</label>
					<input type="text" size="40" maxlength="60" name="album_name" id='album_name' value="" class='input_text' />
				</li>
				<li class='field'>
					<label for='album_description'>{$this->lang->words['album_desc']}</label>
					<textarea name='album_description' rows='5' cols='60' style='width:95%' id='album_description' class='input_text'></textarea>
				</li>
				<li class='field'>
					<label for='album_category_id'>{$this->lang->words['parent_album']}</label>
					<select name='album_category_id' id='album_category_id'>
						<foreach loop="categories:$data['_catOptions'] as $_category">
							<option value='{$_category[0]}'<if test="notAvail:|:!in_array( $_category[0], $data['_acceptAlbums'] )"> disabled='disabled'</if>>{$_category[1]}</option>
						</foreach>
					</select>
				</li>
				<li class='field'>
					<select name="album_sort_options__key" id='album_sort_options__key'<if test="sortKeyEdit:|:!$data['_catDefaults']['album_sort_edit']"> disabled='disabled'</if>>
						<foreach loop="sortOptions:array('image_date','image_views','image_comments','image_rating', 'image_caption' ) as $field">
							<option value="{$field}" <if test="sortKeyDefault:|:$data['_catDefaults']['album_sort_options']['key'] == $field">selected='selected'</if>>{$this->lang->words['album_sort_' . $field ]}</option>
						</foreach>
					</select>
					<select name="album_sort_options__dir" id='album_sort_options__dir'<if test="sortOrderEdit:|:!$data['_catDefaults']['album_sort_edit']"> disabled='disabled'</if>>
						<foreach loop="dirOptions:array('asc', 'desc' ) as $field">
							<option value="{$field}" <if test="sortOrderDefault:|:$data['_catDefaults']['album_sort_options']['dir'] == $field">selected='selected'</if>>{$this->lang->words['album_sort_'.$field]}</option>
						</foreach>
					</select>
				</li>
				<li class='field checkbox'>
					<input type="radio" name="album_type" id='album_type_1' value="1" class='input_check' <if test="publicAlbum:|:$data['_catDefaults']['album_type'] == 1">checked='checked'</if><if test="blockPublicAlbum:|:!$data['_catDefaults']['album_type_edit']"> disabled='disabled'</if> />
					<label for='album_type_1'>{$this->lang->words['album_public_frm']}</label>
					<span class='desc'>{$this->lang->words['album_public_chk']}</span>
				</li>
				<if test="canDoPrivate:|:$data['_privateAllowed']">
					<li class='field checkbox' id='private_album_option'>
						<input type="radio" name="album_type" id='album_type_2' value="2" class='input_check' <if test="privateAlbum:|:$data['_catDefaults']['album_type'] == 2">checked='checked'</if><if test="blockPrivateAlbum:|:!$data['_catDefaults']['album_type_edit']"> disabled='disabled'</if> />
						<label for='album_type_2'>{$this->lang->words['private_album']}</label>
						<span class='desc'>{$this->lang->words['new_alb_prv_desc']}</span>
					</li>
				</if>
				<if test="canDoFO:|:$data['_foAllowed']">
					<li class='field checkbox' id='fo_album_option'>
						<input type="radio" name="album_type" id='album_type_3' value="3" class='input_check' <if test="fOAlbum:|:$data['_catDefaults']['album_type'] == 3">checked='checked'</if><if test="blockFOAlbum:|:!$data['_catDefaults']['album_type_edit']"> disabled='disabled'</if> />
						<label for='album_type_3'>{$this->lang->words['album_friend_only_frm']}</label>
						<span class='desc'>{$this->lang->words['album_friend_only_chk']}</span>
					</li>
				</if>
				<li class='field checkbox'>
					<input type='checkbox' value='1' class='input_check' name='album_allow_comments' id='album_allow_comments' <if test="commEdit:|:$data['_catDefaults']['album_allow_comments']">checked='checked'</if><if test="commChoose:|:!$data['_catDefaults']['album_comments_edit']"> disabled='disabled'</if> />
					<label for='album_allow_comments'>{$this->lang->words['album_frm_allow_comments']}</label>
					<span class='desc'>{$this->lang->words['album_frm_allow_commentsd']}</span>
				</li>
				<li class='field checkbox'>
					<input type='checkbox' value='1' class='input_check' name='album_allow_rating' id='album_allow_rating' <if test="rateEdit:|:$data['_catDefaults']['album_allow_rating']">checked='checked'</if><if test="rateChoose:|:!$data['_catDefaults']['album_ratings_edit']"> disabled='disabled'</if> />
					<label for='album_allow_rating'>{$this->lang->words['album_frm_allow_rating']}</label>
					<span class='desc'>{$this->lang->words['album_frm_allow_ratingd']}</span>
				</li>
				<li class='field checkbox'>
					<input type='checkbox' value='1' class='input_check' name='album_watermark' id='album_watermark' <if test="watermarkEdit:|:$data['_catDefaults']['album_watermark']">checked='checked'</if><if test="watermarkOption:|:!$data['_catDefaults']['album_watermark_edit']"> disabled='disabled'</if> />
					<label for='album_watermark'>{$this->lang->words['album_watermark_check']}</label>
					<span class='desc'>{$this->lang->words['album_watermark_check_desc']}</span>
				</li>
			</ul>
		</fieldset>
		<fieldset class='submit' id='fieldset_aSubmit'>
			<input type='submit' value="{$this->lang->words['save_ucfirst']}" class='input_submit _aSubmit' /> {$this->lang->words['or']} <a href='{parse url="app=core&amp;module=usercp&amp;tab=gallery" base="public"}' title='{$this->lang->words['cancel']}' class='cancel'>{$this->lang->words['cancel']}</a>
		</fieldset>
	</div>
</form>]]></template_content>
      <template_name>newAlbumDialogue</template_name>
      <template_data>$data=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_albums</template_group>
      <template_content><![CDATA[<script type="text/javascript">
 ipb.gallery.inSection	= 'albumOverview';
 ipb.gallery.albumId	= 0;
 ipb.gallery.albumUrl	= "";
</script>
<if test="canIUpload:|:$this->registry->gallery->helper('albums')->canCreate()">
	<ul class='topic_buttons'>
		<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image" base="public"}'>{$this->lang->words['upload']}</a></li>
	</ul>
</if>
<a href='{parse url="showuser={$data['owner']['member_id']}" seotitle="{$data['owner']['members_seo_name']}" template="showuser" base="public"}' class='ipsUserPhotoLink left'>
	<img src='{$data['owner']['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_medium' />
</a>
<div class='ipsBox_withphoto'>
	<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['member_x_albums'], IPSMember::makeProfileLink( $data['owner']['members_display_name'], $data['owner']['member_id'], $data['owner']['members_seo_name'] ) )"}</h1>
	<span class='desc'>{$this->lang->words['joined_ucfirst']}: {parse date="$data['owner']['joined']" format="joined"}</span>
</div>
<br />
<div class='ipsLayout'>
	<div class='ipsLayout_content'>
		<if test="hasAlbumPagesTop:|:$data['_albumPages']">
			{$data['_albumPages']}<br class='clear' />
		</if>
		
		{parse template="album_listing" group="gallery_home" params="$albums, array(), array( 'url' => 'app=gallery&amp;user=' . $data['owner']['member_id'], 'title' => $data['owner']['members_seo_name'], 'template' => 'useralbum', 'sort_key' => 'album_name', 'sort_dir' => 'asc' )"}
		<if test="hasAlbumPagesBottom:|:$data['_albumPages']">
			{$data['_albumPages']}
		</if>
		<br />
		<if test="hasImagePagesTop:|:$data['_imagePages']">
			{$data['_imagePages']}<br class='clear' />
		</if>
		
		{parse template="image_listing" group="gallery_home" params="$images, array(), array(), array( 'url' => 'app=gallery&amp;user=' . $data['owner']['member_id'], 'title' => $data['owner']['members_seo_name'], 'template' => 'useralbum', 'sort_key' => 'image_date', 'sort_dir' => 'desc' )"}
		<if test="hasImagePagesTop:|:$data['_imagePages']">
			{$data['_imagePages']}
		</if>
	</div>
</div>
<br />]]></template_content>
      <template_name>userGalleryView</template_name>
      <template_data>$data, $images, $albums</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_gallery_external">
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[<link rel="stylesheet" type='text/css' href='{$this->settings['public_dir']}style_css/{$this->registry->output->skin['_csscacheid']}/ipgallery.css' />
<style type="text/css">
.inlineimage img {
	float: right;
	width: 30px;
	height: 30px;
	padding-left: 5px;
}
</style>
<tr class='{parse striping="catTable"}'>
	<td class='col_f_views' align='center'>
		{parse gallery_resize="$data['thumb']" width="thumb_medium"}
	</td>
	<td class='col_c_forum'>
		<if test="isAlbumRating:|:$type == 'album'">
			<span class='right'>
				<foreach loop="ratingLoop:array(1,2,3,4,5) as $_rating">
					<if test="albumrate:|:$data['album_rating_aggregate'] >= $_rating">{parse replacement="mini_rate_on"}<else />{parse replacement="mini_rate_off"}</if>
				</foreach>
			</span>
		</if>
		
		<h4>
			<if test="isAlbumLink:|:$type == 'album'">
				<a href='{parse url="app=gallery&amp;album={$data['album_id']}" base="public" template="viewalbum" seotitle="{$data['album_name_seo']}"}'>{IPSText::truncate( $data['album_name'], 150 )}</a>
			<else />
				<a href='{parse url="app=gallery&amp;category={$data['category_id']}" base="public" template="viewcategory" seotitle="{$data['category_name_seo']}"}'>{IPSText::truncate( $data['category_name'], 150 )}</a>
			</if>
		</h4>
		<p class='desc lighter blend_links toggle_notify_off'>
			<if test="isAlbumDescription:|:$type == 'album'">
				<if test="hasDescription:|:$data['album_description']">{IPSText::truncate( strip_tags( IPSText::getTextClass('bbcode')->stripAllTags( $data['album_description'] ), '<br />' ), 230 )}<else />&nbsp;</if>
			<else />
				<if test="hasDescription:|:$data['category_description']">{IPSText::truncate( strip_tags( IPSText::getTextClass('bbcode')->stripAllTags( $data['category_description'] ), '<br />' ), 230 )}<else />&nbsp;</if>
			</if>
		</p>
	</td>
	<td class='col_c_stats'>
		<ul>
			<li>{parse format_number="$data['_totalImages']"} {$this->lang->words['images_lower']}</li>
			<li class='views desc'>{parse format_number="$data['_totalComments']"} {$this->lang->words['comments_lower']}</li>
		</ul>
	</td>
	<td class='col_c_post'>
		<a href='{parse url="showuser={$data['member_id']}" seotitle="{$data['members_seo_name']}" template="showuser" base="public"}' class='ipsUserPhotoLink left'>
			<img src='{$data['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_mini' />
		</a>
		<ul class='last_post ipsType_small'>
			<li>{parse template="userHoverCard" group="global" params="$data"}</li>
			<li><if test="isAlbumDescription:|:$type == 'album'">{parse date="$data['album_last_img_date']" format="DATE"}<else />{parse date="$data['category_last_img_date']" format="DATE"}</if></li>
		</ul>
	</td>
</tr>]]></template_content>
      <template_name>boardIndexEntry</template_name>
      <template_data><![CDATA[$data, $type='category']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[<fieldset class='{parse striping="search"}'>
	<span class='search_msg'>
		{$this->lang->words['s_gallery_desc']}
	</span>
	<ul class='ipsForm_horizontal'>
		<if test="hasOptions:|:count($options)">
			<li class='ipsField ipsField_select clear'>
				<label class='ipsField_title' for='category_filter'>{$this->lang->words['find_in_category']}</label>
				<p class='ipsField_content'>
					<select name='search_app_filters[gallery][categoryids][]' class='input input_select' size='6' multiple='multiple' id='category_filter'>
						<foreach loop="categories:$options as $option">
							<option value='{$option[0]}'>{$option[1]}</option>
						</foreach>
					</select>
				</p>
			</li>
		</if>
		<li class='ipsField ipsField_checkbox clear'>
			<input type='checkbox' id='exclude_categories' name='search_app_filters[gallery][excludeCategories]' value='1' class='input_check' />
			<label for='exclude_categories'>{$this->lang->words['find_in_albums']}</label>
		</li>
	</ul>
</fieldset>
<br />]]></template_content>
      <template_name>galleryAdvancedSearchFilters</template_name>
      <template_data>$options</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[<tr class='_recordRow {parse striping="searchResults"}'>
	<td class='col_f_views short altrow'>
		{parse gallery_resize="$data['thumb']" width="thumb_medium"}
	</td>
	<td>
		<span class='right'>
			<foreach loop="ratingLoop:array(1,2,3,4,5) as $_rating">
				<if test="albumrate:|:$data['album_rating_aggregate'] >= $_rating">{parse replacement="mini_rate_on"}<else />{parse replacement="mini_rate_off"}</if>
			</foreach>
		</span>
		
		<h4>
			<a href='{parse url="app=gallery&amp;album={$data['album_id']}" base="public" template="viewalbum" seotitle="{$data['album_name_seo']}"}'>{IPSText::truncate( $data['album_name'], 150 )}</a>
		</h4>
		<p class='desc lighter blend_links toggle_notify_off'>
			<if test="hasDescription:|:$data['album_description']">{IPSText::truncate( strip_tags( IPSText::getTextClass('bbcode')->stripAllTags( $data['album_description'] ), '<br />' ), 230 )}<else />&nbsp;</if>
		</p>
		
		<if test="isFollowedStuff:|:count($data['_followData'])">
			{parse template="followData" group="search" params="$data['_followData']"}
		</if>
	</td>
	<td class='col_f_views'>
		<ul>
			<li>{parse format_number="$data['_totalImages']"} {$this->lang->words['images_lower']}</li>
			<li class='views desc'>{parse format_number="$data['_totalComments']"} {$this->lang->words['comments_lower']}</li>
		</ul>
	</td>
	<td class='col_f_post'>
		<a href='{parse url="showuser={$data['member_id']}" seotitle="{$data['members_seo_name']}" template="showuser" base="public"}' class='ipsUserPhotoLink left'>
			<img src='{$data['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_mini' />
		</a>
		<ul class='last_post ipsType_small'>
			<li>{parse template="userHoverCard" group="global" params="$data"}</li>
			<li>{parse date="$data['album_last_img_date']" format="DATE"}</li>
		</ul>
	</td>
	<if test="isFollowedStuff:|:count($data['_followData'])">
		<td class='col_f_mod'>
			<a href='#' class='ipsButton_secondary no_width ipbmenu' id='change_{$data['album_id']}'>{$this->lang->words['followed_changeopts']}</a>
			<input class='input_check checkall toggle_notify_on' type="checkbox" name="likes[]" value="{$data['_followData']['like_app']}-{$data['_followData']['like_area']}-{$data['_followData']['like_rel_id']}" />
			<div class='ipbmenu_content' id='change_{$data['album_id']}_menucontent' style='display: none; width: 400px; padding: 5px;'>
				<select name='modaction_row' class='input_select' id='form_change_{$data['album_id']}'>
					<option value=''>{$this->lang->words['like_mod__chose']}</option>
					<option value='delete'>{$this->lang->words['like_mod__delete']}</option>
					<option value='change-donotify'>{$this->lang->words['like_mod__change_donotify']}</option>
					<option value='change-donotnotify'>{$this->lang->words['like_mod__change_nonotify']}</option>
					<option value='change-immediate'>{$this->lang->words['like_mod__change_immediate']}</option>
					<option value='change-offline'>{$this->lang->words['like_mod__change_offline']}</option>
					<if test="forumsDigests:|:$this->request['search_app'] == 'forums'">
						<option value='change-daily'>{$this->lang->words['like_mod__change_daily']}</option>
						<option value='change-weekly'>{$this->lang->words['like_mod__change_weekly']}</option>
					</if>
					<option value='change-anon'>{$this->lang->words['like_mod__change_anon']}</option>
					<option value='change-noanon'>{$this->lang->words['like_mod__change_noanon']}</option>
				</select>
					
				<input type="submit" class="input_submit submit_modaction_row" value="{$this->lang->words['update_selected']}" />
			</div>
		</td>
	</if>
</tr>]]></template_content>
      <template_name>galleryAlbumSearchResult</template_name>
      <template_data>$data, $resultAsTitle=false</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[<tr class='{parse striping="searchResults"}'>
	<td class='col_f_views short altrow'>
		{parse gallery_resize="$data['thumb']" width="thumb_medium"}
	</td>
	<td>
		<span class='right'>
			<foreach loop="ratingLoop:array(1,2,3,4,5) as $_rating">
				<if test="imagerate:|:$data['image_rating'] >= $_rating">{parse replacement="mini_rate_on"}<else />{parse replacement="mini_rate_off"}</if>
			</foreach>
		</span>
		
		<h4><a href='{parse url="app=gallery&amp;image={$data['image_id']}" base="public" template="viewimage" seotitle="{$data['image_caption_seo']}"}' title='{$data['image_caption']}'>{IPSText::truncate( $data['image_caption'], 100 )}</a></h4>
		<span class='desc blend_links'>
			<span class='desc lighter'>{$this->lang->words['in_lower']}</span>
			<if test="isInAlbum:|:$data['image_album_id']">
				<a href='{parse url="app=gallery&amp;album={$data['album_id']}" base="public" template="viewalbum" seotitle="{$data['album_name_seo']}"}' title='{$data['album_name']}'>{IPSText::truncate( $data['album_name'], 75)}</a>
			<else />
				<a href='{parse url="app=gallery&amp;category={$data['category_id']}" base="public" template="viewcategory" seotitle="{$data['category_name_seo']}"}' title='{$data['category_name']}'>{IPSText::truncate( $data['category_name'], 75)}</a>
			</if>
		</span>
		<p class='desc lighter blend_links'>{$data['content']}</p>
	</td>
	<td class='col_f_views'>
		<ul>
			<li>{parse format_number="$data['image_comments']"} {$this->lang->words['comments_lower']}</li>
			<li class='views desc'>{parse format_number="$data['image_views']"} {$this->lang->words['views_lower']}</li>
		</ul>
	</td>
	<td class='col_f_post'>
		<if test="memberImage:|:$data['member_id']"><a href='{parse url="showuser={$data['member_id']}" seotitle="{$data['members_seo_name']}" template="showuser" base="public"}' class='ipsUserPhotoLink left'></if>
			<img src='{$data['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_mini<if test="nomemberImage:|:!$data['member_id']"> left</if>' />
		<if test="memberImage2:|:$data['member_id']"></a></if>
		<ul class='last_post ipsType_small'>
			<li>{parse template="userHoverCard" group="global" params="$data"}</li>
			<li>{parse date="$data['comment_post_date']" format="short"}</li>
		</ul>
	</td>
</tr>]]></template_content>
      <template_name>galleryCommentSearchResult</template_name>
      <template_data>$data, $resultAsTitle=false</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[<tr class='_recordRow {parse striping="searchResults"}<if test="imageIsUnapproved:|:$data['image_approved'] < 1"> moderated</if>'>
	<td class='col_f_views short altrow'>
		{parse gallery_resize="$data['thumb']" width="thumb_medium"}
	</td>
	<td>
		<span class='right'>
			<foreach loop="ratingLoop:array(1,2,3,4,5) as $_rating">
				<if test="imagerate:|:$data['image_rating'] >= $_rating">{parse replacement="mini_rate_on"}<else />{parse replacement="mini_rate_off"}</if>
			</foreach>
		</span>
		
		<h4><a href='{parse url="app=gallery&amp;image={$data['image_id']}" base="public" template="viewimage" seotitle="{$data['image_caption_seo']}"}' title='{$data['image_caption']}'>{IPSText::truncate( $data['image_caption'], 100 )}</a></h4>
		<span class='desc blend_links'>
			<span class='desc lighter'>{$this->lang->words['in_lower']}</span> 
			<if test="isInAlbum:|:$data['image_album_id']">
				<a href='{parse url="app=gallery&amp;album={$data['album_id']}" base="public" template="viewalbum" seotitle="{$data['album_name_seo']}"}' title='{$data['album_name']}'>{IPSText::truncate( $data['album_name'], 75)}</a>
			<else />
				<a href='{parse url="app=gallery&amp;category={$data['category_id']}" base="public" template="viewcategory" seotitle="{$data['category_name_seo']}"}' title='{$data['category_name']}'>{IPSText::truncate( $data['category_name'], 75)}</a>
			</if>
		</span>
		<p class='desc lighter blend_links toggle_notify_off'>
			<if test="hasDescription:|:$data['image_description']">{IPSText::truncate( strip_tags( IPSText::getTextClass('bbcode')->stripAllTags( $data['image_description'] ), '<br />' ), 230 )}<else />&nbsp;</if>
		</p>
		<if test="isFollowedStuff:|:count($data['_followData'])">
			{parse template="followData" group="search" params="$data['_followData']"}
		</if>
		<if test="hasTags:|:count($data['tags']['formatted'])">
			<img src='{$this->settings['img_url']}/icon_tag.png' /> {$data['tags']['formatted']['truncatedWithLinks']}
		</if>
		
	</td>
	<td class='col_f_views'>
		<ul>
			<li>{parse format_number="$data['image_comments']"} {$this->lang->words['comments_lower']}</li>
			<li class='views desc'>{parse format_number="$data['image_views']"} {$this->lang->words['views_lower']}</li>
		</ul>
	</td>
	<td class='col_f_post'>
		<if test="memberImage:|:$data['member_id']"><a href='{parse url="showuser={$data['member_id']}" seotitle="{$data['members_seo_name']}" template="showuser" base="public"}' class='ipsUserPhotoLink left'></if>
			<img src='{$data['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_mini<if test="nomemberImage:|:!$data['member_id']"> left</if>' />
		<if test="memberImage2:|:$data['member_id']"></a></if>
		<ul class='last_post ipsType_small'>
			<li>{parse template="userHoverCard" group="global" params="$data"}</li>
			<li>{parse date="$data['image_date']" format="DATE"}</li>
		</ul>
	</td>
	<if test="isFollowedStuff:|:count($data['_followData'])">
		<td class='col_f_mod'>
			<a href='#' class='ipsButton_secondary no_width ipbmenu' id='change_{$data['image_id']}'>{$this->lang->words['followed_changeopts']}</a>
			<input class='input_check checkall toggle_notify_on' type="checkbox" name="likes[]" value="{$data['_followData']['like_app']}-{$data['_followData']['like_area']}-{$data['_followData']['like_rel_id']}" />
			<div class='ipbmenu_content' id='change_{$data['image_id']}_menucontent' style='display: none; width: 400px; padding: 5px;'>
				<select name='modaction_row' class='input_select' id='form_change_{$data['image_id']}'>
					<option value=''>{$this->lang->words['like_mod__chose']}</option>
					<option value='delete'>{$this->lang->words['like_mod__delete']}</option>
					<option value='change-donotify'>{$this->lang->words['like_mod__change_donotify']}</option>
					<option value='change-donotnotify'>{$this->lang->words['like_mod__change_nonotify']}</option>
					<option value='change-immediate'>{$this->lang->words['like_mod__change_immediate']}</option>
					<option value='change-offline'>{$this->lang->words['like_mod__change_offline']}</option>
					<if test="forumsDigests:|:$this->request['search_app'] == 'forums'">
						<option value='change-daily'>{$this->lang->words['like_mod__change_daily']}</option>
						<option value='change-weekly'>{$this->lang->words['like_mod__change_weekly']}</option>
					</if>
					<option value='change-anon'>{$this->lang->words['like_mod__change_anon']}</option>
					<option value='change-noanon'>{$this->lang->words['like_mod__change_noanon']}</option>
				</select>
					
				<input type="submit" class="input_submit submit_modaction_row" value="{$this->lang->words['update_selected']}" />
			</div>
		</td>
	</if>
</tr>]]></template_content>
      <template_name>galleryImageSearchResult</template_name>
      <template_data>$data, $resultAsTitle=false</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[{parse template="galleryCss" group="gallery_global" params=""}
{parse striping="albumData" classes="row1,row2"}
<if test="hasAnything:|: ! count( $albums ) && ! count( $images )">
	<div class='no_messages'>{$this->lang->words['gallery_prof_tabs_aint_none']}</div>
</if>
<if test="hasAlbums:|:count($albums)">
	<h3 class='maintitle clearfix'>
		<if test="hasMoreAlbums:|:$hasMore">
			<span class='right ipsType_small'>
				<a href="{parse url="app=gallery&amp;user={$member['member_id']}" seotitle="{$member['members_seo_name']}" template="useralbum" base="public"}">{$this->lang->words['view_all_albums']}</a>
			</span>
			{parse expression="sprintf( $this->lang->words['last_x_albums'], count($albums) )"}
		<else />
			{$this->lang->words['advsearch_albums']}
		</if>
	</h3>
	<div class='ipsBox'>
		<div class='ipsBox_container'>
			<table class='ipb_table'>
				<foreach loop="albumsLoop:$albums as $id => $data">
					{parse template="galleryAlbumSearchResult" group="gallery_external" params="$data"}
				</foreach>
			</table>
		</div>
	</div>
	<br />
</if>
<if test="hasImages:|:count($images)">
	<h3 class='maintitle clearfix'>{$this->lang->words['advsearch_images']}</h3>
	<div class='ipsBox'>
		<div class='ipsBox_container'>
			<table class='ipb_table'>
				<foreach loop="imagesLoop:$images as $id => $data">
					{parse template="galleryImageSearchResult" group="gallery_external" params="$data"}
				</foreach>
			</table>
		</div>
	</div>
</if>]]></template_content>
      <template_name>profileBlock</template_name>
      <template_data>$member, $albums=array(), $images=array(), $hasMore=false</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[{parse template="galleryCss" group="gallery_global" params=""}
<if test="hasResults:|:count($results)">
	<table class='ipb_table'>
		<foreach loop="results:$results as $result">
			{$result['html']}
		</foreach>
	</table>
</if>]]></template_content>
      <template_name>searchResultsAsGallery</template_name>
      <template_data><![CDATA[$results, $titlesOnly='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[<div class='ipsBox'>
	<foreach loop="$results as $data">
		<if test="$data['type'] == 'comment_id'">
			<div class='post_block hentry clear no_sidebar ipsBox_container'>
				<div class='post_wrap'>
					<if test="postMid:|:$data['comment_author_id']">
						<h3 class='row2'>
					<else />
						<h3 class='guest row2'>
					</if>
						<a href="{parse url="app=gallery&amp;image={$data['image_id']}" template="viewimage" seotitle="{$data['image_caption_seo']}" base="public"}">{IPSText::truncate( $data['image_caption'], 80)}</a>
					</h3>
					<div class='post_body'>
						<p class='posted_info desc lighter ipsType_small'>
							<img src='{$data['pp_thumb_photo']}' class='ipsUserPhoto ipsUserPhoto_tiny' /> {$this->lang->words['posted']} {$this->lang->words['by']}
							<if test="postMember:|:$data['member_id']"><span class="author vcard">{parse template="userHoverCard" group="global" params="$data"}</span><else />{$data['members_display_name']}</if>
							{$this->lang->words['on']} <abbr class="published" title="{parse expression="date( 'c', $data['comment_post_date'] )"}">{parse date="$data['comment_post_date']" format="long"}</abbr>
							{$this->lang->words['in_lower']}
							<a href="{parse url="app=gallery&amp;image={$data['image_id']}" template="viewimage" seotitle="{$data['image_caption_seo']}" base="public"}">{$data['image_caption']}</a>
						</p>
						<div class='post entry-content clearfix'>
							{$data['comment_text']}
							<br />
							{parse template="repButtons" group="global_other" params="$data, array_merge( array( 'primaryId' => $data['comment_id'], 'domLikeStripId' => 'like_comment_id_' . $data['comment_id'], 'domCountId' => 'rep_comment_id_' . $data['comment_id'], 'app' => 'gallery', 'type' => 'comment_id', 'likeFormatted' => $data['repButtons']['formatted'] ), $data )"}
						</div>
					</div>
				</div>
				<br />
			</div>
			<br />
		<else />
			<div class='post_block hentry clear no_sidebar ipsBox_container'>
				<div class='post_wrap'>
					<if test="postMid:|:$data['image_member_id']">
						<h3 class='row2'>
					<else />
						<h3 class='guest row2'>
					</if>
						<a href="{parse url="app=gallery&amp;image={$data['image_id']}" template="viewimage" seotitle="{$data['image_caption_seo']}" base="public"}">{IPSText::truncate( $data['image_caption'], 80)}</a>
					</h3>
					<div class='post_body'>
						<p class='posted_info desc lighter ipsType_small'>
							<img src='{$data['pp_thumb_photo']}' class='ipsUserPhoto ipsUserPhoto_tiny' /> {$this->lang->words['posted']} {$this->lang->words['by']}
							<if test="postMember:|:$data['member_id']"><span class="author vcard">{parse template="userHoverCard" group="global" params="$data"}</span><else />{$data['members_display_name']}</if>
							{$this->lang->words['on']} <abbr class="published" title="{parse expression="date( 'c', $data['image_date'] )"}">{parse date="$data['image_date']" format="long"}</abbr>
						</p>
						<div class='post entry-content clearfix'>
							<div class='left' style='margin-right: 6px;'>{$data['thumb']}</div>
							{$data['image_description']}
							<br class='clear' />
							{parse template="repButtons" group="global_other" params="$data, array_merge( array( 'primaryId' => $data['image_id'], 'domLikeStripId' => 'like_event_id_' . $data['image_id'], 'domCountId' => 'rep_event_id_' . $data['image_id'], 'app' => 'gallery', 'type' => 'image_id', 'likeFormatted' => $data['repButtons']['formatted'] ), $data )"}
						</div>
					</div>
				</div>
				<br />
			</div>
			<br />
		</if>
	</foreach>
</div>]]></template_content>
      <template_name>tabReputation_gallery</template_name>
      <template_data>$results</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[{parse template="subTabLoop" group="modcp" params=""}
<div class='clearfix'>
	<if test="hasPosts:|:is_array( $comments ) AND count( $comments )">
		<div id='ips_Posts2'>
			<foreach loop="post_data:$comments as $comment">
				<div class='post_block hentry clear no_sidebar'>
					<div class='post_wrap'>
						<if test="postMid:|:$comment['member_id']">
						<h3 class='row2'>
						<else />
						<h3 class='guest row2'>
						</if>
							<img src='{$comment['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_tiny' />&nbsp;
							<if test="postMember:|:$comment['member_id']">
								<span class="author vcard">{parse template="userHoverCard" group="global" params="$comment"}</span>
							<else />
								{parse template="userHoverCard" group="global" params="$comment"}
							</if>
						</h3>
						
						<div class='post_body'>
							<ul class='ipsList_inline modcp_post_controls'>
								<li class='post_edit'>
									<a href='{parse url="app=core&module=global&section=comments&do=showEdit&comment_id={$comment['comment_id']}&parentId={$comment['comment_img_id']}&fromApp=gallery-images&modcp=gallerycomments" base="public"}' title='{$this->lang->words['post_edit_title']}' class='ipsButton_secondary ipsType_smaller' id='edit_post_{$comment['comment_id']}'>{$this->lang->words['post_edit']}</a>
								</li>
								<li>
									<a href='{parse url="app=core&amp;module=global&amp;section=comments&amp;do=approve&amp;comment_id={$comment['comment_id']}&amp;parentId={$comment['comment_img_id']}&amp;fromApp=gallery-images&amp;modcp=gallerycomments&amp;auth_key={$this->member->form_hash}" base="public"}' title='{$this->lang->words['post_toggle_visible']}' class='ipsButton_secondary ipsType_smaller'>{$this->lang->words['post_approve']}</span></a>
								</li>
								<li class='post_del'>
									<a href='{parse url="app=core&amp;module=global&amp;section=comments&amp;do=delete&amp;comment_id={$comment['comment_id']}&amp;parentId={$comment['comment_img_id']}&amp;fromApp=gallery-images&amp;modcp=gallerycomments&amp;auth_key={$this->member->form_hash}" base="public"}' title='{$this->lang->words['post_delete_title']}' class='delete_post ipsButton_secondary important ipsType_smaller'>{$this->lang->words['post_delete']}</a>
								</li>
								<li class='desc'>
									<strong>{$this->lang->words['posted']}:</strong> <a rel='bookmark' class='desc lighter ipsType_smaller' href='{parse url="app=core&amp;module=global&amp;section=comments&amp;do=findComment&amp;comment_id={$comment['comment_id']}&amp;parentId={$comment['comment_img_id']}&amp;fromApp=gallery-images" base="public"}' title='{$this->lang->words['comment_permalink']}'>{parse date="$comment['comment_post_date']" format="short"}</a>
								</li>
								<li class='desc'>
									<strong>{$this->lang->words['modcp_gal_caption']}:</strong> <a class='desc lighter ipsType_smaller' href='{parse url="app=gallery&amp;image={$comment['image__id']}" seotitle="{$comment['image_caption_seo']}" template="viewimage" base="public"}'><if test="inAlbum:|:$comment['album_id']">{$comment['album_name']}<else />{$comment['category_name']}</if> &rarr; {IPSText::truncate( $comment['image_caption'], 35 )}</a>
								</li>
							</ul>
							<div class='post entry-content'>
								{$comment['comment_text']}
							</div>
							<br />
						</div>
					</div>
				</div>
			</foreach>
		</div>
	<else />
		<div class='no_messages'>
			{$this->lang->words['no_modcp_comments']}
		</div>
	</if>
	<div>{$pagelinks}</div>
</div>]]></template_content>
      <template_name>unapprovedComments</template_name>
      <template_data>$comments</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[{parse template="subTabLoop" group="modcp" params=""}
<div class='clearfix'>
	<if test="hasPosts:|:is_array( $images ) AND count( $images )">
		<div id='ips_Posts2'>
			<foreach loop="post_data:$images as $image">
				<div class='post_block hentry clear no_sidebar'>
					<div class='post_wrap'>
						<if test="postMid:|:$image['member_id']">
							<h3 class='row2'>
						<else />
							<h3 class='guest row2'>
						</if>
							<img src='{$image['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_tiny' />&nbsp;
							<if test="postMember:|:$image['member_id']">
								<span class="author vcard">{parse template="userHoverCard" group="global" params="$image"}</span>
							<else />
								{parse template="userHoverCard" group="global" params="$image"}
							</if>
						</h3>
						
						<div class='post_body'>
							<ul class='ipsList_inline modcp_post_controls'>
								<li>
									<a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=approveToggle&amp;val=1&amp;imageid={$image['image_id']}&amp;modcp=<if test="hiddenLink:|:$isHiddenTab">hiddenimages<else />galleryimages</if>&amp;auth_key={$this->member->form_hash}" base="public"}' title='{$this->lang->words['post_toggle_visible']}' class='ipsButton_secondary ipsType_smaller'><if test="hidden:|:$isHiddenTab">{$this->lang->words['restore_topic']}<else />{$this->lang->words['post_approve']}</if></span></a>
								</li>
								<li class='post_del'>
									<a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=delete&amp;imageid={$image['image_id']}&amp;modcp=galleryimages&amp;auth_key={$this->member->form_hash}" base="public"}' title='{$this->lang->words['post_delete_title']}' class='delete_img ipsButton_secondary important ipsType_smaller'>{$this->lang->words['post_delete']}</a>
								</li>
								<li class='desc'>
									<strong>{$this->lang->words['posted']}:</strong> {parse date="$image['image_date']" format="short"}
								</li>
								<li class='desc'>
									<strong>{$this->lang->words['modcp_gal_caption']}:</strong> <a class='desc lighter ipsType_smaller' href='{parse url="app=gallery&amp;image={$image['image_id']}" seotitle="{$image['image_caption_seo']}" template="viewimage" base="public"}'><if test="inAlbum:|:$image['album_id']">{$image['album_name']}<else />{$image['category_name']}</if> &rarr; {IPSText::truncate( $image['image_caption'], 35 )}</a>
								</li>
							</ul>
							<div class='post entry-content'>
								{$image['tag']}
								<if test="hasDesc:|:$image['image_description']"><p class='ipsPad'>{$image['image_description']}</p></if>
							</div>
							<br />
						</div>
					</div>
				</div>
			</foreach>
		</div>
	<else />
		<div class='no_messages'>
			<if test="hiddenNone:|:$isHiddenTab">{$this->lang->words['no_hidden_images']}<else />{$this->lang->words['no_modcp_images']}</if>
		</div>
	</if>
	<div>{$pagelinks}</div>
</div>
<script type="text/javascript">
ipb.delegate.register('.delete_img', deletePopUp );
function deletePopUp(e, elem)
{
	Event.stop(e);
	
	if ( confirm( ipb.lang['delete_confirm'] ) )
	{
		window.location = elem.href;
	}
	return false;
}
</script>]]></template_content>
      <template_name>unapprovedImages</template_name>
      <template_data>$images, $isHiddenTab=false</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_external</template_group>
      <template_content><![CDATA[{parse template="galleryCss" group="gallery_global" params=""}
{parse js_module="gallery"}
<if test="canIuploadDearSirWellCanI:|:$this->registry->gallery->helper('albums')->canCreate()">
	<ul class='topic_buttons'>
		<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image" base="public"}'>{$this->lang->words['container_noup_title']}</a></li>
	</ul>
</if>
<h3 class='ipsType_subtitle ipsSettings_pagetitle'>{$this->lang->words['your_albums']}</h3>
<br class='clear' />
<fieldset>
	<if test="hasalbums:|:count( $rows )">
		<table class='ipb_table'>
			{parse striping="albums" classes="row2,row1"}
			<foreach loop="albums:$rows as $data">
				<tr class='{parse striping="albums"}'>
					<td class='col_f_views'>{parse gallery_resize="$data['thumb']" width="thumb_medium"}</td>
					<td>
						<ul class='ipsList_inline right'>
							<if test="canUploadToAlbum:|:$this->registry->gallery->helper('albums')->isUploadable( $data )">
								<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image&amp;album_id={$data['album_id']}" base="public"}' title='{$this->lang->words['upload']}' class='ipsButton_secondary'>{parse replacement="gallery_image"}</a></li>
							</if>
							<if test="canUploadToAlbum:|:$this->registry->gallery->helper('albums')->canEdit($data)">
								<li><a href='{parse url="app=gallery&amp;albumedit={$data['album_id']}" base="public" template="editalbum" seotitle="{$data['album_name_seo']}"}' class='ipsButton_secondary' title='{$this->lang->words['edit']}'>{parse replacement="galery_album_edit"}</a></li>
							</if>
							<if test="canUploadToAlbum:|:$this->registry->gallery->helper('albums')->canDelete($data)">
								<li><a href="javascript:void(0);" album-id="{$data['album_id']}" class="ipsButton_secondary _albumDelete" title='{$this->lang->words['delete_link']}'>{parse replacement="gallery_album_delete"}</a></li>
							</if>
						</ul>
						<if test="albumIsFriendOnly:|:$this->registry->gallery->helper('albums')->isFriends($data)">
							<span class='ipsBadge ipsBadge_green reset_cursor' data-tooltip='{$this->lang->words['friend_only_prefix_desc']}' title='{$this->lang->words['friend_only_prefix_desc']}'>{$this->lang->words['friend_only_prefix']}</span>&nbsp;
						</if>
						<if test="albumIsPrivate:|:$this->registry->gallery->helper('albums')->isPrivate($data)">
							<span class='ipsBadge ipsBadge_red reset_cursor'>{$this->lang->words['private_ucfirst']}</span>&nbsp;
						</if>
						<strong><a href='{parse url="app=gallery&amp;album={$data['album_id']}" base="public" template="viewalbum" seotitle="{$data['album_name_seo']}"}'>{$data['album_name']}</a></strong>
						
						<if test="hasDescription:|:$data['album_description']">
							<div class='album_desc'>
								{parse expression="IPSText::truncate( strip_tags( IPSText::getTextClass('bbcode')->stripAllTags( $data['album_description'] ), '<br />' ), 200 )"}
							</div>
						</if>
					</td>
					<td class='col_c_post desc'>
						<strong>{$data['album_count_imgs']}<if test="$data['mod_images']"> <em class='moderated inline-moderated'>(+ {$data['mod_images']} {$this->lang->words['queued_suffix']})</em></if></strong> {$this->lang->words['images']}<br />
						<strong>{$data['album_count_comments']}<if test="$data['mod_comments']"> <em class='moderated inline-moderated'>(+ {$data['mod_comments']} {$this->lang->words['queued_suffix']})</em></if></strong> {$this->lang->words['comments']}
						<if test="haslastimage:|:$data['album_last_img_date']">
								<br /><br />
								<a href="{parse url="app=gallery&amp;module=albums&amp;section=rss&amp;type=album&amp;typeid={$data['album_id']}" base="public" template="galleryrss" seotitle="{$data['album_name_seo']}"}"><img src="{$this->settings['img_url']}/rss-mini.png" alt="{$this->lang->words['rss_feed']}" /></a>
								{$this->lang->words['last_upload']}: {parse gallery_resize="$data['_latestThumb']" width="thumb_teeny"} {parse date="$data['album_last_img_date']" format="DATE"}
						</if>
					</td>
				</tr>
			</foreach>
		</table>
	<else />
		<p class='no_messages'>{$this->lang->words['no_album']}</p>
	</if>
</fieldset>]]></template_content>
      <template_name>userCpAlbumIndexView</template_name>
      <template_data>$rows=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_gallery_global">
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<div class='_sharedMediaBbcode'>
	<div class='bbcode_mediaWrap clearfix'>
		<a href="{parse url="app=gallery&amp;album={$album['album_id']}" base="public" template="viewalbum" seotitle="{$album['album_name_seo']}"}">{$album['thumb']}</a>
		<div class='details'>
			<h5><a href="{parse url="app=gallery&amp;album={$album['album_id']}" base="public" template="viewalbum" seotitle="{$album['album_name_seo']}"}">{$this->lang->words['album_ucfirst']}: {$album['album_name']}</a></h5>
			<div>{$album['album_count_imgs']} {$this->lang->words['images_lower']}</div>
			<div>{$album['album_count_comments']} {$this->lang->words['comments_lower']}</div>
		</div>
	</div>
</div>
<br />]]></template_content>
      <template_name>bbCodeAlbum</template_name>
      <template_data>$album</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<!-- bbcodeImage-js (do not remove or edit this tag) -->
<a href="{parse url="app=gallery&amp;image={$image['image_id']}" base="public" template="viewimage" seotitle="{$image['image_caption_seo']}"}" title="{$image['image_caption']}">{$image['thumb']}</a>
<br />]]></template_content>
      <template_name>bbCodeImage</template_name>
      <template_data>$image</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<div id='lightbox_wrap'>
	<a href='#' id='close_lightbox'>&times;</a>
	<div id='imageErrorWrap'>
		<h2 class='ipsType_pagetitle'>{$this->lang->words['no_permission_bbcodeajaximage']}</h2>
	</div>
</div>]]></template_content>
      <template_name>bbCodeImageNoPermission</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<link rel="stylesheet" type="text/css" media="screen" href="{$this->settings['public_dir']}style_css/{$this->registry->output->skin['_csscacheid']}/ipgallery.css" />]]></template_content>
      <template_name>galleryCss</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<!-- Show inline warning -->
<div class='message unspecific'>
	<strong>{$data['title']}</strong><br />
	{$data['body']}
</div>]]></template_content>
      <template_name>general_warning</template_name>
      <template_data><![CDATA[$data='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[{parse js_module="gallery"}
{parse js_module="rating"}
{parse striping="imagelisting" classes="row1,row2"}
{parse template="include_lightbox" group="global" params=""}
{parse template="include_highlighter" group="global" params="1"}
<script type='text/javascript'>
ipb.vars['members_gallery']	= '{$this->settings['gallery_members_album']}';
ipb.lang['hidden']				= "{$this->lang->words['image_hidden']}";
</script>
<!--[if lte IE 8]>
	<style type='text/css'>
		.gallery_category > div {
			padding: 0px;
			border: 1px solid #000;
		}
		.gallery_category h2 {
			background: #000;
			top: 0px;
			right: 0px;
			left: 0px;
		}

		.gallery_category .gallery_item_info {
			margin-left: 5px;
			margin-right: 5px;
			margin-bottom: 5px;
		}
	</style>
<![endif]-->]]></template_content>
      <template_name>globals</template_name>
      <template_data><![CDATA[$data='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<style type="text/css">
#appGallLatestHook
{
	overflow:auto;
	overflow-y: hidden;
	height: 117px;
}
	#appGallLatestHook a {
		display: block;
	}
	
	#appGallLatestHook ul li img
	{
		max-width: 100px;
		max-height: 100px;
	}
		
		#appGallLatestHook ul li:last-child { margin-right: 10px; }
</style>
<div id='category_gallrecent' class='category_block block_wrap'>
	<h3 class='maintitle'>
		<a class='toggle right' href='#' title="{$this->lang->words['toggle_ucfirst']}">{$this->lang->words['toggle_ucfirst']}</a> <a href="{parse url="app=gallery" seotitle="false" template="app=gallery" base="public"}">{$this->lang->words['recent_gallery_images']}</a>
	</h3>
	<div id='appGallLatestHook' class='ipsBox table_wrap'>
		<ul class='ipsList_inline ipsList_nowrap'>
			<foreach loop="gallery_images_hook:$rows as $r">
				<li>{$r['thumb']}</li>
			</foreach>
		</ul>
	</div>
</div>
<br />]]></template_content>
      <template_name>hookRecentGalleryImages</template_name>
      <template_data>$rows</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[{parse js_module="like"}
<div class='__like right' data-app="{$data['app']}" data-area="{$data['area']}" data-relid="{$relId}" data-isfave="{$data['iLike']}">
	{parse template="likeSummaryContents" group="gallery_global" params="$data, $relId, $opts"}
</div>
<script type="text/javascript">
	var FAVE_TEMPLATE = new Template( "<h3>{parse expression="sprintf( $this->lang->words['unset_fave_title'], $this->lang->words['like_ucfirst_un' . $data['vernacular'] ])"}</h3><div class='ipsPad'><span class='desc'>{parse expression="sprintf( $this->lang->words['unset_fave_words'], $this->lang->words['like_un' . $data['vernacular'] ])"}</span><br /><p class='ipsForm_center'><input type='button' value='{parse expression="sprintf( $this->lang->words['unset_button'], $this->lang->words['like_ucfirst_un' . $data['vernacular'] ])"}' class='input_submit _funset' /></p></div>");
</script>]]></template_content>
      <template_name>likeSummary</template_name>
      <template_data>$data, $relId, $opts</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<span class='ipsButton_extra right <if test="$data['totalCount']">_fmore clickable</if>' title='{parse expression="sprintf( $this->lang->words['like_totalcount_' . $data['vernacular'] ], $data['totalCount'] )"}' data-tooltip="{parse expression="sprintf( $this->lang->words['like_totalcount_' . $data['vernacular'] ], $data['totalCount'] )"}"><img src='{$this->settings['img_url']}/icon_users.png' /> <strong>{$data['totalCount']}</strong></span>
<if test="likeOnlyMembers:|:$this->memberData['member_id']">
	<a href='#' title="<if test="$data['iLike']">{parse expression="sprintf( $this->lang->words['fave_tt_on'], $this->lang->words['like_ucfirst_un' . $data['vernacular'] ])"}<else />{parse expression="sprintf( $this->lang->words['fave_tt_off'], $this->lang->words['like_ucfirst_' . $data['vernacular'] ])"}</if>" class='ftoggle ipsButton_secondary'><if test="$data['iLike']">{parse expression="sprintf( $this->lang->words['unset_fave_button'], $this->lang->words['like_ucfirst_un' . $data['vernacular'] ])"}<else />{parse expression="sprintf( $this->lang->words['set_fave_button'], $this->lang->words['like_ucfirst_' . $data['vernacular'] ])"}</if></a>
</if>]]></template_content>
      <template_name>likeSummaryContents</template_name>
      <template_data>$data, $relId, $opts=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<if test="loadNormal:|:!$loadInline">
	{parse js_module="gallery_lightbox"}
	{parse js_module="sharelinks"}
	{parse addtohead="{$this->settings['public_dir']}style_css/{$this->registry->output->skin['_csscacheid']}/ipgallery_lightbox.css" type="importcss"}
	<script type='text/javascript'>
		ipb.gallery_lightbox.doAutoAdvanced	= <if test="doAdvanced:|:$doAdvanced">true<else />false</if>;
	</script>
	<div id="ips_lightbox" style='display:none' setup="false" available="true">
		<div id='ips_lightbox_content' style='display:none;'></div>
		<div id='ips_lightbox_loading'>
			<img src='{$this->settings['img_url']}/wait.gif' alt='' />
		</div>
	</div>
<else />
	<if test="notYetLoaded:|:!$this->_loadedLightbox">
		{parse template="galleryCss" group="gallery_global" params=""}
		<script type='text/javascript' src="{$this->settings['public_dir']}js/ips.gallery.js"></script>
		<script type='text/javascript' src="{$this->settings['public_dir']}js/ips.gallery_lightbox.js"></script>
		<script type='text/javascript' src="{$this->settings['public_dir']}js/ips.sharelinks.js"></script>
		<link rel="stylesheet" type='text/css' href='{$this->settings['public_dir']}style_css/{$this->registry->output->skin['_csscacheid']}/ipgallery_lightbox.css' />
		<script type='text/javascript'>
			ipb.gallery_lightbox.doAutoAdvanced	= <if test="doAdvancedToo:|:$doAdvanced">true<else />false</if>;
		</script>
		<div id="ips_lightbox" style='display:none' setup="false" available="true">
			<div id='ips_lightbox_content' style='display:none;'></div>
			<div id='ips_lightbox_loading'>
				<img src='{$this->settings['img_url']}/wait.gif' alt='' />
			</div>
		</div>
		<if test="loadedYet:|:$this->_loadedLightbox=1"></if>
	</if>
</if>]]></template_content>
      <template_name>listingLightbox</template_name>
      <template_data>$loadInline=false, $doAdvanced=false</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[{parse addtohead="//assets.pinterest.com/js/pinit.js" type="javascript"}
<li class='pinterestShareLink'><a href="http://pinterest.com/pin/create/button/?url={parse expression="urlencode(IPSText::base64_decode_urlSafe($url))"}&amp;media={parse expression="urlencode($this->settings['gallery_image_url'])"}" class="pin-it-button" count-layout="horizontal"><img src="//assets.pinterest.com/images/PinExt.png" title="Pin It" /></a></li>]]></template_content>
      <template_name>pinterestButton</template_name>
      <template_data>$url, $title</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[{parse js_module="sharelinks"}
<if test="gotLinks:|:is_array( $links )">
	<ul class='{$cssClass} shareButtons ipsList_inline'>
	<foreach loop="cacheLoop:$links as $id => $data">
		<if test="isEnabled:|:$data['share_enabled']">
			<if test="hasCustom:|:$data['customOutput'] and is_array( $data['customOutput'] )">
				{parse expression="$this->registry->output->getTemplate($data['customOutput'][0])->$data['customOutput'][1]( $data['_rawUrl'], $title, $data['customOutput'][2] )"}
			<else />
				<li><a href="{parse url="sharelink={$data['share_key']};{$data['_url']};{$title}" base="public"}<if test="hasOverrideApp:|:$data['overrideApp']">&amp;overrideApp={$data['overrideApp']}</if>" rel="nofollow" target="_blank" title="<if test="isset( $this->lang->words['gbl_sharelink_with_' . $data['share_key'] ] )">{$this->lang->words['gbl_sharelink_with_' . $data['share_key'] ]}<else />{$this->lang->words['gbl_sharelink_with']} {$data['share_title']}</if>" class='_slink' id='slink_{$data['share_key']}'><img src="{$this->settings['public_cdn_url']}style_extra/sharelinks/{$data['share_key']}.png" /></a></li>
			</if>
		</if>
	</foreach>
		{parse template="pinterestButton" group="gallery_global" params="$url, $title"}
	</ul>
	<script type="text/javascript">
		ipb.sharelinks.url   = "{parse expression="IPSText::base64_decode_urlSafe($url)"}";
		ipb.sharelinks.title = "{parse expression="IPSText::base64_decode_urlSafe( IPSText::htmlspecialchars( $title ) )"}";
		ipb.sharelinks.bname = "{parse expression="trim(addslashes($this->settings['board_name']))"}";
	</script>
</if>]]></template_content>
      <template_name>shareLinks</template_name>
      <template_data><![CDATA[$links, $title='', $url='', $cssClass='topic_share left']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_global</template_group>
      <template_content><![CDATA[<if test="hasTags:|:count($tags['tags'])">
	<div class='ipsSideBlock clearfix'>
		<h3>{$this->lang->words['popular_tags']}</h3>
		<div class='_sbcollapsable'>
			<ul class='ipsList_inline'>
				<foreach loop="eachTag:$tags['tags'] as $id => $data">
					<li><span class="{$data['className']}">{$data['tagWithUrl']}</span></li>
				</foreach>
			</ul>
		</div>
	</div>
</if>]]></template_content>
      <template_name>tagCloud</template_name>
      <template_data>$tags</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_gallery_home">
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[<php>
	// This is a bit of a messy way of doing it, but we have to calculate these
	// here because they depend on system settings.
	//---------------------------------------------------------------------------
	// 8: padding on each thumb
	// 11: margin between top and bottom rows
	// 5: A bit of breathing space for the shadow
	$previewHeight = ( 8 * 2 ) + ( ( ( $this->settings['gallery_use_square_thumbnails'] ) ? $this->settings['gallery_size_thumb_width'] : $this->settings['gallery_size_thumb_height'] ) * 2 ) + 11;
	$largePreviewSize = $previewHeight - 8;
	$previewLeft = $largePreviewSize + 20;
	$previewHeight += 5;
</php>
<style type='text/css'>
	.gallery_preview_strip { height: {$previewHeight}px; left: {$previewLeft}px; }
	.gallery_album { min-height: {$previewHeight}px; }
	.gallery_album_image { width: {$largePreviewSize}px; height: {$largePreviewSize}px;	}
</style>

<div class='maintitle ipsFilterbar'>
	<div class='filterBarPrefix'>{$this->lang->words['sortby_prefix']}</div>
	<ul class='ipsList_inline left'>
		<li <if test="albumSetName:|:$this->request['asort_key'] == 'name' || $this->request['asort_key'] == 'album_name' || (!$this->request['asort_key'] AND $sortData['sort_key'] == 'album_name')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;asort_key=name&amp;asort_order=<if test="albumNameSOD:|:$this->request['asort_order']">{$this->request['asort_order']}<else /><if test="albumNameSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}"  base="public"}'>{$this->lang->words['filter_by_name']}</a>
		</li>
		<li <if test="albumSetDate:|:$this->request['asort_key'] == 'date' || $this->request['asort_key'] == 'album_last_img_date' || (!$this->request['asort_key'] AND $sortData['sort_key'] == 'album_last_img_date')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;asort_key=date&amp;asort_order=<if test="albumDateSOD:|:$this->request['asort_order']">{$this->request['asort_order']}<else /><if test="albumDateSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}"  base="public"}'>{$this->lang->words['filter_most_recent']}</a>
		</li>
		<li <if test="albumSetRate:|:$this->request['asort_key'] == 'rated' || $this->request['asort_key'] == 'album_rating_aggregate' || (!$this->request['asort_key'] AND $sortData['sort_key'] == 'album_rating_aggregate')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;asort_key=rated&amp;asort_order=<if test="albumRateSOD:|:$this->request['asort_order']">{$this->request['asort_order']}<else /><if test="albumRateSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_highest_rated']}</a>
		</li>
		<li <if test="albumSetImages:|:$this->request['asort_key'] == 'images' || $this->request['asort_key'] == 'album_count_imgs' || (!$this->request['asort_key'] AND $sortData['sort_key'] == 'album_count_imgs')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;asort_key=images&amp;asort_order=<if test="albumImagesSOD:|:$this->request['asort_order']">{$this->request['asort_order']}<else /><if test="albumImagesSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_most_images']}</a>
		</li>
		<if test="albumCategoryComments:|:$category['category_allow_comments']">
			<li <if test="albumSetComments:|:$this->request['asort_key'] == 'comments' || $this->request['asort_key'] == 'album_count_comments' || (!$this->request['asort_key'] AND $sortData['sort_key'] == 'album_count_comments')">class='active'</if>>
				<a href='{parse url="{$sortData['url']}&amp;asort_key=comments&amp;asort_order=<if test="albumCommentsSOD:|:$this->request['asort_order']">{$this->request['asort_order']}<else /><if test="albumCommentsSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_most_comments']}</a>
			</li>
		</if>
	</ul>
	<div class='filterBarPrefix second'>{$this->lang->words['sortorder_prefix']}</div>
	<ul class='ipsList_inline'>
		<li <if test="albumSetAsc:|:$this->request['asort_order'] == 'asc' || (!$this->request['asort_order'] AND ( strtolower($sortData['sort_dir']) == 'asc' OR !$sortData['sort_dir'] ) )">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;asort_key=<if test="albumSortAsc:|:$this->request['asort_key']">{$this->request['asort_key']}<else />{$sortData['sort_key']}</if>&amp;asort_order=asc" seotitle="{$sortData['title']}" template="{$sortData['template']}"  base="public"}'>{$this->lang->words['dir_sort_az']}</a>
		</li>
		<li <if test="albumSetDesc:|:$this->request['asort_order'] == 'desc' || (!$this->request['asort_order'] AND strtolower($sortData['sort_dir']) == 'desc')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;asort_key=<if test="albumSortDesc:|:$this->request['asort_key']">{$this->request['asort_key']}<else />{$sortData['sort_key']}</if>&amp;asort_order=desc" seotitle="{$sortData['title']}" template="{$sortData['template']}"  base="public"}'>{$this->lang->words['dir_sort_za']}</a>
		</li>
	</ul>
</div>
<div class='ipsBox gallery_box'>
	<if test="catnorows:|:!count($albums)">
		<div class='no_messages'>
			{$this->lang->words['albums_none_to_see']}
		</div>
	<else />
		<foreach loop="albumsLoop:$albums as $data">
			<div class='gallery_album'>
				<div class='gallery_album_info'>
					<if test="$data['album_allow_rating']">
						<p class='right'>
							<if test="filerate1:|:$data['album_rating_aggregate'] >= 1"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if>
							<if test="filerate2:|:$data['album_rating_aggregate'] >= 2"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if>
							<if test="filerate3:|:$data['album_rating_aggregate'] >= 3"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if>
							<if test="ralerate4:|:$data['album_rating_aggregate'] >= 4"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if>
							<if test="filerate5:|:$data['album_rating_aggregate'] >= 5"><img src="{$this->settings['img_url']}/star.png" alt='*' class='rate_img' /><else /><img src="{$this->settings['img_url']}/star_off.png" alt='*' class='rate_img' /></if>
						</p>
					</if>
					<h2 class='ipsType_subtitle'>
						<a href='{parse url="app=gallery&amp;album={$data['album_id']}" base="public" template="viewalbum" seotitle="{$data['album_name_seo']}"}'>{parse expression="IPSText::truncate( $data['album_name'], 40 )"}</a>
					</h2>
					<div class='desc'>
						<if test="albumIsFriendOnly:|:$this->registry->gallery->helper('albums')->isFriends($data)">
							<span class='ipsBadge ipsBadge_green reset_cursor' data-tooltip='{$this->lang->words['friend_only_prefix_desc']}' title='{$this->lang->words['friend_only_prefix_desc']}'>{$this->lang->words['friend_only_prefix']}</span>&nbsp;
						</if>
						<if test="albumIsPrivate:|:$this->registry->gallery->helper('albums')->isPrivate($data)">
							<span class='ipsBadge ipsBadge_red reset_cursor'>{$this->lang->words['private_ucfirst']}</span>&nbsp;
						</if> 
						{parse expression="IPSText::truncate( strip_tags( $data['album_description'] ), 300 )"}
					</div>
					<br />
					<if test="showAlbumOptions:|:$this->registry->gallery->helper('albums')->isUploadable($data) || $this->registry->gallery->helper('albums')->isOwner($data) || $this->registry->gallery->helper('albums')->canModerate($data)">
						<ul class='ipsList_inline right ipsType_smaller'>
							<if test="canUploadToAlbum:|:$this->registry->gallery->helper('albums')->isUploadable($data)">
								<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image&amp;album_id={$data['album_id']}" base="public"}' title='{$this->lang->words['upload']}'>{$this->lang->words['upload']}</a></li>
							</if>
							<if test="canEditAlbum:|:$this->registry->gallery->helper('albums')->canEdit($data)">
								<li>&nbsp;&nbsp;<a href='{parse url="app=gallery&amp;albumedit={$data['album_id']}" base="public" template="editalbum" seotitle="{$data['album_name_seo']}"}' title='{$this->lang->words['edit']}'>{$this->lang->words['edit']}</a></li>
							</if>
							<if test="canDeleteAlbum:|:$this->registry->gallery->helper('albums')->canDelete($data)">
								<li>&nbsp;&nbsp;<a href="javascript:void(0);" album-id="{$data['album_id']}" class="_albumDelete" title='{$this->lang->words['delete_link']}'>{$this->lang->words['delete_link']}</a></li>
							</if>
						</ul>
						<br />
					</if>
					<div class='clear ipsPad_top'>
						<ul class='ipsList_inline gallery_item_info right'>
							<li><img src='{$this->settings['img_url']}/gallery/icon_image.png' alt='' /> {$data['album_count_imgs']}</li>
							<if test="$data['album_allow_comments']">
								<li><img src='{$this->settings['img_url']}/gallery/icon_comments.png' alt='' /> {$data['album_count_comments']}</li>
							</if>
						</ul>
						<strong>{$this->lang->words['by']}</strong> <img src='{$data['pp_thumb_photo']}' class='ipsUserPhoto ipsUserPhoto_tiny' /> {parse template="userHoverCard" group="global" params="$data"}
					</div> 
				</div>
				<div class='gallery_album_previews'>
					<div class='gallery_image<if test="coverNotApprved:|:isset($data['_coverImage']['image_id']) AND $data['_coverImage']['image_id'] AND $data['_coverImage']['image_approved'] != 1"> moderated</if>'>
						<a href='{parse url="app=gallery&amp;album={$data['album_id']}" base="public" template="viewalbum" seotitle="{$data['album_name_seo']}"}'><div class='gallery_album_image' style='background-size: cover; background-position: center center; background-repeat: no-repeat; background-image: url( {$data['coverUrl']} )'></div></a>
					</div>
					<if test="hasLatest:|:count( $data['_latest'] )">
						<div class='gallery_preview_strip'>
							<ul class='ipsList_inline ipsList_reset'>
								<foreach loop="$data['_latest'] as $idx => $img">
									<li class='gallery_image<if test="inlineNotApproved:|:$img['image_approved'] != 1"> moderated</if>' data-tooltip="{parse expression="IPSText::truncate( $img['image_caption'], 40 )"}">
										{$img['thumb']}
									</li>
								</foreach>
							</ul>
						</div>
					</if>
				</div>
			</div>
		</foreach>
	</if>
</div>
<br />]]></template_content>
      <template_name>album_listing</template_name>
      <template_data>$albums, $category, $sortData=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[<if test="hasRules:|:$category['category_rules__text']">
	<div class='message unspecific'>
		<if test="hasRulesTitle:|:$category['category_rules__title']"><h3>{$category['category_rules__title']}</h3></if>
		{$category['category_rules__text']}
	</div>
	<br />
</if>
<script type="text/javascript">
 ipb.gallery.categoryId	= parseInt({$category['category_id']});
</script>
<if test="hasFollow:|:$follow">
	{$follow}
</if>
<div class='right' style='margin: 3px 10px;'>
	<a href="{parse url="app=gallery&amp;module=albums&amp;section=rss&amp;type=category&amp;typeid={$category['category_id']}" base="public" template="galleryrss" seotitle="{$category['category_name_seo']}"}"><img src="{$this->settings['img_url']}/rss-mini.png" alt="{$this->lang->words['rss_feed']}" /></a>
</div>
{$category['cover']['tag']}
<div class='ipsBox_withphoto ipsGallery_h1image'>
	<h1 class='ipsType_pagetitle'>{$category['category_name']}</h1>
	<if test="hasDescription:|:$category['category_description']">
		<div class='ipsType_pagedesc forum_rules'>
			{$category['category_description']}
		</div>
	</if>
</div>
<div class='topic_controls clear clearfix'>
	<if test="topTopPages:|:!count($categories) AND $pages">
		{$pages}
	</if>
	<ul class='topic_buttons'>
		<if test="canIUpload:|:$this->registry->gallery->getCanUpload()">
			<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image&amp;category_id={$category['category_id']}" base="public"}'>{$this->lang->words['upload']}</a></li>
		</if>
		<if test="isMembersGallery:|:$category['category_id'] == $this->settings['gallery_members_album']">
			<li><a id='viewOptions' class='ipbmenu' href='#viewOptions'>{$this->lang->words['memgallery_showme']} &nbsp;<img src='{$this->settings['img_url']}/opts_arrow.png' alt='&gt;' /></a></li>
		</if>
		<if test="hasImages:|:count($images)">
			<li class='non_button'><a href="{parse url="app=gallery&amp;module=images&amp;section=slideshow&amp;type=category&amp;typeid={$category['category_id']}" base="public" seotitle="false" template="slideshow"}">{$this->lang->words['ss_title']}</a></li>
		</if>
	</ul>
</div>
<div class='ipsLayout'>
	<div class='ipsLayout_content'>
		<if test="hasSubCategories:|:count($categories)">
			{parse template="category_listing" group="gallery_home" params="$categories, true"}
		</if>
		<if test="hasPagesTop:|:count($categories) AND $pages">
			{$pages}<br class='clear' />
		</if>
		
		<if test="showAlbums:|:$category['category_type'] == 1">
			{parse template="album_listing" group="gallery_home" params="$albums, $category, array( 'url' => 'app=gallery&amp;category=' . $category['category_id'], 'title' => $category['category_name_seo'], 'template' => 'viewcategory', 'sort_key' => $category['category_sort_options__key'], 'sort_dir' => $category['category_sort_options__dir'] )"}
		<else />
			<if test="showImages:|:$category['category_type'] == 2">
				{parse template="image_listing" group="gallery_home" params="$images, array(), $category, array( 'url' => 'app=gallery&amp;category=' . $category['category_id'], 'title' => $category['category_name_seo'], 'template' => 'viewcategory', 'sort_key' => $category['category_sort_options__key'], 'sort_dir' => $category['category_sort_options__dir'] ), true, IPSCookie::get('gallery_view_size')"}
			<else />
				<if test="showMembers:|:$category['category_type'] == 4">
					{parse template="member_listing" group="gallery_home" params="$albums, $category, array( 'url' => 'app=gallery&amp;category=' . $category['category_id'], 'title' => $category['category_name_seo'], 'template' => 'viewcategory' )"}
				</if>
			</if>
		</if>
	</div>
</div>
<if test="hasPagesBottom:|:$pages">
	<div class='clear'>{$pages}</div>
	<br />
</if>
<br class='clear' />
<if test="isMembersGalleryMenu:|:$category['category_id'] == $this->settings['gallery_members_album']">
<ul class="ipbmenu_content memAlbumOptions" id='viewOptions_menucontent' style='display:none' >
	<li<if test="memAlbumAlbums:|:$category['category_type'] == 1"> class='active'</if>><a href='{parse url="app=gallery&amp;category={$category['category_id']}&amp;showme=albums" seotitle="{$category['category_name_seo']}" template="viewcategory" base="public"}'>{$this->lang->words['gallery_albums_heading']}</a></li>
	<li<if test="memAlbumAlbums:|:$category['category_type'] == 2"> class='active'</if>><a href='{parse url="app=gallery&amp;category={$category['category_id']}&amp;showme=images" seotitle="{$category['category_name_seo']}" template="viewcategory" base="public"}'>{$this->lang->words['gallery_images_heading']}</a></li>
	<li<if test="memAlbumAlbums:|:$category['category_type'] == 4"> class='active'</if>><a href='{parse url="app=gallery&amp;category={$category['category_id']}&amp;showme=members" seotitle="{$category['category_name_seo']}" template="viewcategory" base="public"}'>{$this->lang->words['gallery_members_heading']}</a></li>
</ul>
</if>]]></template_content>
      <template_name>category</template_name>
      <template_data><![CDATA[$category, $categories, $albums, $images, $pages, $follow='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[<div class='gallery_box'>
	<foreach loop="categoryLoop:$categories as $data">
		<div class='gallery_category'>
		 	<div>
		 		<a href='{parse url="app=gallery&amp;category={$data['category_id']}" base="public" template="viewcategory" seotitle="{$data['category_name_seo']}"}' title='{$data['category_name']}'>
					<h2>{$data['category_name']}</h2>
					<div class='gallery_category_image'<if test="hasImage:|:$data['coverUrl']"> style='background-image: url({$data['coverUrl']});'</if>></div>
				</a>
				<ul class='gallery_item_info ipsList_inline'>
					<li class='left' title='{$this->lang->words['updated_ucfirst']}'>
						<img src='{$this->settings['img_url']}/gallery/icon_clock.png' alt='' /> {parse date="$data['category_last_img_date']" format="DATE"}
					</li>
					
					<li title='{$this->lang->words['col__gallery_categories_category_count_imgs']}'><img src='{$this->settings['img_url']}/gallery/icon_image.png' alt='' /> {$data['category_count_imgs']}</li>
					<if test="categoryAllowsAlbums:|:$data['category_type'] == 1">
						<li title='{$this->lang->words['col__gallery_categories_category_public_albums']}'><img src='{$this->settings['img_url']}/gallery/icon_albums.png' /> {$data['category_public_albums']}</li>
					</if>
					<li <if test="categoryComments:|:!$data['category_count_comments']">class='faded'</if> title='{$this->lang->words['col__gallery_categories_category_count_comments']}'><img src='{$this->settings['img_url']}/gallery/icon_comments.png' alt='' /> {$data['category_count_comments']}</li>
				</ul>	
			</div>			
		</div>
	</foreach>
</div>
<br /><br />]]></template_content>
      <template_name>category_listing</template_name>
      <template_data>$categories, $asSubcats=false</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[{parse js_module="gallery_slider"}
<br class='clear' />
<br />
<script type="text/javascript">
	document.observe("dom:loaded", function(){
		if( $('featuredImages') )
		{
			new ipb_gallery.carousel( $('featuredImages') );
		}
	} );
</script>
<div id='board_stats'>
	<ul class='ipsType_small ipsList_inline'>
		<if test="hasAlbums:|:$stats['albums']">
			<li class='clear'>
				<span class='value'>{parse format_number="$stats['albums']"}</span>
				{$this->lang->words['stats_total_albums']}
			</li>
		</if>
		<li class='clear'>
			<span class='value'>{parse format_number="$stats['images']"}</span>
			{$this->lang->words['stats_total_images']}
		</li>
		<li class='clear'>
			<span class='value'>{parse format_number="$stats['comments']"}</span>
			{$this->lang->words['stats_total_comments']}
		</li>
		<if test="hasImages:|:$stats['images']">
		<li class='clear'>
			<span class='value'>{$stats['diskspace']}</span>
			{$this->lang->words['stats_total_size']}
		</li>
		</if>
	</ul>
</div>
<br />]]></template_content>
      <template_name>homeBottom</template_name>
      <template_data>$stats</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[<if test="canIUpload:|:$this->registry->gallery->getCanUpload()">
	<ul class='topic_buttons'>
		<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image" base="public"}'>{$this->lang->words['upload']}</a></li>
	</ul>
</if>
<h1 class='ipsType_pagetitle'>{IPSLib::getAppTitle('gallery')}</h1>
<br />
<div class='ipsLayout<if test="needSidebar:|:count($recentComments) OR $tagCloud or count($categories)"> ipsLayout_withright ipsLayout_bigright</if>'>
	<if test="showSidebar:|:count($recentComments) OR $tagCloud or count($categories)">
		<div class='ipsLayout_right'>
			<div class='general_box'>
				<h3>{$this->lang->words['categories_sidebarblock']}</h3>
				
				<ul class='ipsPad_half'>
					<foreach loop="categoriesLoop:$categories[0] as $category">
						<if test="canView:|:$this->registry->gallery->helper('categories')->isViewable( $category['category_id'] )">
							<li class='clear ipsPad_half'>
								<a href='{parse url="app=gallery&amp;category={$category['category_id']}" base="public" template="viewcategory" seotitle="{$category['category_name_seo']}"}' title='{$category['category_name']}'>{$category['category_name']}</a>
								<if test="hasChildren:|:count($categories[$category['category_id']])">
									<ul class='ipsGallery_subcategory'>
										<foreach loop="categoriesLoop:$categories[$category['category_id']] as $child">
											<if test="canView:|:$this->registry->gallery->helper('categories')->isViewable( $child['category_id'] )">
												<li class='clear ipsPad_half ipsType_small'>
													<a href='{parse url="app=gallery&amp;category={$child['category_id']}" base="public" template="viewcategory" seotitle="{$child['category_name_seo']}"}' title='{$child['category_name']}'>{$child['category_name']}</a>
												</li>
											</if>
										</foreach>
									</ul>
								</if>
							</li>
						</if>
					</foreach>
				</ul>
			</div>
			<br />
			<if test="weHaveComments:|:count($recentComments)">
				{parse template="miniLatestCommentBlock" group="gallery_albums" params="$recentComments, $this->lang->words['home_recent_comments']"}
				<br />
			</if>
			<if test="weHaveTags:|:$tagCloud">
				{$tagCloud}
				<br />
			</if>
		</div>
	</if>
	<div class='ipsLayout_content'>
		<if test="weHaveFeatured:|:count($featuredImages)">
			<if test="patchwork:|:$this->settings['gallery_featuredimage'] == 'patchwork'">
				{parse js_module="gallery_patchwork"}
				<script type='text/javascript'>
					ipb.galleryPatchwork = [
						<foreach loop="featuredImages:$featuredImages as $idx => $featuredImage">
							{
								"image_id": {$featuredImage['image_id']},
								"image_url": "{parse url="app=gallery&amp;image={$featuredImage['image_id']}" base="public" template="viewimage" seotitle="{$featuredImage['image_caption_seo']}"}",
								"med_img": "{$featuredImage['mediumUrl']}",
								"thumb_size": {
								"w": <if test="hasMedPatch:|:$featuredImage['_data']['sizes']['medium'][0]">{$featuredImage['_data']['sizes']['medium'][0]}<else />{$featuredImage['_data']['sizes']['max'][0]}</if>,
								"h": <if test="hasMedPatchH:|:$featuredImage['_data']['sizes']['medium'][1]">{$featuredImage['_data']['sizes']['medium'][1]}<else />{$featuredImage['_data']['sizes']['max'][1]}</if>,
								}
							},
						</foreach>
					];
				</script>
				<h2 class='maintitle'>{$this->lang->words['featured_images_heading']}</h2>
				<div class='ipsBox gallery_box'>
					<div id='featured_images'></div>
				</div>
				<br />
				<script type='text/javascript'>
					$('featured_images').patchwork({ imageData: ipb.galleryPatchwork });
				</script>
			<else />
				<h2 class='maintitle'>{$this->lang->words['featured_images_heading']}</h2>
				<div class='ipsBox'>
					<div class='ipsBox_container ipsPad'>
						<div class='galleryCarousel' id='featuredImages'>
							<a href='#' id='feature_left' class='carousel_nav carousel_left' style='display: none'>&lsaquo;</a>
							<a href='#' id='feature_right' class='carousel_nav carousel_right' style='display: none'>&rsaquo;</a>
							<foreach loop="featuredImages:$featuredImages as $featuredImage">
								<div class='carousel_img' style='background-image: url({$featuredImage['tag']});'>
									<a class='carousel_img_link' href='{parse url="app=gallery&amp;image={$featuredImage['image_id']}" base="public" template="viewimage" seotitle="{$featuredImage['image_caption_seo']}"}' title='{$featuredImage['image_caption']}'>&nbsp;</a>
									<div class='imageDescription'>
										<strong><a href='{parse url="app=gallery&amp;image={$featuredImage['image_id']}" base="public" template="viewimage" seotitle="{$featuredImage['image_caption_seo']}"}' title='{$featuredImage['image_caption']}'>{$featuredImage['image_caption']}</a></strong><br />
										{$featuredImage['image_description']}<br />
										<if test="featuredImageAlbum:|:$featuredImage['image_album_id']">
											{$this->lang->words['slider_from_album']} <a href='{parse url="app=gallery&amp;album={$featuredImage['image_album_id']}" base="public" template="viewalbum" seotitle="{$featuredImage['album_name_seo']}"}' title='{$featuredImage['album_name']}'>{$featuredImage['album_name']}</a>
										<else />
											{$this->lang->words['slider_from_category']} <a href='{parse url="app=gallery&amp;category={$featuredImage['image_category_id']}" base="public" template="viewcategory" seotitle="{$featuredImage['category_name_seo']}"}' title='{$featuredImage['category_name']}'>{$featuredImage['category_name']}</a>
										</if>
									</div>
								</div>
							</foreach>
						</div>
					</div>
				</div>
				<br />
			</if>
		</if>
		<if test="weHaveAlbums:|:count($recentAlbums)">
			<h2 class='maintitle'>{$this->lang->words['recent_albums_heading']}</h2>
			<div class='ipsBox gallery_box'>
				<div class='ipsBox_container ipsPad'>
					<ul class='ipsList_inline ipsList_reset wrap'>
						<foreach loop="imagesLoop:$recentAlbums as $id => $data">
							<li>
								{parse gallery_resize="$data['thumb']" width="thumb_medium"}
								<div class='desc ipsType_smaller album_meta'><a href='{parse url="app=gallery&amp;album={$data['album_id']}" base="public" template="viewalbum" seotitle="{$data['album_name_seo']}"}'><strong>{$data['album_name']}</strong></a>
								<br />{$this->lang->words['by_lower']} {parse template="userHoverCard" group="global" params="$data"}</div>
							</li>
						</foreach>
					</ul>
				</div>
			</div>
			<br />
		</if>
		<if test="weHaveRecent:|:count($recentImages)">
			{parse template="listingLightbox" group="gallery_global" params=""}
			<h2 class='maintitle'>{$this->lang->words['recent_images_heading']}</h2>
			<div class='ipsBox gallery_box'>
				<foreach loop="imagesLoop:$recentImages as $id => $data">
					<div class='gallery_image<if test="recentNotApproved:|:$data['image_approved'] != 1"> moderated</if>'>
						{$data['thumb']}
						<ul class='gallery_item_info ipsList_inline'>
							<if test="notRead:|:!$data['_isRead']">
								<li class='left'><img src='{$this->settings['img_url']}/t_unread.png' alt='' data-tooltip='{$this->lang->words['gallery_image_unread']}' /></li>
							</if>
							<if test="notApproved:|:$data['image_approved'] != 1">
								<li class='left'><img src='{$this->settings['img_url']}/gallery/icon_moderated.png' alt='' data-tooltip='<if test="$data['image_approved'] === -1">{$this->lang->words['moderated_img_hidden']}<else />{$this->lang->words['moderated_img_unapproved']}</if>' /></li>
							</if>
							<if test="imagePinned:|:$data['image_pinned']">
								<li class='left'><img src='{$this->settings['img_url']}/gallery/icon_pinned.png' alt='' /></li>
							</if>
							<li <if test="views:|:!$data['image_views']">class='faded'</if>><img src='{$this->settings['img_url']}/gallery/icon_view.png' alt='' /> {$data['image_views']}</li>
							<li <if test="comments:|:!$data['image_comments']">class='faded'</if>><img src='{$this->settings['img_url']}/gallery/icon_comments.png' alt='' /> {$data['image_comments']}</li>
						</ul>
					</div>
				</foreach>
			</div>
		</if>
	</div>
</div>
{parse template="homeBottom" group="gallery_home" params="$stats"}]]></template_content>
      <template_name>homeSocial</template_name>
      <template_data>$categories, $featuredImages, $recentImages, $recentAlbums, $recentComments, $tagCloud, $stats</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[<if test="canIUpload:|:$this->registry->gallery->getCanUpload()">
	<ul class='topic_buttons'>
		<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image" base="public"}'>{$this->lang->words['upload']}</a></li>
	</ul>
</if>
<h1 class='ipsType_pagetitle'>{IPSLib::getAppTitle('gallery')}</h1>
<br />
<div class='ipsLayout<if test="needSidebar:|:count($recentComments) OR $tagCloud"> ipsLayout_withright ipsLayout_bigright</if>'>
	<if test="showSidebar:|:count($recentComments) OR $tagCloud">
		<div class='ipsLayout_right'>
			<if test="weHaveComments:|:count($recentComments)">
				{parse template="miniLatestCommentBlock" group="gallery_albums" params="$recentComments, $this->lang->words['home_recent_comments']"}
				<br />
			</if>
			<if test="weHaveTags:|:$tagCloud">
				{$tagCloud}
				<br />
			</if>
		</div>
	</if>
	<div class='ipsLayout_content'>
<if test="weHaveFeatured:|:count($featuredImages)">
	<if test="patchwork:|:$this->settings['gallery_featuredimage'] == 'patchwork'">
		{parse js_module="gallery_patchwork"}
		<script type='text/javascript'>
			ipb.galleryPatchwork = [
				<foreach loop="featuredImages:$featuredImages as $idx => $featuredImage">
					{
						"image_id": {$featuredImage['image_id']},
						"image_url": "{parse url="app=gallery&amp;image={$featuredImage['image_id']}" base="public" template="viewimage" seotitle="{$featuredImage['image_caption_seo']}"}",
						"med_img": "{$featuredImage['mediumUrl']}",
						"thumb_size": {
							"w": <if test="hasMedPatch:|:$featuredImage['_data']['sizes']['medium'][0]">{$featuredImage['_data']['sizes']['medium'][0]}<else />{$featuredImage['_data']['sizes']['max'][0]}</if>,
							"h": <if test="hasMedPatchH:|:$featuredImage['_data']['sizes']['medium'][1]">{$featuredImage['_data']['sizes']['medium'][1]}<else />{$featuredImage['_data']['sizes']['max'][1]}</if>,
						}
					},
				</foreach>
			];
		</script>
		<h2 class='maintitle'>{$this->lang->words['featured_images_heading']}</h2>
		<div class='ipsBox gallery_box'>
			<div id='featured_images'></div>
		</div>
		<br />
		<script type='text/javascript'>
			$('featured_images').patchwork({ imageData: ipb.galleryPatchwork });
		</script>
	<else />
		<h2 class='maintitle'>{$this->lang->words['featured_images_heading']}</h2>
		<div class='ipsBox'>
			<div class='ipsBox_container ipsPad'>
				<div class='galleryCarousel' id='featuredImages'>
					<a href='#' id='feature_left' class='carousel_nav carousel_left' style='display: none'>&lsaquo;</a>
					<a href='#' id='feature_right' class='carousel_nav carousel_right' style='display: none'>&rsaquo;</a>
					<foreach loop="featuredImages:$featuredImages as $featuredImage">
						<div class='carousel_img' style='background-image: url({$featuredImage['tag']});'>
							<a class='carousel_img_link' href='{parse url="app=gallery&amp;image={$featuredImage['image_id']}" base="public" template="viewimage" seotitle="{$featuredImage['image_caption_seo']}"}' title='{$featuredImage['image_caption']}'>&nbsp;</a>
							<div class='imageDescription'>
								<strong><a href='{parse url="app=gallery&amp;image={$featuredImage['image_id']}" base="public" template="viewimage" seotitle="{$featuredImage['image_caption_seo']}"}' title='{$featuredImage['image_caption']}'>{$featuredImage['image_caption']}</a></strong><br />
								{$featuredImage['image_description']}<br />
								<if test="featuredImageAlbum:|:$featuredImage['image_album_id']">
									{$this->lang->words['slider_from_album']} <a href='{parse url="app=gallery&amp;album={$featuredImage['image_album_id']}" base="public" template="viewalbum" seotitle="{$featuredImage['album_name_seo']}"}' title='{$featuredImage['album_name']}'>{$featuredImage['album_name']}</a>
								<else />
									{$this->lang->words['slider_from_category']} <a href='{parse url="app=gallery&amp;category={$featuredImage['image_category_id']}" base="public" template="viewcategory" seotitle="{$featuredImage['category_name_seo']}"}' title='{$featuredImage['category_name']}'>{$featuredImage['category_name']}</a>
								</if>
							</div>
						</div>
					</foreach>
				</div>
			</div>
		</div>
		<br />
	</if>
</if>
		{parse template="category_listing" group="gallery_home" params="$categories"}
		<if test="weHaveRecent:|:count($recentImages)">
			{parse template="listingLightbox" group="gallery_global" params=""}
			<h2 class='maintitle'>{$this->lang->words['recent_images_heading']}</h2>
			<div class='ipsBox gallery_box'>
				<foreach loop="imagesLoop:$recentImages as $id => $data">
					<div class='gallery_image<if test="recentNotApproved:|:$data['image_approved'] != 1"> moderated</if>'>
						{$data['thumb']}
						<ul class='gallery_item_info ipsList_inline'>
							<if test="notRead:|:!$data['_isRead']">
								<li class='left'><img src='{$this->settings['img_url']}/t_unread.png' alt='' data-tooltip='{$this->lang->words['gallery_image_unread']}' /></li>
							</if>
							<if test="notApproved:|:$data['image_approved'] != 1">
								<li class='left'><img src='{$this->settings['img_url']}/gallery/icon_moderated.png' alt='' data-tooltip='<if test="$data['image_approved'] === -1">{$this->lang->words['moderated_img_hidden']}<else />{$this->lang->words['moderated_img_unapproved']}</if>' /></li>
							</if>
							<if test="imagePinned:|:$data['image_pinned']">
								<li class='left'><img src='{$this->settings['img_url']}/gallery/icon_pinned.png' alt='' /></li>
							</if>
							<li <if test="views:|:!$data['image_views']">class='faded'</if>><img src='{$this->settings['img_url']}/gallery/icon_view.png' alt='' /> {$data['image_views']}</li>
							<li <if test="comments:|:!$data['image_comments']">class='faded'</if>><img src='{$this->settings['img_url']}/gallery/icon_comments.png' alt='' /> {$data['image_comments']}</li>
						</ul>
					</div>
				</foreach>
			</div>
		</if>
	</div>
</div>
{parse template="homeBottom" group="gallery_home" params="$stats"}]]></template_content>
      <template_name>homeTraditional</template_name>
      <template_data>$categories, $featuredImages, $recentImages, $recentComments, $tagCloud, $stats</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[<div class='maintitle ipsFilterbar'>
	<if test="canChangeViewStyle:|:$canChangeStyle">
		<ul class='ipsList_inline right'>
			<!--<li>{$this->lang->words['show_as']}</li>-->
			<li <if test="thumbActive:|:$viewStyle == 'thumbs' || !$viewStyle">class='active'</if>>
				<a href='{parse url="{$sortData['url']}&amp;sort_key={$this->request['sort_key']}&amp;sort_order={$this->request['sort_order']}&amp;view_style=thumbs" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'><img src='{$this->settings['img_url']}/gallery/icon_thumbs.png' alt='' /> &nbsp;&nbsp;{$this->lang->words['show_as_thumbs']}</a>
			</li>
			<li <if test="largeActive:|:$viewStyle == 'large'">class='active'</if>>
				<a href='{parse url="{$sortData['url']}&amp;sort_key={$this->request['sort_key']}&amp;sort_order={$this->request['sort_order']}&amp;view_style=large" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'><img src='{$this->settings['img_url']}/gallery/icon_large.png' alt='' /> &nbsp;&nbsp;{$this->lang->words['show_as_large']}</a>
			</li>
		</ul>
	</if>
	<div class='filterBarPrefix'>{$this->lang->words['sortby_prefix']}</div>
	<ul class='ipsList_inline left'>
		<li <if test="imageSetCDate:|:$this->request['sort_key'] == 'idate' || $this->request['sort_key'] == 'image_date' || (!$this->request['sort_key'] AND $sortData['sort_key'] == 'image_date')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;sort_key=idate&amp;sort_order=<if test="imageDateCSOD:|:$this->request['sort_order']">{$this->request['sort_order']}<else /><if test="imageDateCSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_most_recent']}</a>
		</li>
		<li <if test="imageSetCDate:|:$this->request['sort_key'] == 'views' || $this->request['sort_key'] == 'image_views' || (!$this->request['sort_key'] AND $sortData['sort_key'] == 'image_views')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;sort_key=views&amp;sort_order=<if test="imageViewsCSOD:|:$this->request['sort_order']">{$this->request['sort_order']}<else /><if test="imageViewsCSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_most_views']}</a>
		</li>
		<li <if test="imageSetCDate:|:$this->request['sort_key'] == 'rating' || $this->request['sort_key'] == 'image_rating' || (!$this->request['sort_key'] AND $sortData['sort_key'] == 'image_rating')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;sort_key=rating&amp;sort_order=<if test="imageRateCSOD:|:$this->request['sort_order']">{$this->request['sort_order']}<else /><if test="imageRateCSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_highest_rated']}</a>
		</li>
		<if test="isAlbumComments:|:$album['album_id'] AND $album['album_allow_comments']">
			<li <if test="imageSetCDate:|:$this->request['sort_key'] == 'comments' || $this->request['sort_key'] == 'image_comments' || (!$this->request['sort_key'] AND $sortData['sort_key'] == 'image_comments')">class='active'</if>>
				<a href='{parse url="{$sortData['url']}&amp;sort_key=comments&amp;sort_order=<if test="imageCommentsCSOD:|:$this->request['sort_order']">{$this->request['sort_order']}<else /><if test="imageCommentsCSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_most_comments']}</a>
			</li>
		<else />
			<if test="isCategoryComments:|:!$album['album_id'] AND $category['category_allow_comments']">
				<li <if test="imageSetCDate:|:$this->request['sort_key'] == 'comments' || $this->request['sort_key'] == 'image_comments' || (!$this->request['sort_key'] AND $sortData['sort_key'] == 'image_comments')">class='active'</if>>
					<a href='{parse url="{$sortData['url']}&amp;sort_key=comments&amp;sort_order=<if test="imageCommentsSCSOD:|:$this->request['sort_order']">{$this->request['sort_order']}<else /><if test="imageCommentsSCSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_most_comments']}</a>
				</li>
			</if>
		</if>
		<li <if test="imageSetCCaption:|:$this->request['sort_key'] == 'caption' || $this->request['sort_key'] == 'image_caption' || (!$this->request['sort_key'] AND $sortData['sort_key'] == 'image_caption')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;sort_key=caption&amp;sort_order=<if test="imageCaptionCSOD:|:$this->request['sort_order']">{$this->request['sort_order']}<else /><if test="imageCaptionCSOA:|:$sortData['sort_dir']">{$sortData['sort_dir']}<else />asc</if></if>" seotitle="{$sortData['title']}" template="{$sortData['template']}" base="public"}'>{$this->lang->words['filter_by_caption']}</a>
		</li>
	</ul>
	<div class='filterBarPrefix second'>{$this->lang->words['sortorder_prefix']}</div>
	<ul class='ipsList_inline'>
		<li <if test="ImageSetAsc:|:strtolower($this->request['sort_order']) == 'asc' || (!$this->request['sort_order'] AND ( strtolower($sortData['sort_dir']) == 'asc' OR !$sortData['sort_dir'] ) )">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;sort_key=<if test="imageSortAsc:|:$this->request['sort_key']">{$this->request['sort_key']}<else />{$sortData['sort_key']}</if>&amp;sort_order=asc" seotitle="{$sortData['title']}" template="{$sortData['template']}"  base="public"}'>{$this->lang->words['dir_sort_az']}</a>
		</li>
		<li <if test="ImageSetDesc:|:strtolower($this->request['sort_order']) == 'desc' || (!$this->request['sort_order'] AND strtolower($sortData['sort_dir']) == 'desc')">class='active'</if>>
			<a href='{parse url="{$sortData['url']}&amp;sort_key=<if test="imageSortDesc:|:$this->request['sort_key']">{$this->request['sort_key']}<else />{$sortData['sort_key']}</if>&amp;sort_order=desc" seotitle="{$sortData['title']}" template="{$sortData['template']}"  base="public"}'>{$this->lang->words['dir_sort_za']}</a>
		</li>
	</ul>
</div>
<div class='ipsBox gallery_box'>
	<if test="hasImages:|:is_array($images) && count($images)">
		
		<if test="largeViewStyleCheck:|:!$canChangeStyle || ($canChangeStyle && $viewStyle != 'large')">
			<ul class='ipsList_inline ipsList_reset'>
				<foreach loop="imagesLoop:$images as $id => $data">
					<li class='gallery_image <if test="lwrapperunapproved:|:$data['image_approved'] != 1">moderated</if>'> 
						<if test="lmoderate:|:$album['_canModerate'] OR $category['_canModerate']"><input type="checkbox" name="modBox_{$data['image_id']}" id="modBox_{$data['image_id']}" value="1" class="albumModBox" /></if>
						{$data['thumb']}
						<ul class='ipsList_inline gallery_item_info'>
							<if test="largeNotRead:|:!$data['_isRead']">
								<li class='left'><img src='{$this->settings['img_url']}/t_unread.png' alt='' data-tooltip='{$this->lang->words['gallery_image_unread']}' /></li>
							</if>
							<if test="largeUnapproved:|:$data['image_approved'] != 1">
								<li class='left'><img src='{$this->settings['img_url']}/gallery/icon_moderated.png' alt='' data-tooltip='<if test="$data['image_approved'] === -1">{$this->lang->words['moderated_img_hidden']}<else />{$this->lang->words['moderated_img_unapproved']}</if>' /></li>
							</if>
							<if test="limagePinned:|:$data['image_pinned']">
								<li class='left'><img src='{$this->settings['img_url']}/gallery/icon_pinned.png' alt='' /></li>
							</if>
							<li <if test="lviews:|:!$data['image_views']">class='faded'</if>><img src='{$this->settings['img_url']}/gallery/icon_view.png' alt='' /> {$data['image_views']}</li>
							<li <if test="lcomments:|:!$data['image_comments']">class='faded'</if>><img src='{$this->settings['img_url']}/gallery/icon_comments.png' alt='' /> {$data['image_comments']}</li>
						</ul>
					</li>
				</foreach>
			</ul>
		<else />
			<foreach loop="imagesLoop:$images as $id => $data">
				<div class='gallery_image large_image <if test="notApprovedWrapper:|:$data['image_approved'] != 1">moderated</if>'>
					<a href='{parse url="app=gallery&amp;image={$data['image_id']}" base="public" template="viewimage" seotitle="{$data['image_caption_seo']}"}' title='{$data['image_title']}'>{$data['mediumThumb']}</a>
					<div class='gallery_image_info'>
						<ul class='gallery_item_info right'>
							<if test="notRead:|:!$data['_isRead']">
								<li class='left'><img src='{$this->settings['img_url']}/t_unread.png' alt='' data-tooltip='{$this->lang->words['gallery_image_unread']}' /></li>
							</if>
							<if test="notApproved:|:$data['image_approved'] != 1">
								<li class='left'><img src='{$this->settings['img_url']}/gallery/icon_moderated.png' alt='' data-tooltip='<if test="$data['image_approved'] === -1">{$this->lang->words['moderated_img_hidden']}<else />{$this->lang->words['moderated_img_unapproved']}</if>' />
							</if>
							<if test="imagePinned:|:$data['image_pinned']">
								<li class='left'><img src='{$this->settings['img_url']}/gallery/icon_pinned.png' alt='' /></li>
							</if>
							<li <if test="views:|:!$data['image_views']">class='faded'</if>><img src='{$this->settings['img_url']}/gallery/icon_view.png' alt='' /> {$data['image_views']}</li>
							<li <if test="comments:|:!$data['image_comments']">class='faded'</if>><img src='{$this->settings['img_url']}/gallery/icon_comments.png' alt='' /> {$data['image_comments']}</li>
						</ul>
						<h2 class='ipsType_subtitle'><a href='{parse url="app=gallery&amp;image={$data['image_id']}" base="public" template="viewimage" seotitle="{$data['image_caption_seo']}"}' title='{$data['image_title']}'>{$data['image_caption']}</a></h2>
						<div class='desc'>{parse expression="IPSText::truncate( strip_tags( IPSText::getTextClass('bbcode')->stripAllTags( $data['image_description'] ) ), 70 )"}</div>
					</div>
				</div>
				<br />
			</foreach>
		</if>
	<else />
		<div class='no_messages'>
			{$this->lang->words['category_no_images']}
		</div>
	</if>
</div>
<br />
{parse template="listingLightbox" group="gallery_global" params=""}
<if test="showModOption:|:($album['album_id'] AND $album['_canModerate']) OR (!$album['album_id'] AND $this->registry->gallery->helper('categories')->checkIsModerator( $category['category_id'] ))">
	{parse template="inlineAlbumModeration" group="gallery_home" params=""}
</if>]]></template_content>
      <template_name>image_listing</template_name>
      <template_data>$images, $album, $category, $sortData=array(), $canChangeStyle = false, $viewStyle = false</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[<php>
	// Have to do it this way so we don't have whitespace when injecting into the js template, which will cause a js error
	$options	= '';
	$_images	= $this->registry->gallery->helper('categories')->fetchImageCategories();
	foreach( $this->registry->gallery->helper('categories')->catJumpList( false, 'post', array(), $this->lang->words['or_select_category'] ) as $cat )
	{
		$disabled	= '';
		if( $cat[0] AND !in_array( $cat[0], $_images ) )
		{
			$disabled	= " disabled='disabled'";
		}
		$options .= "<option value='{$cat[0]}'" . $disabled . ">{$cat[1]}</option>";
	}
</php>
{parse js_module="gallery_albumchooser"}
<script type='text/javascript'>
	albumSelectorUpdate = '{"field": "albumModBox_moveTo","div": "asDiv"}';
	ipb.templates['album_moderation'] = new Template("<div id='album_moderate_box' class='ipsFloatingAction' style='display: none'><form id='theForm' name='theForm'><span class='desc'>{$this->lang->words['album_modaction_count']} </span><select name='modOptions' id='albumModAction' class='input_select'><option value='approve'>{$this->lang->words['mod_img_approve']}</option><option value='hide'>{$this->lang->words['mod_img_unapprove']}</option><option value='delete'>{$this->lang->words['mod_img_delete']}</option><option value='move'>{$this->lang->words['mod_img_move']}</option></select>&nbsp;&nbsp;<input type='button' class='input_submit' id='submitModAction' value='{$this->lang->words['jmp_go']}' /><div id='albumModBox_move' class='desc ipsPad_half short' style='display:none'></div><div class='desc ipsPad_half short'><input type='checkbox' name='albumModSelectAll' id='albumModSelectAll' value='1' #{checked} /> <label for='albumModSelectAll'>{$this->lang->words['mod_select_all']}</label></div></form></div>");
	ipb.templates['album_img_moveto'] = new Template("<input type='radio' name='movetoAlbum' id='movetoAlbum' checked='checked' value='1' /> {$this->lang->words['album_modaction_moveto']}: <input type='hidden' id='albumModBox_moveTo' value=0 /><div style='display:none' class='albumSelected' id='asDiv'></div><a href='#' class='ipsButton_secondary' data-album-selector-auto-update='" + albumSelectorUpdate + "' data-album-selector='type=moveImages&moderate=1&album_id=#{album_id}'>{$this->lang->words['as_select_album']}</a><br /><br /><input type='radio' name='movetoAlbum' id='movetoAlbum' value='2' /> {$this->lang->words['album_modaction_moveto']}: <select name='movetoCategory_id' id='movetoCategory_id'>{$options}</select>");
</script>]]></template_content>
      <template_name>inlineAlbumModeration</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_home</template_group>
      <template_content><![CDATA[<div class='maintitle ipsFilterbar'>
	{$this->lang->words['gallery_members_heading']}
</div>
<div class='ipsBox'>
	<div class='ipsBox_container ipsPad'>
		<if test="catnorows:|:!count($albums)">
			<div class='no_messages'>
				{$this->lang->words['members_none_to_see']}
			</div>
		<else />
			<table class='ipb_table gallery_members'>
				{parse striping="browseRow" classes="row1,row2"}
				<foreach loop="albumsLoop:$albums as $data">
					<tr class='{parse striping="browseRow"}'>
						<td class='col_c_icon'>
							<a href='{parse url="app=gallery&amp;user={$data['member_id']}" template="useralbum" seotitle="{$data['members_seo_name']}" base="public"}' title='{$this->lang->words['view_all_albums']}' class='ipsUserPhotoLink'><div class='galattach cover_img_75'><div class='galmemberwrapper'><img src='{$data['pp_main_photo']}' alt="{parse expression="sprintf($this->lang->words['users_photo'],$data['members_display_name'])"}" style='max-width: 75px; max-height: 75px;' /></div></div></a>
						</td>
						<td class='col_c_forum'>
							<strong>
								<a href='{parse url="app=gallery&amp;user={$data['member_id']}" template="useralbum" seotitle="{$data['members_seo_name']}" base="public"}'>{$data['members_display_name']}</a>
							</strong>
							<if test="hasImages:|:count($data['_images'])">
								<br /><br />
								<ul class='ipsList_inline'>
								<foreach loop="memberImages:$data['_images'] as $_image">
									<li>{parse gallery_resize="$_image['thumb']" width="thumb_small"}</li>
								</foreach>
								</ul>
							</if>
						</td>
						<td class='col_c_post desc'>
							<strong>{$data['_totalImages']}</strong> {$this->lang->words['images']}<br />
							<if test="albumhasLatestImage:|:$data['_latestImage']">
								<br />
								{$this->lang->words['last_upload']}: {parse date="$data['_latestImage']" format="DATE"}
							</if>
						</td>
					</tr>
				</foreach>
			</table>
		</if>
	</div>
</div>
<br />]]></template_content>
      <template_name>member_listing</template_name>
      <template_data>$albums, $category, $sortData=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_gallery_img">
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[<php>
	if( $info['image_album_id'] )
	{
		$this->_album		= $this->registry->gallery->helper('albums')->fetchAlbum( $info['image_album_id'] );
	}
	else
	{
		$this->_category	= $this->registry->gallery->helper('categories')->fetchCategory( $info['image_category_id'] );
	}
	ipsRegistry::$settings['gallery_image_url'] = $info['image_url'];
</php>
<div id='lightbox_wrap'>
	<a href='#' id='close_lightbox'>&times;</a>
	<div id='imageMeta'>
		<span class='rating ipsType_smaller right'>
			<if test="canRate:|:$this->registry->gallery->helper('rate')->canRate( $info['image_album_id'] ? $info['image_album_id'] : $info['image_category_id'], null, $info['image_album_id'] ? 'album' : 'category' ) !== false && $this->memberData['member_id'] != $author['member_id']">
				<strong>{$this->lang->words['rate_image']}</strong>&nbsp;&nbsp;
				<foreach loop="voteRatingLoop:array(1,2,3,4,5) as $_rating">
					<a href='{parse url="app=gallery&amp;module=images&amp;section=rate&amp;where=image&amp;id={$info['image_id']}&amp;rating={$_rating}&amp;secure_key={$this->member->form_hash}" base="public"}' id='album_rate_{$_rating}' title='{$this->lang->words[ 'rate_file_' . $_rating ]}'><if test="voteImageRate:|:$info['image_rating'] >= $_rating">{parse replacement="rate_on"}<else />{parse replacement="rate_off"}</if></a>
				</foreach>
				<span id='rating_text' class='desc'>
					<if test="filevotes:|:$info['image_ratings_count'] > 0">{$info['image_ratings_count']} {$this->lang->words['votes_cnt']}</if>
					<if test="fileyourvote:|:$info['rate_rate']">({$this->lang->words['you_voted']} {$info['rate_rate']})</if>
				</span>
				<script type='text/javascript'>
					rating = new ipb.rating( 'album_rate_', { 
										url: 		ipb.vars['base_url'] + 'app=gallery&amp;module=ajax&amp;section=rate&amp;id={$info['image_id']}&where=image&md5check=' + ipb.vars['secure_hash'],
										cur_rating: {parse expression="intval($info['image_rating'])"},
										rated: 		<if test="jsRated:|:$info['rate_rate']">1<else />0</if>,
										allow_rate: 1
									  } );
				</script>
			<else />
				<if test="othersCanRate:|:$this->registry->gallery->helper('rate')->containerCanRate( $info['image_album_id'] ? $info['image_album_id'] : $info['image_category_id'], null, $info['image_album_id'] ? 'album' : 'category' ) !== false">
					<foreach loop="viewRatingLoop:array(1,2,3,4,5) as $_rating">
						<if test="viewImageRate:|:$info['image_rating'] >= $_rating">{parse replacement="rate_on"}<else />{parse replacement="rate_off"}</if>
					</foreach>
				</if>
			</if>
		</span>
		<h2 class='ipsType_pagetitle'>
			<a href='{parse url="app=gallery&amp;image={$info['image_id']}" base="public" seotitle="{$info['image_caption_seo']}" template="viewimage"}' title='{$this->lang->words['goto_full_view']}'>{parse expression="IPSText::truncate( $info['image_caption'], 50)"}</a>
		</h2>
		<if test="hasTags:|:is_array($info['tags'])">
			{$info['tags']['formatted']['parsedWithoutComma']}
			<br />
		</if>
		<if test="hasDescription:|:$info['image_description']">
			<p class='desc'>
				{parse expression="IPSText::truncate( $info['image_description'], 250 )"}
			</p> 
		</if>
		<if test="hascopyright:|:$info['image_copyright'] != ''">
			<br />
			<strong>{$this->lang->words['user_copyright_name']}</strong>
			<p class='desc'>{$info['image_copyright']}</p>
		</if>
		<br />
		<ul class='image_info ipsType_small'>
			<li><strong>{$this->lang->words['viewimg_owner']}:</strong> {parse template="userHoverCard" group="global" params="$author"}<if test="notGuest:|:$author['member_id']"> (<a href="{parse url="app=gallery&amp;user={$author['member_id']}" seotitle="{$author['members_seo_name']}" template="useralbum" base="public"}">{$this->lang->words['view_all_albums']}</a>)</if></li>
			<li><strong>{$this->lang->words['uploaded_ucfirst']}:</strong> {parse date="$info['image_date']" format="short"}</li>
			<if test="$info['_camera_model']">
				<li><strong>{$this->lang->words['camera_ucfirst']}:</strong> {$info['_camera_model']}</li>
			</if>
			<if test="$info['_date_taken']">
				<li><strong>{$this->lang->words['taken_ucfirst']}:</strong> {$info['_date_taken']}</li>
			</if>
			<li><strong>{$this->lang->words['views']}</strong> {parse format_number="$info['image_views']"}</li>
			<if test="imageHasNotes:|:count($info['image_notes'])">
				<li><strong>{$this->lang->words['note_count']}</strong> {parse format_number="count($info['image_notes'])"}</li>
			</if>
			<li>
				<if test="isinAlbum:|:$info['image_album_id']">
					<strong>{$this->lang->words['viewimg_album']}:</strong> <a href="{parse url="app=gallery&amp;album={$this->_album['album_id']}" seotitle="{$this->_album['album_name_seo']}" template="viewalbum" base="public"}">{$this->_album['album_name']}</a>
				<else />
					<strong>{$this->lang->words['viewing_category']}:</strong> <a href="{parse url="app=gallery&amp;category={$this->_category['category_id']}" seotitle="{$this->_category['category_name_seo']}" template="viewcategory" base="public"}">{$this->_category['category_name']}</a>
				</if>
			</li>
		</ul>
		<if test="maps:|:$this->settings['map_bing_api_key'] AND ($info['_latLon'] && $info['image_gps_show'])">
			<br />
			<if test="gpsOn:|:$info['image_gps_show']">
				<h4 id='map_on_header' class='__mapon'>{$this->lang->words['image_view_location']}
					<if test="geoData:|:$info['_locShort']">
						<span class='desc' style='font-weight:normal'>
							&nbsp; {$info['_locShort']}
						</span>
					</if>
				</h4>
			</if>
			<div id="map" class='__mapon ipsPad_half' style="margin:0 auto; width: 300px; display: none">
				<a href="{$info['_mapUrl']}" rel="newwindow"><img id='map_0' src="{$info['_maps'][0]}" alt="map" /></a>
				<img style='display:none' id='map_1' src="{$info['_maps'][1]}" alt="map" />
			</div>
		</if>
		<if test="hasComments:|:$comments">
			<br /><br />
			<h2 class='ipsType_subtitle'>{$info['image_comments']} {$this->lang->words['ct_gal_comments']} <if test="$info['image_comments'] > 10">&nbsp;&nbsp;<span class='desc'>{$this->lang->words['most_recent_10']}</span></if></h2>
			<div id='lightbox_comments'>
				{$comments}
			</div>
			<br />
			<a href='{parse url="app=gallery&amp;image={$info['image_id']}" base="public" seotitle="{$info['image_caption_seo']}" template="viewimage"}#commentsStart' title='{$this->lang->words['goto_full_view']}' class='ipsButton_secondary'>{$this->lang->words['go_to_comments']}</a>
			<br /><br />
		</if>
	</div>
	<div id='imageHolder'>
		<a class='lightbox_nav lightbox_load_next' href='#' id='load_next_{$info['image_id']}'><img src='{$this->settings['img_url']}/gallery/lightbox_next.png' alt='' /></a>
		<a class='lightbox_nav lightbox_load_prev' href='#' id='load_prev_{$info['image_id']}'><img src='{$this->settings['img_url']}/gallery/lightbox_prev.png' alt='' /></a>
		<div id='theImage'
			data-imageid="{$info['image_id']}"  
			data-largesrc="{$info['image_url']}"
			data-largedims="{$info['_data']['sizes']['original'][0]}:{$info['_data']['sizes']['original'][1]}"
			data-mediumsrc="{$info['med_image_url']}"
			data-mediumdims="{$info['_data']['sizes']['medium'][0]}:{$info['_data']['sizes']['medium'][1]}"
			data-type="<if test="isMedia:|:$info['image_media']">media<else />image</if>"
		>
			<if test="unApproved:|: ! $info['image_approved']">
				<div class='message error'>{parse expression="sprintf($this->lang->words['gallery_unapproved_image_view'], $this->registry->output->buildUrl("app=gallery&amp;module=images&amp;section=mod&amp;do=approveToggle&amp;val=1&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}", 'public') )"}</div>
			<else />
				<if test="hidden:|: $info['image_approved'] == -1">
					<div class='message error'>{parse expression="sprintf($this->lang->words['gallery_hidden_image_view'], $this->registry->output->buildUrl("app=gallery&amp;module=images&amp;section=mod&amp;do=approveToggle&amp;val=1&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}", 'public') )"}</div>
				</if>
			</if>
			<a href='{parse url="app=gallery&amp;image={$info['image_id']}" base="public" seotitle="{$info['image_caption_seo']}" template="viewimage"}' title='{$this->lang->words['goto_full_view']}' id='theImageAnchor'>
				<if test="isMedia:|:$info['image_media']">
					{$info['movie']}
				</if>
			</a>
		</div>
	</div>
</div>]]></template_content>
      <template_name>ajaxShowImage</template_name>
      <template_data>$info, $author, $comments</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[<embed wmode="opaque" autoplay="true" showcontrols="true" showstatusbar="true" showtracker="true" src="{$file}" width="640" height="480"<if test="hasMIme:|:$mime"> type='{$mime}'</if> />]]></template_content>
      <template_name>mediaEmbedPlayer</template_name>
      <template_data><![CDATA[$file, $playerOptions=array(), $mime='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[{parse addtohead="{$this->settings['public_dir']}flowplayer/flowplayer-3.2.11.min.js" type="javascript"}
<div id="player" style="display:block;width:640px;height:480px;margin:0 auto"></div>
<script type='text/javascript'>
	ipb.gallery.flashPlayerInit( "{parse expression="str_replace( '&amp;', '&', $file )"}", "{$this->settings['public_dir']}flowplayer/flowplayer-3.2.15.swf" );
</script>]]></template_content>
      <template_name>mediaFlashPlayer</template_name>
      <template_data>$file, $playerOptions=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[{parse striping="meta" classes="row1,row2"}
<div id='metacontent' style='display: none'>
	<h3>{$this->lang->words['meta_table_header']}</h3>
	<div class='fixed_inner'>
		<table class='ipb_table'>
			<foreach loop="exif_data:$content as $key => $value">
				<tr class='{parse striping="meta"}'>
					<td class='altrow'><strong>{$key}</strong></td>
					<td>{$value}</td>
				</tr>
			</foreach>
		</table>
	</div>
</div>]]></template_content>
      <template_name>meta_html</template_name>
      <template_data><![CDATA[$content=""]]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[<form action="{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=move&amp;imageid={$image['image_id']}&amp;secure_key={$this->member->form_hash}" base="public"}" method="post">
<h3>{$this->lang->words['img_move_title']}</h3>
<div class='row2 pad' style='text-align: center'>
	<div style="width:auto; display:inline-block; margin: 0 auto; text-align: left;" class='ipsPad'>
		<if test="canMovealbum:|:$data['options']">
			{$this->lang->words['mod_alb_del_move']}
			<select name='move_to_album_id' id='move_to_album_id' class='input_select'>
				<option value='0'>{$this->lang->words['as_select_album']}</option>
				{$data['options']}
			</select>
		</if>
		<if test="canMoveCat:|:count($data['_catOptions'])">
			<br />
			{$this->lang->words['mod_alb_del_movec']}
			<select name='move_to_category_id' id='move_to_category_id' class='input_select'>
				<foreach loop="categories:$data['_catOptions'] as $_cat">
					<option value='{$_cat[0]}'<if test="noImages:|:$_cat[0] AND !in_array( $_cat[0], $data['_acceptImages'] )"> disabled='disabled'</if>>{$_cat[1]}</option>
				</foreach>
			</select>
		</if>
	</div>
 <br /><br />
 <input type='submit' class="input_submit" value="{$this->lang->words['img_move_submit']}" />
</div>
</form>]]></template_content>
      <template_name>moveDialogue</template_name>
      <template_data>$image, $data</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[<php>
	/* Always return as UTF-8 */
	$jsonEncoded = IPSText::jsonEncodeForTemplate( $images );
</php>
<div id='photostripwrap'>
	<div id='photostrip'>
		<div class='left photoStipNav nleft' id='slide_left' style='display:block;'></div>
		<div class='right photoStipNav nright' id='slide_right' style='display:block;'></div>
		<ul id='strip'></ul>
	</div>
</div>
{parse js_module="gallery_photostrip"}
<script type="text/javascript">
	ipb.vars['img_url'] = "{$this->settings['img_url']}";
	
	document.observe("dom:loaded", function(){
		ipb.photostrip.setPhotoData( {$jsonEncoded} );
		ipb.photostrip.display();
	} );
</script>]]></template_content>
      <template_name>photostrip</template_name>
      <template_data>$images=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[<form action="{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=setAsCover&amp;imageId={$image['image_id']}&amp;auth_key={$this->member->form_hash}" base="public"}" method="post">
<h3>{$this->lang->words['cover_set_link']}</h3>
<div class='row2 pad' style='text-align: center; padding-bottom: 10px;'>
	<div style="width:auto; display:inline-block; margin: 0 auto; text-align: left;" class='ipsPad'>
		{$this->lang->words['select_containers_forcover']}<br /><br />
		<select name='cover_containers[]' id='cover_containers' class='input_select' multiple='multiple' size='10'>
			<foreach loop="containerOptions:$options as $option">
				<option value='{$option[0]}'<if test="selected:|:$option[2]"> selected='selected'</if>>{$option[1]}</option>
			</foreach>
		</select>
	</div>
	<br /><br />
	<input type='submit' class="input_submit" value="{$this->lang->words['cover_set_link']}" />
</div>
</form>]]></template_content>
      <template_name>setAsCover</template_name>
      <template_data>$image, $options</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[<php>
	if( $info['image_album_id'] )
	{
		$this->_album		= $this->registry->gallery->helper('albums')->fetchAlbum( $info['image_album_id'] );
	}
	else
	{
		$this->_category	= $this->registry->gallery->helper('categories')->fetchCategory( $info['image_category_id'] );
	}
	ipsRegistry::$settings['gallery_image_url'] = $info['image_url'];
</php>
{parse js_module="editor"}
{parse js_module="imagenotes"}
{parse js_module="gallery_lightbox"}
{parse js_module="gallery_albumchooser"}
{parse addtohead="{$this->settings['public_dir']}js/3rd_party/cropper/cropper.css" type="importcss"}
{parse addtohead="{$this->settings['public_dir']}style_css/{$this->registry->output->skin['_csscacheid']}/ipgallery_lightbox.css" type="importcss"}
{parse addtohead="{$this->settings['public_dir']}js/3rd_party/cropper/cropper.uncompressed.js" type="javascript"}
<script type="text/javascript">
//<!#^#|CDATA|
	ipb.gallery.inSection	= 'image';
	ipb.gallery.imageID		= parseInt( {$info['image_id']} );
	ipb.gallery.isMedia		= parseInt( {$info['image_media']} );
	var curnotes = \$H( {
	<foreach loop="$info['image_notes'] as $k => $v">
		{$k}: { 'top': {$v['top']}, 'left': {$v['left']}, 'height': {$v['height']}, 'width': {$v['width']},
				'content': '{$v['note']}',
				'noteId': '{$v['id']}'
			}<if test="$k != $info['_last_image_note']">,</if>
	</foreach>
						});
								
	var noteTemplate = new Template("<div id='note_#{id}' class='note_wrap rounded ipsPad_half'><div id='note_box_#{id}' class='note_box'><div class='internal'><div id='note_fill_#{id}' class='note_fill'><div id='note_handle_#{id}' class='handle'></div></div></div></div><div id='note_text_#{id}' class='note_text ipsPad_half rounded' style='display: none'>#{text}</div></div>");
	var editTemplate = new Template("<div id='note_form_#{id}' class='note_form rounded ipsPad ipsType_small'><textarea rows='3' cols='20' id='note_content_#{id}'>#{content}</textarea><br /><input type='submit' class='input_submit' value='{$this->lang->words['save']}' id='note_save_#{id}' /> <input type='submit' class='input_submit alt' value='{$this->lang->words['cancel']}' id='note_cancel_#{id}' />&nbsp;&nbsp;<a href='#' class='cancel' id='note_delete_#{id}'>{$this->lang->words['delete']}</a></div>");
//|#^#]>
</script>
<div class='topic_controls right'>
	<if test="hasFollow:|:$follow">
		{$follow}
		<br /><br />
	</if>
	<ul class='topic_buttons'>
		<if test="canIUpload:|:$this->registry->gallery->getCanUpload()">
			<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image" base="public"}'>{$this->lang->words['upload']}</a></li>
		</if>
		<li><a id='imageOptions' class='ipbmenu' href='#imageOptions'>{$this->lang->words['options_ucfirst']} &nbsp;<img src='{$this->settings['img_url']}/opts_arrow.png' alt='&gt;' /></a></li>
	</ul>
</div>
<a href='{parse url="showuser={$author['member_id']}" seotitle="{$author['members_seo_name']}" template="showuser" base="public"}' class='ipsUserPhotoLink'>
	<img src='{$author['pp_small_photo']}' class='ipsUserPhoto ipsUserPhoto_medium left' />
</a>
<div class='ipsBox_withphoto'>
	<span class='rating ipsType_smaller'>
		<if test="canRate:|:$this->registry->gallery->helper('rate')->canRate( $info['image_album_id'] ? $info['image_album_id'] : $info['image_category_id'], null, $info['image_album_id'] ? 'album' : 'category' ) !== false && $this->memberData['member_id'] != $author['member_id']">
			<strong>{$this->lang->words['rate_image']}</strong>&nbsp;&nbsp;
			<foreach loop="voteRatingLoop:array(1,2,3,4,5) as $_rating">
				<a href='{parse url="app=gallery&amp;module=images&amp;section=rate&amp;where=image&amp;id={$info['image_id']}&amp;rating={$_rating}&amp;secure_key={$this->member->form_hash}" base="public"}' id='album_rate_{$_rating}' title='{$this->lang->words[ 'rate_file_' . $_rating ]}'><if test="voteImageRate:|:$info['image_rating'] >= $_rating">{parse replacement="rate_on"}<else />{parse replacement="rate_off"}</if></a>
			</foreach>
			<span id='rating_text' class='desc'>
				<if test="filevotes:|:$info['image_ratings_count'] > 0">{$info['image_ratings_count']} {$this->lang->words['votes_cnt']}</if>
				<if test="fileyourvote:|:$info['rate_rate']">({$this->lang->words['you_voted']} {$info['rate_rate']})</if>
			</span>
			<script type='text/javascript'>
				rating = new ipb.rating( 'album_rate_', { 
									url: 		ipb.vars['base_url'] + 'app=gallery&amp;module=ajax&amp;section=rate&amp;id={$info['image_id']}&where=image&md5check=' + ipb.vars['secure_hash'],
									cur_rating: {parse expression="intval($info['image_rating'])"},
									rated: 		<if test="jsRated:|:$info['rate_rate']">1<else />0</if>,
									allow_rate: 1
								  } );
			</script>
		<else />
			<if test="othersCanRate:|:$this->registry->gallery->helper('rate')->containerCanRate( $info['image_album_id'] ? $info['image_album_id'] : $info['image_category_id'], null, $info['image_album_id'] ? 'album' : 'category' ) !== false">
				<foreach loop="viewRatingLoop:array(1,2,3,4,5) as $_rating">
					<if test="viewImageRate:|:$info['image_rating'] >= $_rating">{parse replacement="rate_on"}<else />{parse replacement="rate_off"}</if>
				</foreach>
			</if>
		</if>
	</span>
	
	<h1 class='ipsType_pagetitle'>{$info['image_caption']}</h1>
	<div class='desc lighter blend_links'>
		 {$this->lang->words['viewimg_uploaded_by']} {parse template="userHoverCard" group="global" params="$author"}, {parse date="$info['image_date']" format="SHORT"}
	</div>
	<if test="hasTags:|:is_array($info['tags'])">
		{$info['tags']['formatted']['parsedWithoutComma']}
	</if>
</div>
<ul class="ipbmenu_content" id='imageOptions_menucontent' style='display:none' >
	<if test="showSizesLink:|:!$info['image_media']">
		<li><a href='{parse url="app=gallery&amp;image={$info['image_id']}&amp;size=medium" seotitle="{$info['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['view_all_sizes']}</a></li>
	</if>
	<if test="metahtml:|:$info['metahtml'] != ''">
		<li><a href='#metaInfo' data-clicklaunch="showMeta" data-scope="gallery" title='{$this->lang->words['view_exif_prop']}'>{$this->lang->words['view_exif_prop']}</a></li>
	</if>
	<if test="setascover:|:$info['set_as_cover']">
		<li id='menu_set_cover'><a data-clicklaunch="imageSetAsCover" data-scope="gallery" href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;imageId={$info['image_id']}&amp;do=setAsCover" base="public"}' title='{$this->lang->words['cover_set_title']}'> {$this->lang->words['set_as_cover']}</a></li>
	</if>
	<if test="makeProfilePhoto:|:$this->memberData['member_id'] && $info['image']">
		<li><a href='#' id='profileTrigger'>{$this->lang->words['set_as_photo']}</a></li>
	</if>
	<li><a href='#shareLinks' data-clicklaunch="showShareLinks" data-scope="gallery">{$this->lang->words['gallery_share_links']}</a></li>
</ul>

<br class='clear' />
<div class='ipsLayout ipsLayout_withright ipsLayout_hugeright'>
	<div class='ipsLayout_right'>
		<div class='ipsBox'>
			<div class='ipsBox_container ipsPad'>
				<ul class='image_info ipsType_small'>
				<li><strong>{$this->lang->words['viewimg_owner']}:</strong> {parse template="userHoverCard" group="global" params="$author"}<if test="notGuest:|:$author['member_id']"> (<a href="{parse url="app=gallery&amp;user={$author['member_id']}" seotitle="{$author['members_seo_name']}" template="useralbum" base="public"}">{$this->lang->words['view_all_albums']}</a>)</if></li>
					<li><strong>{$this->lang->words['uploaded_ucfirst']}:</strong> {parse date="$info['image_date']" format="short"}</li>
					<if test="$info['_camera_model']">
						<li><strong>{$this->lang->words['camera_ucfirst']}:</strong> {$info['_camera_model']}</li>
					</if>
					<if test="$info['_date_taken']">
						<li><strong>{$this->lang->words['taken_ucfirst']}:</strong> {$info['_date_taken']}</li>
					</if>
					<li><strong>{$this->lang->words['views']}</strong> {parse format_number="$info['image_views']"}</li>
					<if test="imageHasNotes:|:count($info['image_notes'])">
						<li><strong>{$this->lang->words['note_count']}</strong> {parse format_number="count($info['image_notes'])"}</li>
					</if>
					<li>
						<if test="isinAlbum:|:$info['image_album_id']">
							<strong>{$this->lang->words['viewimg_album']}:</strong> <a href="{parse url="app=gallery&amp;album={$this->_album['album_id']}" seotitle="{$this->_album['album_name_seo']}" template="viewalbum" base="public"}">{$this->_album['album_name']}</a>
						<else />
							<strong>{$this->lang->words['viewing_category']}:</strong> <a href="{parse url="app=gallery&amp;category={$this->_category['category_id']}" seotitle="{$this->_category['category_name_seo']}" template="viewcategory" base="public"}">{$this->_category['category_name']}</a>
						</if>
					</li>
				</ul>
				<if test="hascopyright:|:$info['image_copyright'] != ''">
					<br />
					<div class='ipsBox ipsType_small'>
						<strong>{$this->lang->words['user_copyright_name']}</strong>
						<p class='desc'>{$info['image_copyright']}</p>
					</div>
				</if>
			</div>
			<if test="maps:|:$this->settings['map_bing_api_key'] AND ( ($info['_latLon'] && $info['image_gps_show']) || ($info['_latLon'] && $this->memberData['member_id'] == $info['image_member_id']) )">
				<br />
				<div class='ipsBox_container ipsPad'>
					<if test="gpsOn:|:$info['image_gps_show']">
						<h4 id='map_on_header' class='__mapon'>{$this->lang->words['image_view_location']}
						<if test="geoData:|:$info['_locShort']">
							<span class='desc' style='font-weight:normal'>
								&nbsp; {$info['_locShort']}
							</span>
						</if>
						</h4>
					<else />
					<if test="isMe:|:$this->memberData['member_id'] == $info['image_member_id']">
						<h4 id='map_off_header'>{$this->lang->words['image_view_location']}
							<span class='desc __mapoff' style='font-weight:normal'>&nbsp;({$this->lang->words['private_ucfirst']})</span>
						</h4>
						<div class='desc __mapoff'>
							{$this->lang->words['photo_taken_at']}: {$info['_locShort']}
							<br /><br /><a href='#addMap' data-clicklaunch="addMap" data-scope="gallery">{$this->lang->words['img_make_loc_public']}</a>
						</div>
					</if>
					</if>
					<div id="map" class='__mapon ipsPad_half' style="margin:0 auto; width: 300px; display: none">
						<a href="{$info['_mapUrl']}" rel="newwindow"><img id='map_0' src="{$info['_maps'][0]}" alt="map" /></a>
						<img style='display:none' id='map_1' src="{$info['_maps'][1]}" alt="map" />
						<if test="isStillMe:|:$this->memberData['member_id'] == $info['image_member_id']"><div class='desc' style='text-align:right;padding-top:3px'><a href='#removeMap' data-clicklaunch="removeMap" data-scope="gallery">{$this->lang->words['img_remove_map']}</a></div></if>
					</div>
				</div>
			</if>
		</div>
	</div>
	<div class='ipsLayout_content' id='image_content'>
		<div class='ipsBox'>
			<div class='ipsBox_container ipsPad short'>
				<div id='theImage'>
					<if test="unApproved:|: $info['image_approved'] == 0">
						<div class='message error'>{parse expression="sprintf($this->lang->words['gallery_unapproved_image_view'], $this->registry->output->buildUrl("app=gallery&amp;module=images&amp;section=mod&amp;do=approveToggle&amp;val=1&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}", 'public') )"}</div>
						<br />
					<else />
						<if test="hidden:|: $info['image_approved'] == -1">
							<div class='message error'>{parse expression="sprintf($this->lang->words['gallery_hidden_image_view'], $this->registry->output->buildUrl("app=gallery&amp;module=images&amp;section=mod&amp;do=approveToggle&amp;val=1&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}", 'public') )"}</div>
							<br />
						</if>
					</if>
					<if test="isMedia:|:$info['image_media']">
						{$info['movie']}
					<else />
						{$info['image']}
					</if>
				</div>
				
				<if test="hasDescription:|:$info['image_description']">
					<p class='ipsPad'>
						{$info['image_description']}
					</p>
				</if>
				{$photostrip}
				<br />
				<if test="hasOptions:|:$info['mod_buttons'] || $info['image_control_mod'] || $info['_canReport']">
					<ul class='ipsList_inline left'>
						<if test="showImageOptions:|:$info['image_control_mod']">
							<li id='add_note'><a href='#' title='{$this->lang->words['add_note']}' class='ipsButton_secondary'><img src="{$this->settings['img_url']}/gallery/add_note.png"></a></li>
							<li><a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;imageId={$info['image_id']}&amp;do=rotate&amp;dir=left&amp;secure_key={$this->member->form_hash}" base="public"}' id='rotate_left' title='{$this->lang->words['rotate_left']}' class='ipsButton_secondary'><img src="{$this->settings['img_url']}/gallery/rotate_left.png"></a></li>
							<li><a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;imageId={$info['image_id']}&amp;do=rotate&amp;dir=right&amp;secure_key={$this->member->form_hash}" base="public"}' id='rotate_right' title='{$this->lang->words['rotate_right']}' class='ipsButton_secondary'><img src="{$this->settings['img_url']}/gallery/rotate_right.png"></a></li>
						</if>
						<if test="showImageModerationOptions:|:$info['mod_buttons']">
							<li><a href='#modOptions' id='modOptions' class='ipsButton_secondary ipbmenu'>{$this->lang->words['image_moderation']}</a></li>
							<ul class='ipbmenu_content' id='modOptions_menucontent' style='display:none'>
								<if test="isAModerator:|:$this->registry->gallery->helper('categories')->checkIsModerator( $info['image_category_id'] )">
									<li>
										<if test="is_pinned:|:$info['image_pinned'] == 1">
											<a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=pinToggle&amp;val=0&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['unpinimagelink']}</a>
										<else />
											<a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=pinToggle&amp;val=1&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['pinimagelink']}</a>
										</if>
									</li>
									<if test="notMedia:|:$info['image_media'] == 0">
										<li>
											<if test="is_featured:|:$info['image_feature_flag'] == 1">
												<a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=featureToggle&amp;val=0&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['unfeature_image']}</a>
											<else />
												<a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=featureToggle&amp;val=1&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['feature_image']}</a>
											</if>
										</li>
									</if>
								</if>
								<if test="is_approved:|:$info['image_approved'] == 1 AND $this->registry->gallery->helper('categories')->checkIsModerator( $info['image_category_id'], null, 'mod_can_hide' )">
									<li>
										<a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=approveToggle&amp;val=0&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['unapprove_image']}</a>
									</li>
								</if>
								<if test="is_approved:|:$info['image_approved'] != 1 AND $this->registry->gallery->helper('categories')->checkIsModerator( $info['image_category_id'], null, 'mod_can_approve' )">
									<li>
										<a href='{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=approveToggle&amp;val=1&amp;imageid={$info['image_id']}&amp;auth_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['approve_image']}</a>
									</li>
								</if>
								<if test="edit_button:|:$info['edit_button']">
									<li><a href='{parse url="app=gallery&amp;module=post&amp;section=image&amp;do=editImage&amp;img={$info['image_id']}" base="public"}'>{$this->lang->words['edit_post']}</a></li>
								</if>
								<if test="move_button:|:$info['move_button']">
									<li><a data-clicklaunch="imageMoveDialogue" data-scope="gallery" href="{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=move&amp;imageid={$info['image_id']}" base="public"}">{$this->lang->words['submit_move']}</a></li>
								</if>
								<if test="delete_button:|:$info['delete_button']">
									<li><a data-clicklaunch="imageDeleteDialogue" data-scope="gallery" href="{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=delete&amp;imageid={$info['image_id']}&amp;secure_key={$this->member->form_hash}" base="public"}">{$this->lang->words['delete_image']}</a></li>
								</if>
							</ul>
						</if>
						<if test="canReportImage:|:$info['_canReport']">
							<li><a class='ipsButton_secondary' href='{parse url="app=core&amp;module=reports&amp;rcom=gallery&amp;imageId={$info['image_id']}&amp;ctyp=image" base="public"}'>{$this->lang->words['report_image']}</a></li>
						</if>
					</ul>
				</if>
				<!-- Reputation: -->
				<div class='clearfix'>
				{parse template="repButtons" group="global_other" params="$info, array_merge( array( 'primaryId' => $info['image_id'], 'domLikeStripId' => 'like_post_' . $info['image_id'], 'domCountId' => 'rep_post_' . $info['image_id'], 'app' => 'gallery', 'type' => 'image_id', 'likeFormatted' => $info['like']['formatted'] ), $info )"}
				</div>
			</div>
		</div>
		<if test="hasShareReportLinks:|:$this->settings['sl_enable']">
			<div class='ipsPad'>
				{IPSLib::shareLinks( $info['image_caption'], array( 'skip' => array( 'print', 'download' ), 'group' => 'gallery_global' ) )}
			</div>
			<br />
		</if>
		
		<if test="hasComments:|:$comments">
			{$comments}
		</if>
	</div>
</div>
<br class='clear' />
{$info['metahtml']}
<div id='share_links_content' style='display: none'>
	<h3>{$this->lang->words['gallery_share_links']}</h3>
		<table class='ipb_table'>
			<if test="isNotMedia:|:!$info['image_media']">
				<tr class='{parse striping="shareLinks"}'>
					<td class='altrow'><strong>{$this->lang->words['gal_bbcode_pre']}</strong></td>
					<td><input onclick="this.select();" type='text' size='50' readonly='readonly' name='bbcode1' value='[URL={parse url="app=gallery&amp;image={$info['image_id']}" base="public" template="viewimage" seotitle="{$info['image_caption_seo']}"}][IMG]{$info['image_url']}[/IMG][/URL]' class='input_text' /></td>
				</tr>
				<tr class='{parse striping="shareLinks"}'>
					<td class='altrow'><strong>{$this->lang->words['gal_html_pre']}</strong></td>
					<td><input onclick="this.select();" type='text' size='50' readonly='readonly' name='html1' value='&lt;a href=&#39;{parse url="app=gallery&amp;image={$info['image_id']}" base="public" template="viewimage" seotitle="{$info['image_caption_seo']}"}&#39;&gt;&lt;img src=&#39;{$info['image_url']}&#39; alt=&#39;{parse expression="htmlspecialchars( $info['image_caption'], ENT_QUOTES )"}&#39; /&gt;&lt;/a&gt;' class='input_text'/></td>
				</tr>
				<tr class='{parse striping="shareLinks"}'>
					<td class='altrow'><strong>{$this->lang->words['gal_imgurl_pre']}</strong></td>
					<td><input onclick="this.select();" type='text' size='50' readonly='readonly' name='link1' value='{$info['image_url']}' class='input_text' /></td>
				</tr>
			</if>
			<tr class='{parse striping="shareLinks"}'>
				<td class='altrow'><strong>{$this->lang->words['gal_pgurl_pre']}</strong></td>
				<td><input onclick="this.select();" type='text' size='50' readonly='readonly' name='link2' value='{parse url="app=gallery&amp;image={$info['image_id']}" base="public" template="viewimage" seotitle="{$info['image_caption_seo']}"}' class='input_text' /></td>
			</tr>
		</table>
</div>
<div id='template_sizes' style='display:none'>
	<div class='ipsBox short'>
		{$this->lang->words['view_sizes']}: <a href='{parse url="app=gallery&amp;image={$info['image_id']}&amp;size=square" seotitle="{$info['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['square_ucfirst']}</a> &middot;
		<if test="doSmallContext:|:$this->settings['gallery_small_image_width'] AND $this->settings['gallery_small_image_height']"><a href='{parse url="app=gallery&amp;image={$info['image_id']}&amp;size=small" seotitle="{$info['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['small_ucfirst']}</a> &middot;</if>
		<if test="doMediumContext:|:$this->settings['gallery_medium_width'] AND $this->settings['gallery_medium_height']"><a href='{parse url="app=gallery&amp;image={$info['image_id']}&amp;size=medium" seotitle="{$info['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['medium_ucfirst']}</a> &middot;</if>
		<a href='{parse url="app=gallery&amp;image={$info['image_id']}&amp;size=large" seotitle="{$info['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['large_ucfirst']}</a>
		<br />
		<p class='ipsPad_half'>
			<a href='{$info['image_url']}' class='desc'>{$this->lang->words['img_rc_direct']}</a>
		</p>
	</div>
</div>
<div id='template_delete' style='display:none'>
	<form action="{parse url="app=gallery&amp;module=images&amp;section=mod&amp;do=delete&amp;imageid={$info['image_id']}&amp;secure_key={$this->member->form_hash}" base="public"}" method="post">
		<h3>{$this->lang->words['mod_img_del_title']}</h3>
		<div class='ipsBox short'>
			{$this->lang->words['mod_img_del_desc']}
			<br /><br />
			<input type='submit' class='input_submit' value="{$this->lang->words['mod_img_del_go']}" />
		</div>
	</form>
</div>
<div id='template_photo' style='display:none'>
	<h3>{$this->lang->words['set_as_photo']}</h3>
	<div class='ipsBox short'>
		<div id='ipsPad'>{parse expression="str_replace( 'image_view_', 'photo_view_', $info['image'])"}</div>
		<br />
		<div class='ipsPad'>
			<span id='setAsPhoto_accept' class='input_submit'>{$this->lang->words['save_ucfirst']}</span>&nbsp;&nbsp;<span id='setAsPhoto_cancel' class='input_submit alt'>{$this->lang->words['cancel_ucfirst']}</span>
		</div>
	</div>
</div>
<script type='text/javascript'>
	document.observe("dom:loaded", function()
	{
		var notes = new ipb.imagenotes( $('theImage').down('img'), curnotes, { editable: <if test="$info['image_control_mod']">true<else />false</if>, add_note: $('add_note') } );
	} );
	
	<if test="$info['image_gps_show']">
		ipb.gallery.latLon = "{$info['_latLon']}";
	</if>
</script>
<div id="ips_lightbox" style='display:none' setup="false" available="true" dimensions="{$info['_data']['sizes']['full'][0]}-{$info['_data']['sizes']['full'][1]}" caption="{$info['image_caption']}" fullimage="{$info['image_url']}"></div>]]></template_content>
      <template_name>show_image</template_name>
      <template_data><![CDATA[$info=array(), $author=array(), $photostrip='', $comments='', $nextPrev=array(), $follow='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{$image['image_caption']}</h1>
<div class='gallery_wrap'>
	<div id="photo_sizes">
		<ul class='gallery_buttons'>
			<li>
				<a <if test="$size == 'square'">class="on"</if> href='{parse url="app=gallery&amp;image={$image['image_id']}&amp;size=square" seotitle="{$image['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['square_ucfirst']}</a>
				<span>({$image['_data']['sizes']['thumb'][0]} x {$image['_data']['sizes']['thumb'][1]})</span>
			</li>
			<if test="doSmall:|:$this->settings['gallery_small_image_width'] AND $this->settings['gallery_small_image_height']">
		 		<li>
		 			<a <if test="$size == 'small'">class="on"</if> href='{parse url="app=gallery&amp;image={$image['image_id']}&amp;size=small" seotitle="{$image['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['small_ucfirst']}</a>
		 			<span>({$image['_data']['sizes']['small'][0]} x {$image['_data']['sizes']['small'][1]})</span>
		 		</li>
		 	</if>
		 	<if test="doMedium:|:$this->settings['gallery_medium_width'] AND $this->settings['gallery_medium_height']">
		 		<li>
		 			<a <if test="$size == 'medium'">class="on"</if> href='{parse url="app=gallery&amp;image={$image['image_id']}&amp;size=medium" seotitle="{$image['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['medium_ucfirst']}</a>
		 			<span>({$image['_data']['sizes']['medium'][0]} x {$image['_data']['sizes']['medium'][1]})</span>
		 		</li>
		 	</if>
	 		<li>
	 			<a <if test="$size == 'large'">class="on"</if> href='{parse url="app=gallery&amp;image={$image['image_id']}&amp;size=large" seotitle="{$image['image_caption_seo']}" template="viewsizes" base="public"}'>{$this->lang->words['large_ucfirst']}</a>
	 			<span>({$image['_data']['sizes']['max'][0]} x {$image['_data']['sizes']['max'][1]})</span>
	 		</li>
	 	</ul>
	 	<p>
	 		{$image['tag']}
	 	</p>
	 </div>
</div>]]></template_content>
      <template_name>sizes</template_name>
      <template_data><![CDATA[$image, $size=""]]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_img</template_group>
      <template_content><![CDATA[{parse js_module="slideshow"}
<script type='text/javascript'>
	/* URL to full-size images */
<if test="$this->settings['gallery_images_url']">
	ipb.slideshow.imageURL = "{$this->settings['gallery_images_url']}/";
<else />
	ipb.slideshow.imageURL = ipb.vars['base_url'] + "app=gallery&module=images&section=img_ctrl";
</if>
	/* The image ID's in order to be displayed */
	var IMAGES = [ {$imageIds} ];
	/* Array of image data, order doesn't matter. Key is image ID to match above array */
	var IMAGE_DATA = \$H({
<foreach loop="$imageData as $r">
						{$r['image_id']}: { 	
										'title': '{$r['image_caption']}',
<if test="$this->settings['gallery_images_url']">
						 				'filename': '{$r['image_directory']}/{$r['image_masked_file_name']}',
										'thumb': '{$r['image_directory']}/tn_{$r['image_masked_file_name']}',
<else />
										'filename': '&img={$r['image_id']}',
										'thumb': '&img={$r['image_id']}&tn=1',
</if>
										'author': {
													'id': {$r['image_member_id']},
													'name': '{$r['members_display_name']}',
													'photo': '{$r['_photo']['pp_small_photo']}',
													'width': '{$r['_photo']['pp_small_width']}',
													'height': '{$r['_photo']['pp_small_height']}'
												}
									}<if test="$lastID != $r['image_id']">,</if>
</foreach>
						});
	/* URL to where user photos will be */
	ipb.slideshow.userPhotoURL = "";
	/* Just templates */
	ipb.slideshow.userInfo = new Template("<div id='info_#{id}' class='info' style='display: none'><img src='#{photo}' width='#{width}' height='#{height}' class='photo' /><div class='info_body'><h1>#{title}</h1><h2>{$this->lang->words['by_ucfirst']} #{name}</h2></div>");
	ipb.slideshow.thumbnail = new Template("<div id='thumb_#{id}' class='thumb'></div>");
</script>
<div id='slideshow'>
	
	<div id='image_info'></div>
	<div id='thumbnail_bar'>
		<div id='thumbnails'>
			<div id='thumbnail_wrap'></div>
		</div>
		<div id='button_left'></div>
		<div id='button_right'></div>
	</div>
	<div id='image_holder'></div>
	<div id='slideshow_controls'>
		<div id='controls'><a href='#' id='c_PREV' class='control' title='{$this->lang->words['previous_image']}'>&nsbp;</a><a href='#' id='c_PAUSE_PLAY' class='control' title='{$this->lang->words['ss_playpause']}'>&nsbp;</a><a href='#' id='c_NEXT' class='control' title='{$this->lang->words['ss_next_img']}'>&nsbp;</a></div>
		<div id='loading'></div>
	</div>
	<a href='{$containerUrl}' id='close_slideshow'>{$this->lang->words['ss_back']}</a>
</div>
<div style='display: none'>
	<img src='{$this->settings['img_url']}/gallery/slideshow/next.png' />
	<img src='{$this->settings['img_url']}/gallery/slideshow/next_hover.png' />
	<img src='{$this->settings['img_url']}/gallery/slideshow/prev.png' />
	<img src='{$this->settings['img_url']}/gallery/slideshow/prev_hover.png' />
	<img src='{$this->settings['img_url']}/gallery/slideshow/pause.png' />
	<img src='{$this->settings['img_url']}/gallery/slideshow/play.png' />
	<img src='{$this->settings['img_url']}/gallery/slideshow/pause_hover.png' />
	<img src='{$this->settings['img_url']}/gallery/slideshow/play_hover.png' />
</div>]]></template_content>
      <template_name>slideShow</template_name>
      <template_data>$containerUrl, $imageIds, $imageData, $lastID</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_gallery_post">
    <template>
      <template_group>skin_gallery_post</template_group>
      <template_content><![CDATA[<html>
	<body style='background-color: transparent;'>
		<form id='mtiframeUploadForm' method='post' enctype="multipart/form-data" action=''>
			<script type='text/javascript'>
				parent.ipb.gallery.mediaUpload._setJSON( '$id', $JSON );
			</script>
			<input type='file' id='mtiframeUploadBox_{$id}' style='display: inline' name='FILE_UPLOAD' /> <input type='reset' value='{$this->lang->words['clear_selection']}' style='display: inline' />
		</form>
	</body>
</html>]]></template_content>
      <template_name>attachiFrameMediaThumb</template_name>
      <template_data><![CDATA[$id, $JSON='{}']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_post</template_group>
      <template_content><![CDATA[<html>
	<head>
		<style type="text/css">
			* {
				margin: 0px;
				padding: 0px;
			}
			
			#waitImg {
				position: relative;
				top: 4px;
			}
			
			.input {
				padding: 4px;
				background-color: #1D3652;
				border-color: #4F7298 #113051 #113051 #4F7298;
				color: white;
			}
		</style>
	</head>
	<body style='background-color: transparent; width: 400px;'>
		<form id='iframeUploadForm' method='post' enctype="multipart/form-data" action=''>
			<script type='text/javascript'>
				parent.ipb.uploader._jsonPass( '$id', $JSON );
			</script>
			<input type='file' id='iframeUploadBox_{$id}' style='display: inline' class='input_text' name='FILE_UPLOAD' /> <input type='reset' class='input_submit alt' value='{$this->lang->words['clear_selection']}' style='display: inline' />
			<img src="{$this->settings['img_url']}/loading.gif" style='display: none' id="waitImg" />
			<br /><br/><span class='desc lighter ipsType_smaller' id='help_msg'>
				<if test="flashuploadhelp:|:$this->memberData['member_uploader'] == 'flash'">
					 {$this->lang->words['trouble_uploading']} <a href='#' data-switch='default' title='{$this->lang->words['switch']}' tabindex='1'>{$this->lang->words['switch_to_basic']}</a>
				<else />
					<a href='#' data-switch='flash' title='{$this->lang->words['switch']}' tabindex='-1'>{$this->lang->words['switch_to_advanced']}</a>
				</if>
			</span>
		</form>
	</body>
</html>]]></template_content>
      <template_name>attachiFrameUpload</template_name>
      <template_data><![CDATA[$id, $JSON='{}']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_post</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['editing_image'], $image['image_caption'] )"}</h1>
<br />
<if test="hasErrors:|:is_array($errors) && count($errors)">
	<div class='message error'>
		{parse expression="implode( '<br />', $errors )"}
	</div>
	<br />
</if>
<if test="hasPreview:|:$preview">
	<h3 class='maintitle'>{$this->lang->words['form_preview']}</h3>
	<div class='ipsBox'>
		<div class='ipsBox_container ipsPad'>
			{$preview}
		</div>
	</div>
	<br />
</if>
<form method='post' action="{parse url="app=gallery&amp;module=post&amp;section=image&amp;do=editImageSave" base="public"}" enctype="multipart/form-data">
	<input type="hidden" name="img" value="{$image['image_id']}" />
	<input type="hidden" name="secure_key" value="{$this->member->form_hash}" />
	<div class='ipsBox'>
		<div class='ipsBox_container ipsPad'>
			<div class='ipsLayout ipsLayout_withleft ipsLayout_smallleft clearfix'>
				<div class='ipsLayout_left'>
					{parse gallery_resize="$image['thumb']" width="thumb_large"}
				</div>
				<div class='ipsLayout_content'>
					<ul class='ipsForm ipsForm_vertical'>
						<li class='ipsField'>
							<label class='ipsField_title'>{$this->lang->words['title_ucfirst']}</label>
							<p class='ipsField_content'><input type='text' name='image_caption' class='input_text' style='width:95%;' value='{$image['_image_caption']}' /></p>
						</li>
						<if test="hasTags:|:$image['_tagBox']">
							<li class='ipsField'>
								<label class='ipsField_title'>{$this->lang->words['review_tags']}</label>
								<div class='ipsField_content'>
								{$image['_tagBox']}
								</div>
							</li>
						</if>
						<li class='ipsField'>
							<label class='ipsField_title'>{$this->lang->words['description_ucfirst']}</label>
							<div class='ipsField_content'>
								{$image['editor']}
							</div>
						</li>
						<if test="geo:|:$image['image_gps_lat'] AND $image['image_loc_short']">
							<li class='ipsField ipsField_checkbox'>
								<input type='checkbox' id='image_gps_show' name='image_gps_show' <if test="clickGps:|:$image['image_gps_show']">checked='checked'</if> value='1' />
								<label for='image_gps_show'>
									<p class='class='ipsField_content'>
										&nbsp;{$this->lang->words['review_show_loc']} <span class='desc'>({$image['image_loc_short']})</span>
									<p>
								</label>
							</li>
						</if>
						<li class='ipsField'>
							<label class='ipsField_title'>{$this->lang->words['copyright_ucfirst']}</label>
							<p class='ipsField_content'><input type='text'name='image_copyright' class='input_text' style='width:95%;' value='{$image['image_copyright']}' /></p>
						</li>
						<li class='ipsField'>
							<label class='ipsField_title'><if test="mediaFieldtitle:|:$image['image_media']">{$this->lang->words['upload_new_movie']}<else />{$this->lang->words['upload_new_image']}</if></label>
							<p class='ipsField_content'>
								<input type='file' class='input_upload' name='newImage' />
								<div class='desc'><if test="mediaFielddesc:|:$image['image_media']">{$this->lang->words['upload_new_movie_desc']}<else />{$this->lang->words['upload_new_image_desc']}</if></div>
							</p>
						</li>
						<if test="isMedia:|:$image['image_media']">
							<li class='ipsField'>
								<label class='ipsField_title'>{$this->lang->words['upload_new_thumb']}</label>
								<p class='ipsField_content'>
									<input type='file' class='input_upload' name='FILE_UPLOAD' />
									<div class='desc'>{$this->lang->words['upload_new_thumb_desc']}</div>
								</p>
							</li>
						</if>
					</ul>
				</div>
			</div>				
		</div>
		<br />
	</div>
	<fieldset class='submit'>
		<input type='submit' name='dosubmit' value='{$this->lang->words['edit_post']}' class='input_submit' tabindex='0' />&nbsp;<input type='submit' name='preview' value='{$this->lang->words['form_preview']}' class='input_submit alt' tabindex='0' />
		{$this->lang->words['or']} <a href='{parse url="app=gallery&amp;image={$image['image_id']}" template="viewimage" seotitle="{$image['image_caption_seo']}" base="public"}' title='{$this->lang->words['cancel']}' class='cancel' tabindex='0'>{$this->lang->words['cancel']}</a>
	</fieldset>
</form>]]></template_content>
      <template_name>editImageForm</template_name>
      <template_data><![CDATA[$image=array(), $album=array(), $category=array(), $errors=array(), $preview='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_post</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{$this->lang->words['temp_uploads_unfinished']}</h1>
<br />
<div class='ipsBox'>
	<div class='ipsBox_container ipsPad previousSession'>
		<span>{$this->lang->words['temp_uploads_unfinished_desc']}</span>
		<div class='previousSessionOptions'>
			<a class='input_submit' href='{parse url="app=gallery&amp;module=images&amp;section=review&amp;do=show&amp;sessionKey={$sessionKey}" base="public"}'>{$this->lang->words['finalize_temp_images']}</a>
			{$this->lang->words['or']}
			<a class='cancel' href='{parse url="app=gallery&amp;module=post&amp;section=image&amp;continue=1&amp;album={$this->request['album']}&amp;category={$this->request['category']}" base="public"}'>{$this->lang->words['cancel_temp_images']}</a>
		</div>
	</div>
</div>]]></template_content>
      <template_name>finishPreviousSession</template_name>
      <template_data><![CDATA[$sessionKey='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_post</template_group>
      <template_content><![CDATA[{parse js_module="gallery"}
{parse js_module="gallery_albumchooser"}
<form method="post" id='postingform' action="{parse url="app=gallery&amp;module=images&amp;section=review&amp;do=process" base="public"}">
	<input type="hidden" name="sessionKey" value="{$opts['sessionKey']}" />
	<input type="hidden" name="album_id" value="{$album['album_id']}" />
	<input type="hidden" name="category_id" value="{$category['category_id']}" />
	<input type="hidden" name="type" value="{$type}" />
	<input type="hidden" name="secure_key" value="{$this->member->form_hash}" />
	<input type="hidden" name="start" value="{$opts['start']}" />
	
	<if test="isReviewingUpload:|:$type == 'uploads'">
		<h1 class='ipsType_pagetitle'>{$this->lang->words['upload_ucfirst']}</h1>
		<br />
		<div class='ipsSteps clearfix'>
			<ul>
				<li class="ipsSteps_done">
					<strong class='ipsSteps_title'>{parse expression="sprintf( $this->lang->words['step'], '1' )"}</strong>
					<span class='ipsSteps_desc'>{$this->lang->words['review_step_upload']}</span>
					<span class='ipsSteps_arrow'>&nbsp;</span>
				</li>
				<li class="ipsSteps_active">
					<strong class='ipsSteps_title'>{parse expression="sprintf( $this->lang->words['step'], '2' )"}</strong>
					<span class='ipsSteps_desc'>{$this->lang->words['review_step_publish']}</span>
					<span class='ipsSteps_arrow'>&nbsp;</span>
				</li>	
			</ul>
		</div>
		<br />
		
		<if test="isModerating:|:$category['category_approve_img'] AND !$this->registry->gallery->helper('categories')->checkIsModerator( $category['category_id'], null, 'mod_can_approve' ) AND !in_array( $category['category_id'], $this->registry->gallery->helper('categories')->member_access['bypass'] )">
			<div class='message unspecific'>
				<h3>{$this->lang->words['image_approval_required']}</h3>
				<p>{$this->lang->words['image_approval_required_text']}</p>
			</div>
			<br />
		</if>
		<if test="coverUploadsAlbum:|:$album['album_id']">
			<if test="hasAlreadyCoverUpload:|:$album['_hasCoverSet'] == 'elsewhere'">
				{$album['cover']['tag']}
				<div class='ipsBox_withphoto clearfix ipgallery_h1image_title'>
					<h2 class='ipsType_subtitle'>{$this->lang->words['review_sel_album']} {$album['album_name']}</h2>
					<br /><input type='radio' id='keep_cover' name='makeCover' value='0' checked="checked"> <label for="keep_cover">&nbsp;{$this->lang->words['review_cover_img']}</label>
				</div>
			<else />
				<h2 class='ipsType_subtitle'>{$this->lang->words['review_sel_album']} {$album['album_name']}</h2>
			</if>
		<else />
			<if test="hasAlreadyCoverUpload:|:$category['_hasCoverSet'] == 'elsewhere'">
				{$category['cover']['tag']}
				<div class='ipsBox_withphoto'>
					<h2 class='ipsType_subtitle'>{$this->lang->words['review_sel_category']} {$category['category_name']}</h2>
					<br /><input type='radio' id='keep_cover' name='makeCover' value='0' checked="checked"> <label for="keep_cover">&nbsp;{$this->lang->words['review_cover_img']}</label>
				</div>
			<else />
				<h2 class='ipsType_subtitle'>{$this->lang->words['review_sel_category']} {$category['category_name']}</h2>
			</if>
		</if>
	<else />
		<h1 class='ipsType_pagetitle'>{$this->lang->words['review_title_' . $type ]}</h1>
		<br />
		
		<div class='ipsBox'>
			<div class='ipsBox_container ipsPad'>
				<div class='ipsLayout ipsLayout_withleft ipsLayout_smallleft clearfix'>
					<div class='ipsLayout_left short'>
						<ul class='ipsForm ipsForm_vertical'>
							<li class='ipsField'>
								<label class='ipsField_title'>{$this->lang->words['current_cover']}</label>
								<p class='ipsField_content'>
									{$album['thumb']}
									<if test="hasAlreadyCoverEdit:|:$album['_hasCoverSet'] == 'elsewhere'">
										<br /><span class='ipsPad_half'><input type='radio' id='keep_cover' name='makeCover' value='0' checked="checked"> <label for="keep_cover">&nbsp;{$this->lang->words['review_cover_img']}</label></span>
									</if>
								</p>
							</li>
						</ul>
					</div>
					<div class='ipsLayout_content'>
						<ul class='ipsForm ipsForm_horizontal'>
							<li class='ipsField'>
								<label class='ipsField_title'>{$this->lang->words['album_name']}</label>
								<p class='ipsField_content'><input type='text' name='album_name' class='input_text' value="{$album['album_name']}" size='34' /></p>
							</li>
							<li class='ipsField ipsField_select'>
								<label class='ipsField_title'>{$this->lang->words['parent_album']}</label>
								<div class='ipsField_content'>
									<select name='album_category_id' id='album_category_id'>
										<foreach loop="categories:$album['_catOptions'] as $_category">
											<option value='{$_category[0]}'<if test="notAvail:|:!in_array( $_category[0], $album['_acceptAlbums'] )"> disabled='disabled'</if><if test="isOurCat:|:$album['album_category_id'] == $_category[0]"> selected='selected'</if>>{$_category[1]}</option>
										</foreach>
									</select>
								</div>
							<li>
							<li class='ipsField'>
								<label class='ipsField_title'>{$this->lang->words['review_desc']}</label>
								<p class='ipsField_content'>
									<textarea name="album_description" class='input_text' style='width: 260px; height: 100px;'>{$album['album_description']}</textarea>
								</p>
							</li>
							<li class='ipsField ipsField_select'>
								<label class='ipsField_title'>{$this->lang->words['album_type']}</label>
								<div class='ipsField_content'>
									<if test="canChangeType:|:$album['album_category_id'] == $this->settings['gallery_members_album']">
										<select name="album_type"<if test="blockAlbumType:|:!$album['_catDefaults']['album_type_edit']"> disabled='disabled'</if>>
											<option value="1" <if test="isSel0:|:$album['album_type'] == 1">selected='selected'</if>>{$this->lang->words['public_album']}</option>
											<option value="2" <if test="isSel1:|:$album['album_type'] == 2">selected='selected'</if>>{$this->lang->words['private_album']}</option>
											<option value="3" <if test="isSel2:|:$album['album_type'] == 3">selected='selected'</if>>{$this->lang->words['friend_album']}</option>
										</select>
									<else />
										<input type='hidden' name='album_type' value='1' />
										{$this->lang->words['public_album']}
										<div class='desc'>{$this->lang->words['only_public_albums_here']}</div>
									</if>
								</div>
							</li>
							<li class='ipsField ipsField_select'>
								<label class='ipsField_title'>{$this->lang->words['album_sorting']}</label>
								<div class='ipsField_content'>
									<select name="album_sort_options__key"<if test="sortKeyEdit:|:!$album['_catDefaults']['album_sort_edit']"> disabled='disabled'</if>>
										<foreach loop="sortOptions:array('image_date','image_views','image_comments','image_rating', 'image_caption' ) as $field">
											<option value="{$field}" <if test="thisSortKey:|:($album['_catDefaults']['album_sort_edit'] AND $album['album_sort_options__key'] == $field) OR (!$album['_catDefaults']['album_sort_edit'] AND $album['_catDefaults']['album_sort_options']['key'] == $field)">selected='selected'</if>>{$this->lang->words['album_sort_' . $field ]}</option>
										</foreach>
									</select>
									<select name="album_sort_options__dir"<if test="sortOrderEdit:|:!$album['_catDefaults']['album_sort_edit']"> disabled='disabled'</if>>
										<foreach loop="dirOptions:array('asc', 'desc' ) as $field">
											<option value="{$field}" <if test="thisSortOrder:|:($album['_catDefaults']['album_sort_edit'] AND $album['album_sort_options__dir'] == $field) OR (!$album['_catDefaults']['album_sort_edit'] AND $album['_catDefaults']['album_sort_options']['dir'] == $field)">selected='selected'</if>>{$this->lang->words['album_sort_' . $field ]}</option>
										</foreach>
									</select>
								</div>
							<li>
							<li class='ipsField ipsField_checkbox'>
								<input type='checkbox' value='1' name='album_allow_comments' id='album_allow_comments'<if test="commChoose:|:!$album['_catDefaults']['album_comments_edit']"> disabled='disabled'<if test="noCommChoose:|:$album['_catDefaults']['album_allow_comments']"> checked='checked'</if><else /><if test="chooseComm:|:$album['album_allow_comments']"> checked='checked'</if></if> />
								<label for='album_allow_comments'>
									<p class='ipsField_content'>
										&nbsp;<strong>{$this->lang->words['album_frm_allow_comments']}</strong>
									<p>
								</label>
							<li>
							<li class='ipsField ipsField_checkbox'>
								<input type='checkbox' value='1' name='album_allow_rating' id='album_allow_rating'<if test="rateChoose:|:!$album['_catDefaults']['album_ratings_edit']"> disabled='disabled'<if test="noRateChoose:|:$album['_catDefaults']['album_allow_rating']"> checked='checked'</if><else /><if test="chooseRate:|:$album['album_allow_rating']"> checked='checked'</if></if> />
								<label for='album_allow_rating'>
									<p class='ipsField_content'>
										&nbsp;<strong>{$this->lang->words['album_frm_allow_rating']}</strong>
									<p>
								</label>
							<li>
							<li class='ipsField ipsField_checkbox'>
								<input type='checkbox' value='1' name='album_watermark' id='album_watermark' <if test="yesWatermark:|:$album['album_watermark'] == 1">checked='checked'</if> />
								<label for='album_watermark'>
									<p class='ipsField_content'>
										&nbsp;<strong>{$this->lang->words['album_watermark_check']}</strong>
									<p>
								</label>
							<li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<fieldset class='submit'>
			<input type='submit' value='{$this->lang->words['review_finish_' . $type ]}' class='input_submit' />
		</fieldset>
		<br />
		
		<if test="hasImagesToReviewTitle:|:is_array($images) && count($images)">
			<h2 class='ipsType_subtitle'>{$this->lang->words['review_title_uploads']}</h2>
		</if>
	</if>
	
	<if test="hasImagesToReview:|:is_array($images) && count($images)">
		<br />
		<div class='ipsBox'>
			<foreach loop="images:$images as $id => $image">
				<input type='hidden' class='_imgIds _x{$id}' name='imageIds[{$id}]' value="{$id}">
				<div class='ipsBox_container ipsPad'>
					<div class='ipsLayout ipsLayout_withleft ipsLayout_smallleft'>
						<div class='ipsLayout_left' id='image_thumb_wrap_{$id}'>
							{parse gallery_resize="$image['thumb']" width="thumb_large"}
							<p class='ipsPad desc'>
								<if test="isMedia:|:$image['_isMedia']">
									<input type="button" class="ipsButton_secondary media_thumb_pop clickable" style='margin-left:5px' value="{$this->lang->words['media_add_thumb']}" media-has-thumb="<if test="$image['image_media_thumb']">true<else />false</if>" media-id="{$image['image_id']}" />
									<if test="notMediaCategory:|:$album['album_id']"><br /><br /><input type='radio' name='makeCover' value='{$image['image_id']}' <if test="cover:|:$image['_cover']">checked="checked"</if>> &nbsp;{$this->lang->words['review_cover_img']}</if>
									<if test="deleteMedia:|:$type != 'uploads' AND ( $this->registry->gallery->helper('categories')->checkIsModerator( $image['image_category_id'] ) OR ( $image['image_member_id'] == $this->memberData['member_id'] AND $this->memberData['member_id'] AND $this->memberData['g_del_own'] ) )">
										<br /><input type='checkbox' name='delete[{$image['image_id']}]' value='1'>  &nbsp;{$this->lang->words['review_delete_movie']}
									</if>
									<if test="uploadMovieFollowOpt:|:$type == 'uploads' AND $this->memberData['member_id']">
										<br /><input type='checkbox' name='follow[{$image['image_id']}]' value='1' checked='checked' />  &nbsp;<span title='{$this->lang->words['follow_media_alt']}'>{$this->lang->words['follow_movie_start']}</span>
									</if>
								<else />
									<if test="notCategory:|:$album['album_id']"><input type='radio' name='makeCover' value='{$image['image_id']}' <if test="cover:|:$image['_cover']">checked="checked"</if>> &nbsp;{$this->lang->words['review_cover_img']}</if>
									<if test="deleteImage:|:$type != 'uploads' AND ( $this->registry->gallery->helper('categories')->checkIsModerator( $image['image_category_id'] ) OR ( $image['image_member_id'] == $this->memberData['member_id'] AND $this->memberData['member_id'] AND $this->memberData['g_del_own'] ) )">
										<br /><input type='checkbox' name='delete[{$image['image_id']}]' value='1'>  &nbsp;{$this->lang->words['review_delete_img']}
									</if>
									<br /><span class='rotate _r{$image['image_id']}'><img src="{$this->settings['img_url']}/gallery/rotate90.png" alt='{$this->lang->words['review_rotate_alt']}' title='{$this->lang->words['review_rotate_alt']}' /> {$this->lang->words['review_rotate']}</span>
									<if test="uploadFollowOpt:|:$type == 'uploads' AND $this->memberData['member_id']">
										<br /><input type='checkbox' name='follow[{$image['image_id']}]' value='1' checked='checked' />  &nbsp;<span title='{$this->lang->words['follow_media_alt']}'>{$this->lang->words['follow_image_start']}</span>
									</if>
								</if>
							</p>
						</div>
						<div class='ipsLayout_content'>
							<ul class='ipsForm ipsForm_vertical'>
								<li class='ipsField'>
									<label class='ipsField_title'>{$this->lang->words['title_ucfirst']}</label>
									<p class='ipsField_content'><input type='text' name='title[{$image['image_id']}]' class='input_text' style='width:95%;' value='{$image['_title']}' /></p>
								</li>
								<if test="hasTags:|:$image['_tagBox']">
									<li class='ipsField'>
										<label class='ipsField_title'>{$this->lang->words['review_tags']}</label>
										<div class='ipsField_content'>
										{$image['_tagBox']}
										</div>
									</li>
								</if>
								<li class='ipsField'>
									<label class='ipsField_title'>{$this->lang->words['review_desc']}</label>
									<div class='ipsField_content'>
										{$image['editor']}
									</div>
								</li>
								<if test="geo:|:$image['image_gps_lat'] AND $image['image_loc_short']">
									<li class='ipsField ipsField_checkbox'>
										<input type='checkbox' id='loc_{$image['image_id']}' name='locationAllow[{$image['image_id']}]' <if test="clickGps:|:$image['image_gps_show']">checked='checked'</if>value='1'>
										<label for='loc_{$image['image_id']}'>
											<p class='class='ipsField_content'>
												&nbsp;{$this->lang->words['review_show_loc']} <span class='desc'>({$image['image_loc_short']})</span>
											<p>
										</label>
									</li>
								</if>
								<li class='ipsField'>
									<label class='ipsField_title'>{$this->lang->words['copyright_ucfirst']}</label>
									<p class='ipsField_content'><input type='text'name='copyright[{$image['image_id']}]' class='input_text' style='width:95%;' value='{$image['image_copyright']}' /></p>
								</li>
							</ul>
						</div>
						<br class='clear' />
					</div>
				</div>
				<br />
			</foreach>
		</div>
		<fieldset class='submit clearfix'>
			<if test="otherPages:|:count($images) < $opts['total']">
				<if test="previousPage:|:$opts['start'] > 0">
					<div class='left'><input type='submit' value='{$this->lang->words['save_go_previous']}' class='input_submit alt' name='previousPage' /></div>
				</if>
				<input type='submit' value='{$this->lang->words['review_finish_' . $type ]}' class='input_submit' />
				<if test="nextPage:|:$opts['start'] + $opts['perPage'] < $opts['total']">
					<div class='right'><input type='submit' value='{$this->lang->words['save_go_next']}' class='input_submit alt' name='nextPage' /></div>
				</if>
			<else />
				<input type='submit' value='{$this->lang->words['review_finish_' . $type ]}' class='input_submit' />
			</if>
		</fieldset>
	</if>
</form>
<div id="templates-mediaupload" style="display:none">
	<h3>{$this->lang->words['review_upload_thumb']}</h3>
	<div class='ipsBox short'>
	 	<div id='mt_attachments_#{id}' style='width:400px;height:50px;'></div>
	 	<div id='mtErrorBox_#{id}' style='display:none' class='message error'>&nbsp;</div>
		<input type='button' id='mt_add_files_#{id}' class='input_submit' value='{$this->lang->words['media_save_thumb']}' tabindex='1' />
	</div>
</div>
<script type="text/javascript">
ipb.lang['remove_img']	= "{$this->lang->words['review_remove_img']}";
ipb.lang['add_thumb']	= "{$this->lang->words['review_add_thumb']}";
document.observe("dom:loaded", function(){
	ipb.gallery.setUpReviewPage();
} );
</script>]]></template_content>
      <template_name>review</template_name>
      <template_data>$images, $album, $category, $type, $opts</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_gallery_post</template_group>
      <template_content><![CDATA[{parse js_module="gallery_uploader"}
{parse js_module="gallery_albumchooser"}
{parse addtohead="{$this->settings['public_dir']}js/3rd_party/swfupload/swfupload.js" type="javascript"}
{parse addtohead="{$this->settings['public_dir']}js/3rd_party/swfupload/plugins/swfupload.swfobject.js" type="javascript"}
{parse addtohead="{$this->settings['public_dir']}js/3rd_party/swfupload/plugins/swfupload.cookies.js" type="javascript"}
{parse addtohead="{$this->settings['public_dir']}js/3rd_party/swfupload/plugins/swfupload.queue.js" type="javascript"}
<if test="cantDelete:|:!$this->memberData['g_del_own']">
	<div class='message unspecific'>
		{$this->lang->words['no_self_delete_warning']}
	</div>
	<br />
</if>
<h1 class='ipsType_pagetitle'>{$this->lang->words['upload_ucfirst']}</h1>
<br />
<div class='ipsSteps clearfix'>
	<ul>
		<li class="ipsSteps_active">
			<strong class='ipsSteps_title'>{parse expression="sprintf( $this->lang->words['step'], '1' )"}</strong>
			<span class='ipsSteps_desc'>{$this->lang->words['review_step_upload']}</span>
			<span class='ipsSteps_arrow'>&nbsp;</span>
		</li>
		<li>
			<strong class='ipsSteps_title'>{parse expression="sprintf( $this->lang->words['step'], '2' )"}</strong>
			<span class='ipsSteps_desc'>{$this->lang->words['review_step_publish']}</span>
			<span class='ipsSteps_arrow'>&nbsp;</span>
		</li>	
	</ul>
</div>
<br />
<if test="isModerating:|:$category['category_approve_img'] AND ! $this->registry->gallery->helper('categories')->checkIsModerator( $category['category_id'], null, 'mod_can_approve' ) AND !in_array( $category['category_id'], $this->registry->gallery->helper('categories')->member_access['bypass'] )">
	<div class='message unspecific'>
		<h3>{$this->lang->words['image_approval_required']}</h3>
		<p>{$this->lang->words['image_approval_required_text']}</p>
	</div>
	<br />
</if>
<div id='albumBoxWrap' class='ipsBox'>
	<div class='ipsBox_container ipsPad'>
		<div id='albumWrap'></div>
		<div id='albumWrapNone' style='display: none'>
			<div class='ipsLayout ipsLayout_withleft'>
				<div class='ipsLayout_left'>
					<img src="{$this->settings['img_url']}/gallery/missingphotothumb.png" class="ipsUserPhoto galattach" />
				</div>
				<div class='ipsLayout_content'>
					<br />
					<h4>{$this->lang->words['no_album_selected']}</h4><br />
					<br />
					<p class='desc container_selector'>
						<if test="canCreate1:|:$this->registry->gallery->helper('albums')->canCreate()"><a href='javascript:void(0);' class='ipsButton_secondary _albumNew'>{$this->lang->words['new_album']}</a>&nbsp;&nbsp;</if>
						<if test="canCreateS:|:$this->registry->gallery->helper('albums')->hasAlbums()"><a href='javascript:void(0);' class='ipsButton_secondary' data-album-selector-callback='ipb.gallery.callBackForUploadFormForAlbumSelector' data-album-selector='type=upload'>{$this->lang->words['select_album']}</a>&nbsp;&nbsp;</if>
						<a href='javascript:void(0);' class='ipsButton_secondary _categorySelector'>{$this->lang->words['or_select_category']}</a>
					</p>
				</div>
			</div>
			<br class='clear' />
		</div>
	</div>
</div>
<div class='ipsBox' id='uploadBoxWrapParent'>
	<div id='uploadBoxWrap' class='ipsBox_container ipsPad' style='display:none'>
		<div id='attachWrap'>
			<ul id='attachments'><li style='display: none'></li></ul>
		</div>
	</div>
	<div id='attach_error_box' class='message error forum_rules' style='display:none'></div>
	<!--SKINNOTE: traditional uploader needs this. -->
	<input type='file' id='nojs_attach_{$sessionKey}_1' class='input_upload' name='FILE_UPLOAD' tabindex='1' />
	<input type='file' id='nojs_attach_{$sessionKey}_2' class='input_upload' name='FILE_UPLOAD' tabindex='1' />
	<div id='uploadFieldWrap' style='display:none'>
		<div class='ipsBox_container'>
			<div class='ipsPad'>
				<div class='galleryNextButton' style='display:none'><a class='input_submit right' href='{parse url="app=gallery&module=images&section=review&do=show&sessionKey={$sessionKey}" base="public"}'>{$this->lang->words['review_next_button']}</a></div>
				<span id='buttonPlaceholder'></span>
				<input type='button' id='add_files_attach_{$sessionKey}' class='input_submit ipsType_small clear' value='{$this->lang->words['upload_ucfirst']}' style='display: none;' tabindex='1' />
				&nbsp;<span class='desc ipsType_smaller' id='space_info_attach_{$sessionKey}'>{parse expression="sprintf( $this->lang->words['upload_used_txt'], '<strong>' . IPSLib::sizeFormat( $stats['used'] ) . '</strong>', "<strong>{$stats['maxTotalHuman']}</strong>", '<strong>' . $stats['maxItemHuman'] . '</strong>')"}</span> <span class='desc ipsType_smaller'><a href='javascript:void(0);' id='showFileTypes'>{$this->lang->words['upload_types']}</a></span>
				<if test="showUploadSwitch:|:!IN_ACP AND $this->settings['uploadFormType']">
				<br /><br/><span class='desc lighter ipsType_smaller' id='help_msg'>
					<if test="flashuploadhelp:|:$this->memberData['member_uploader'] == 'flash'">
						 {$this->lang->words['trouble_uploading']} <a href='#' data-switch='default' title='{$this->lang->words['switch']}' tabindex='1'>{$this->lang->words['switch_to_basic']}</a>
					<else />
						<a href='#' data-switch='flash' title='{$this->lang->words['switch']}' tabindex='-1'>{$this->lang->words['switch_to_advanced']}</a>
					</if>
				</span>
				</if>
			</div>
		</div>
	</div>
</div>
<div id='showFileTypesContent' style='display:none'>
	<div class='ipsPad_double'>
		<strong>{$this->lang->words['upload_allowed']}</strong>: {$allowed_file_types}
	</div>
</div>
<div id='categorySelectorContent' style='display:none'>
	<h3>{$this->lang->words['select_category_submit']}</h3>
	<div class='ipsPad_double'>
		<table class='ipb_table' style="table-layout: auto;">
			<foreach loop="categories:$categories as $category">
				<tr>
					<td width='1%'>
						<div class='ipsUserPhoto'>
							{parse gallery_resize="$category['thumb']" width="thumb_tiny"}
						</div>
					</td>
					<td>
						<strong>{$category['category_name']}</strong>
						<if test="hasImagesCat:|:$category['category_count_imgs']">
							<div class='ipsType_smaller desc lighter'>{parse expression="sprintf( $this->lang->words['as_images_comments'], $category['category_count_imgs'], $category['category_count_comments'] )"} {$this->lang->words['as_last_upload']} {parse date="$category['category_last_img_date']" format="tiny"}</div>
						</if>
					</td>
					<td width='1%'>
						<if test="restrictUploadCat:|:!$category['_acceptImages'] OR !$this->registry->gallery->helper('categories')->isUploadable( $category['category_id'] )">
							&nbsp;
						<else />
							<input type='button' data-category-select-category-id="{$category['category_id']}" class='ipsButton_secondary clickable' value='{$this->lang->words['cs_select']}' />
						</if>
					</td>
				</tr>
			</foreach>
		</table>
	</div>
</div>
<script type='text/javascript'>
//<!#^#|CDATA|
	// Show the button and info
	$('add_files_attach_{$sessionKey}').show();
	$('space_info_attach_{$sessionKey}').show();
	
	ipb.delegate.register("[data-switch]", function(e, elem){
		ipb.uploader.switchUploadType( elem.readAttribute('data-switch') );
	});
	
	var useType       = 'simple';
	var uploadURL     = ipb.vars['base_url'] + "app=gallery&module=ajax&section=post&do=upload&type=album&sessionKey={$sessionKey}&album_id={$album['album_id']}&category_id={$category['category_id']}&fetch_all=1&s={$this->member->session_id}&_nsc=1&secure_key={$this->member->form_hash}";
	var albumTemplate = new Template( "<div id='albumWrap_#{album_id}'><div class='ipsLayout ipsLayout_withleft'><div class='ipsLayout_left'>#{thumb}</div><div class='ipsLayout_content'><br /><h4>{$this->lang->words['selected_album']}: #{album_name}</h4><br /><p class='desc'>#{album_count_imgs} {$this->lang->words['images_lower']}, #{album_count_comments} {$this->lang->words['comments_lower']}<br /><br /><if test="canCreate:|:$this->registry->gallery->helper('albums')->canCreate()"><a href='javascript:void(0);' class='ipsButton_secondary _albumNew'>{$this->lang->words['new_album']}</a>&nbsp;&nbsp;</if><a href='javascript:void(0);' class='ipsButton_secondary' data-album-selector-callback='ipb.gallery.callBackForUploadFormForAlbumSelector' data-album-selector='type=upload&album_id=#{album_id}'>{$this->lang->words['change_album']}</a>&nbsp;&nbsp;<a href='javascript:void(0);' class='ipsButton_secondary _categorySelector'>{$this->lang->words['or_select_category']}</a></p></div></div><br class='clear' /></div>" );
	var categoryTemplate = new Template( "<div id='albumWrap_#{category_id}'><div class='ipsLayout ipsLayout_withleft'><div class='ipsLayout_left'>#{thumb}</div><div class='ipsLayout_content'><br /><h4>{$this->lang->words['selected_category']}: #{category_name}</h4><br /><p class='desc'>#{category_count_imgs} {$this->lang->words['images_lower']}, #{category_count_comments} {$this->lang->words['comments_lower']}<br /><br /><span class='container_selector'><if test="canCreate:|:$this->registry->gallery->helper('albums')->canCreate()"><a href='javascript:void(0);' class='ipsButton_secondary _albumNew'>{$this->lang->words['new_album']}</a>&nbsp;&nbsp;</if><if test="canCreateS2:|:$this->registry->gallery->helper('albums')->hasAlbums()"><a href='javascript:void(0);' class='ipsButton_secondary' data-album-selector-callback='ipb.gallery.callBackForUploadFormForAlbumSelector' data-album-selector='type=upload'>{$this->lang->words['select_album']}</a>&nbsp;&nbsp;</if><a href='javascript:void(0);' class='ipsButton_secondary _categorySelector'>{$this->lang->words['or_change_category']}</a></span></p></div></div><br class='clear' /></div>" );
	
	if ( ipb.vars['use_swf_upload'] && ipb.vars['swfupload_enabled'] && jaaulde.utils.flashsniffer.meetsMinVersion( 9 ) )
	{
		useType = 'swf';
		var uploadURL = "{$this->settings['base_url']}app=gallery&module=ajax&section=post&do=process&sessionKey={$sessionKey}&album_id={$album['album_id']}&category_id={$category['category_id']}&s={$this->member->session_id}&_nsc=1&secure_key={$this->member->form_hash}";
		
		$('add_files_attach_{$sessionKey}').observe('mouseover', function(e){  } );
	}
	
	ipb.uploader.template = "<li id='ali_[id]' class='attach_row' style='display: none'><div><h4 class='attach_name'>[name]</h4><p class='info'>[info]</p><span class='img_holder'></span><p class='progress_bar'><span style='width: 0%'>0%</span></p><p class='links'> <a href='javascript:void(0);' class='cancel delete' title='{$this->lang->words['attach_delete_title']}'>{$this->lang->words['attach_delete']}</a></p></div></li>"; 
	
	document.observe('dom:loaded', function(){
		/* Load album box */
		ipb.uploader.buildContainerBox( {parse expression="intval($album['album_id'])"}, {parse expression="intval($category['category_id'])"}, <if test="useCatTemplate:|:$album['album_id']">albumTemplate<else />categoryTemplate</if>, 'albumWrap' );
		
		/* Load up uploaders */
		ipb.uploader.registerUploader( 'attach_{$sessionKey}', useType, 'attachments', {
			'upload_url': uploadURL,
			'album_id': "{parse expression="intval($album['album_id'])"}",
			'category_id': "{parse expression="intval($category['category_id'])"}",
			'sessionKey': "{$sessionKey}",
			'file_size_limit': "{$stats['maxItemHuman']}"
		} )});
//|#^#]>
</script>]]></template_content>
      <template_name>uploadForm</template_name>
      <template_data><![CDATA[$sessionKey='', $album=array(), $category=array(), $categories=array(), $stats=array(), $allowed_file_types='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
</templates>
